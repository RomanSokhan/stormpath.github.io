

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4. Authenticating Accounts with Stormpath &mdash; Stormpath REST Documentation  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="author" title="About these documents"
              href="about.html"/>
    <link rel="top" title="Stormpath REST Documentation  documentation" href="index.html"/>
        <link rel="next" title="5. Authorization With Stormpath" href="auth_z.html"/>
        <link rel="prev" title="3. Account Management" href="accnt_mgmt.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

  
  <script src="https://cdn.optimizely.com/js/225847041.js"></script>

  
  <script>
  !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
  n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
  document,'script','https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '986262161469311');
  fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none"
  src="https://www.facebook.com/tr?id=986262161469311&ev=PageView&noscript=1"
  /></noscript>

  <style type="text/css">
    #migration-banner {
      background-image:url(https://stormpath.com/wp-content/uploads/2017/03/stormpath-blog-background.png);
      background-repeat: no-repeat;
      background-size: 100%;
      color: #fff;
      font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
      font-weight: 300;
      max-width: none;
      padding: 35px 20px 0 20px;
      text-align: center;
    }
    @media screen and (min-width: 1400px) {
      #migration-banner {
        max-width: 800px;
      }
    }
    #migration-banner a{
      color: #fff;
      text-decoration: underline;
    }
    #migration-banner img {
      border: none;
    }
    #migration-banner p {
      padding: 20px 0;
    }
  </style>
</head>

<body class="wy-body-for-nav" role="document">

  
  <noscript><iframe src=".//www.googletagmanager.com/ns.html?id=GTM-NQZZFW"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NQZZFW');</script>

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
  

          
            <a href="index.html" class="icon icon-home"> Stormpath REST Documentation
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

  <div class="langpicker-container">
    <a href="#langpicker" class="langpicker-link">
      <i class="fa fa-code"></i>
      Switch Language
    </a>
    <div id="langpicker" style="display:none;">
      <div class="">
        <a href="./csharp/product-guide/latest/auth_n.html">C#</a>
      </div>
      <div class="">
        <a href="./java/product-guide/latest/auth_n.html">Java</a>
      </div>
      <div class="">
        <a href="./nodejs/product-guide/latest/auth_n.html">Node.js</a>
      </div>
      <div class="">
        <a href="./php/product-guide/latest/auth_n.html">PHP</a>
      </div>
      <div class="">
        <a href="./python/product-guide/latest/auth_n.html">Python</a>
      </div>
      <div class="current">
        <a href="./rest/product-guide/latest/auth_n.html">REST</a>
      </div>
      <div class="">
        <a href="./ruby/product-guide/latest/auth_n.html">Ruby</a>
      </div>
      <div class="">
        <a href="./vbnet/product-guide/latest/auth_n.html">Visual Basic</a>
      </div>
    </div>
  </div>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
  
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">1. About Stormpath</a><ul>
<li class="toctree-l2"><a class="reference internal" href="about.html#what-is-stormpath">1.1. What is Stormpath?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="about.html#what-you-can-do-with-stormpath">1.1.1. What you can do with Stormpath</a></li>
<li class="toctree-l3"><a class="reference internal" href="about.html#who-should-use-stormpath">1.1.2. Who should use Stormpath</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="about.html#the-stormpath-data-model">1.2. The Stormpath Data Model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">2. Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#sign-up-for-stormpath">2.1 Sign-up for Stormpath</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#create-an-api-key-pair">2.2 Create an API Key Pair</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#installing-the-sdk">2.3 Installing the SDK</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#retrieve-your-application">2.4. Retrieve Your Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#create-a-user-account">2.5. Create a User Account</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#authenticate-a-user-account">2.6. Authenticate a User Account</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#next-steps">2.7. Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="accnt_mgmt.html">3. Account Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="accnt_mgmt.html#modeling-your-user-base">3.1. Modeling Your User Base</a><ul>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#directories">3.1.1. Directories</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#types-of-directories">Types of Directories</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#cloud-directories">Cloud Directories</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#mirror-directories">Mirror Directories</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#groups">3.1.2. Groups</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#modeling-user-hierarchies-using-groups">Modeling User Hierarchies Using Groups</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#how-to-create-a-group">How to Create a Group</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="accnt_mgmt.html#how-to-store-accounts-in-stormpath">3.2. How to Store Accounts in Stormpath</a><ul>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#new-account-creation">3.2.1. New Account Creation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#add-a-new-account-to-a-directory">Add a New Account to a Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#add-an-existing-account-to-a-group">Add an Existing Account to a Group</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#adding-a-new-account-or-group-to-an-application-or-organization">Adding a new Account or Group to an Application or Organization</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#importing-accounts">3.2.2. Importing Accounts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#importing-accounts-with-plaintext-passwords">Importing Accounts with Plaintext Passwords</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#importing-accounts-with-supported-password-hashes">Importing Accounts with Supported Password Hashes</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#importing-accounts-with-unsupported-password-hashes">Importing Accounts with Unsupported Password Hashes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#how-to-store-additional-user-information-as-custom-data">3.2.3. How to Store Additional User Information as Custom Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="accnt_mgmt.html#how-to-search-accounts">3.3. How to Search Accounts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#example-account-searches">3.3.1. Example Account Searches</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#search-an-application-s-accounts-for-a-particular-word">Search an Application&#8217;s Accounts for a Particular Word</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#find-all-the-disabled-accounts-in-a-directory">Find All the Disabled Accounts in a Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#find-all-accounts-in-a-directory-that-were-modified-on-a-particular-day">Find All Accounts in a Directory That Were Modified on a Particular Day</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#searching-for-accounts-with-custom-data">3.3.2. Searching for Accounts with Custom Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="accnt_mgmt.html#how-to-manage-an-account-s-password">3.4. How to Manage an Account&#8217;s Password</a><ul>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#manage-password-policies">3.4.1. Manage Password Policies</a></li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#change-an-account-s-password">3.4.2. Change an Account&#8217;s Password</a></li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#password-reset">3.4.3. Password Reset</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#how-to-reset-a-password">How to Reset a Password</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#manage-password-reset-emails">Manage Password Reset Emails</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#password-reset-email-templates">Password Reset Email Templates</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#how-to-find-when-an-account-s-password-was-changed">3.4.4. How to Find When An Account&#8217;s Password Was Changed</a></li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#how-to-restrict-password-reuse">3.4.5. How to Restrict Password Reuse</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="accnt_mgmt.html#how-to-manage-an-account-s-required-attributes">3.5. How to Manage an Account&#8217;s Required Attributes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#retrieving-your-directory-s-account-schema">3.5.1. Retrieving your Directory&#8217;s Account Schema</a></li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#modifying-your-directory-s-account-schema">3.5.2. Modifying your Directory&#8217;s Account Schema</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="accnt_mgmt.html#how-to-verify-an-account-s-email">3.6. How to Verify an Account&#8217;s Email</a><ul>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#the-email-verification-workflow">3.6.1. The Email Verification Workflow</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#the-account-verification-base-url">The Account Verification Base URL</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#configuring-the-verification-workflow">3.6.2. Configuring the Verification Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#triggering-the-verification-email-creating-a-token">3.6.3. Triggering the Verification Email (Creating A Token)</a></li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#verifying-the-email-address-consuming-the-token">3.6.4. Verifying the Email Address (Consuming The Token)</a></li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#resending-the-verification-email">3.6.5. Resending the Verification Email</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="accnt_mgmt.html#customizing-stormpath-emails">3.7. Customizing Stormpath Emails</a><ul>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#what-emails-does-stormpath-send">3.7.1. What Emails Does Stormpath Send?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#id4">Account Creation</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#id5">Password Reset</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#customizing-stormpath-email-templates">3.7.2. Customizing Stormpath Email Templates</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#using-email-macros">Using Email Macros</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#customizing-your-smtp-server">3.7.3. Customizing Your SMTP Server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#adding-a-new-custom-server">Adding a new Custom Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#deleting-a-custom-server">Deleting a Custom Server</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#restricting-user-email-domains">3.7.4 Restricting User Email Domains</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#domain-entries">Domain Entries</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#working-with-the-lists">Working with the Lists</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="accnt_mgmt.html#account-linking">3.8. Account Linking</a><ul>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#how-login-works-with-linked-accounts">How Login Works with Linked Accounts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#application-vs-organization-account-linking-policies">Application vs Organization Account Linking Policies</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#example-login-behaviors">Example Login Behaviors</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#how-to-link-accounts-manually">How to Link Accounts Manually</a></li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#how-to-link-accounts-automatically">How to Link Accounts Automatically</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#what-s-in-the-account-linking-policy">What&#8217;s in the Account Linking Policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#account-matching-and-account-verification">Account Matching and Account Verification</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#example-scenario-1">Example Scenario 1</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#example-scenario-2">Example Scenario 2</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">4. Authenticating Accounts with Stormpath</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#how-password-authentication-works-in-stormpath">4.1. How Password Authentication Works in Stormpath</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#authenticating-an-account">4.1.1. Authenticating An Account</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#how-login-attempts-work-in-stormpath">4.1.2. How Login Attempts Work in Stormpath</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#manage-who-can-log-into-your-application">4.1.3. Manage Who Can Log Into Your Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mapping-a-new-account-store">Mapping a new Account Store</a></li>
<li class="toctree-l4"><a class="reference internal" href="#updating-an-existing-account-store">Updating an Existing Account Store</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#how-token-based-authentication-works">4.2. How Token-Based Authentication Works</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction-to-token-based-authentication">4.2.1. Introduction to Token-Based Authentication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#why-oauth-2-0">Why OAuth 2.0?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#what-tokens-are-available-for-token-based-authentication">What Tokens Are Available for Token-Based Authentication?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#using-stormpath-for-token-based-authentication">4.2.2. Using Stormpath for Token-Based Authentication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuring-token-based-authentication">Configuring Token-Based Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="#generating-an-oauth-2-0-access-token">Generating an OAuth 2.0 Access Token</a></li>
<li class="toctree-l4"><a class="reference internal" href="#validating-an-access-token">Validating an Access Token</a></li>
<li class="toctree-l4"><a class="reference internal" href="#refreshing-access-tokens">Refreshing Access Tokens</a></li>
<li class="toctree-l4"><a class="reference internal" href="#revoking-access-and-refresh-tokens">Revoking Access and Refresh Tokens</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#how-social-authentication-works">4.3. How Social Authentication Works</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#attribute-mappings">Attribute Mappings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scopes">Scopes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#social-login-providers">Social Login Providers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#google">4.3.1. Google</a></li>
<li class="toctree-l4"><a class="reference internal" href="#facebook">4.3.2. Facebook</a></li>
<li class="toctree-l4"><a class="reference internal" href="#github">4.3.3. Github</a></li>
<li class="toctree-l4"><a class="reference internal" href="#linkedin">4.3.4 LinkedIn</a></li>
<li class="toctree-l4"><a class="reference internal" href="#twitter">4.3.5. Twitter</a></li>
<li class="toctree-l4"><a class="reference internal" href="#generic-oauth-2-0-login">4.3.6. Generic OAuth 2.0 Login</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#authenticating-against-an-ldap-directory">4.4. Authenticating Against an LDAP Directory</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-ldap-authentication-flow">The LDAP Authentication Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mirror-directories-and-ldap">Mirror Directories and LDAP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-login-with-ldap">Setting Up Login With LDAP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#step-1-create-an-ldap-directory">Step 1: Create an LDAP Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-2-install-your-ldap-agent">Step 2: Install your LDAP Agent</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-3-map-the-ldap-directory-as-an-account-store-for-your-application">Step 3: Map the LDAP Directory as an Account Store for Your Application</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#authenticating-against-a-saml-directory">4.5. Authenticating Against a SAML Directory</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#stormpath-as-the-identity-provider">4.5.1. Stormpath as the Identity Provider</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuring-stormpath-as-an-identity-provider-via-rest">Configuring Stormpath as an Identity Provider via REST</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#stormpath-as-the-service-provider">4.5.2. Stormpath as the Service Provider</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#identity-provider-initiated-saml-authentication">Identity Provider Initiated SAML Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="#service-provider-initiated-saml-authentication">Service Provider Initiated SAML Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-stormpath-as-the-service-provider">Configuring Stormpath as the Service Provider</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-stormpath-as-a-service-provider-via-rest">Configuring Stormpath as a Service Provider via REST</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-stormpath-saml-flow">4.5.4. The Stormpath SAML Flow</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#with-stormpath-as-the-identity-provider">With Stormpath as the Identity Provider</a></li>
<li class="toctree-l4"><a class="reference internal" href="#with-stormpath-as-the-service-provider">With Stormpath as the Service Provider</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-multi-factor-authentication-mfa">4.6. Using Multi-Factor Authentication (MFA)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#enrolling-an-additional-factor">4.6.1. Enrolling an Additional Factor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#adding-an-sms-factor">Adding an SMS Factor</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-a-google-authenticator-factor">Adding a Google Authenticator Factor</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#challenging-a-factor">4.6.2. Challenging a Factor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#challenging-after-factor-creation">Challenging After Factor Creation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#challenging-during-factor-creation">Challenging During Factor Creation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#challenging-a-factor-after-login">Challenging a Factor After Login</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="auth_z.html">5. Authorization With Stormpath</a><ul>
<li class="toctree-l2"><a class="reference internal" href="auth_z.html#what-is-authorization">5.1. What is Authorization?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="auth_z.html#simple-authorization">5.1.1. Simple Authorization</a></li>
<li class="toctree-l3"><a class="reference internal" href="auth_z.html#permissions-based-authorization">5.1.2. Permissions-based Authorization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="auth_z.html#modeling-authorization-in-stormpath">5.2. Modeling Authorization in Stormpath</a><ul>
<li class="toctree-l3"><a class="reference internal" href="auth_z.html#how-to-use-groups-to-model-authorization-roles">5.2.1. How to Use Groups to Model Authorization Roles</a><ul>
<li class="toctree-l4"><a class="reference internal" href="auth_z.html#application-wide-roles">Application-Wide Roles</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="auth_z.html#using-permissions">5.2.2. Using Permissions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="auth_z.html#how-to-model-fine-grained-permissions">How to Model Fine-Grained Permissions</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_z.html#checking-user-and-role-permissions">Checking User and Role Permissions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="multitenancy.html">6. Multi-Tenancy with Stormpath</a><ul>
<li class="toctree-l2"><a class="reference internal" href="multitenancy.html#what-is-a-multi-tenant-application">6.1. What Is a Multi-Tenant Application?</a></li>
<li class="toctree-l2"><a class="reference internal" href="multitenancy.html#modeling-tenants-in-stormpath">6.2. Modeling Tenants in Stormpath</a><ul>
<li class="toctree-l3"><a class="reference internal" href="multitenancy.html#multi-tenancy-and-the-stormpath-data-model">6.2.1 Multi-Tenancy and the Stormpath Data Model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="multitenancy.html#why-use-organizations">Why use Organizations?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="multitenancy.html#account-store-strategies-for-multi-tenancy">6.2.1. Account Store Strategies for Multi-Tenancy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="multitenancy.html#strategy-1-directory-per-organization">Strategy 1: Directory per Organization</a></li>
<li class="toctree-l4"><a class="reference internal" href="multitenancy.html#strategy-2-group-per-organization">Strategy 2: Group per Organization</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="multitenancy.html#working-with-organizations">6.2.2. Working with Organizations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="multitenancy.html#how-to-create-an-organization">How to Create an Organization</a></li>
<li class="toctree-l4"><a class="reference internal" href="multitenancy.html#adding-an-account-store-to-an-organization">Adding an Account Store to an Organization</a></li>
<li class="toctree-l4"><a class="reference internal" href="multitenancy.html#registering-an-organization-as-an-account-store-for-an-application">Registering an Organization as an Account Store for an Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="multitenancy.html#adding-an-account-to-an-organization">Adding an Account to an Organization</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="multitenancy.html#authenticating-an-account-against-an-organization">6.3. Authenticating an Account against an Organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="multitenancy.html#routing-users-to-their-tenant">6.4 Routing Users to their Tenant</a><ul>
<li class="toctree-l3"><a class="reference internal" href="multitenancy.html#sub-domain">6.4.1. Sub-Domain</a><ul>
<li class="toctree-l4"><a class="reference internal" href="multitenancy.html#separate-domain-space">Separate Domain Space</a></li>
<li class="toctree-l4"><a class="reference internal" href="multitenancy.html#combine-with-login-form-field">Combine With Login Form Field</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="multitenancy.html#login-form-field">6.4.2. Login Form Field</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="idsite.html">7. Using ID Site</a><ul>
<li class="toctree-l2"><a class="reference internal" href="idsite.html#what-is-an-id-site">7.1. What is an ID Site?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="idsite.html#why-should-i-use-stormpath-id-site">Why should I use Stormpath ID Site?</a></li>
<li class="toctree-l3"><a class="reference internal" href="idsite.html#browser-support">Browser Support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="idsite.html#how-does-id-site-work">7.2. How does ID Site Work?</a></li>
<li class="toctree-l2"><a class="reference internal" href="idsite.html#idsite-set-up">7.3. ID Site Set Up</a></li>
<li class="toctree-l2"><a class="reference internal" href="idsite.html#using-id-site-via-language">7.4. Using ID Site Via REST</a><ul>
<li class="toctree-l3"><a class="reference internal" href="idsite.html#step-1-getting-a-user-to-id-site">Step 1: Getting a User to ID Site</a><ul>
<li class="toctree-l4"><a class="reference internal" href="idsite.html#idsite-auth-jwt">ID Site Authentication JWT</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="idsite.html#step-2-handling-the-callback-to-your-application-from-id-site">Step 2: Handling the Callback to your Application from ID Site</a><ul>
<li class="toctree-l4"><a class="reference internal" href="idsite.html#idsite-response-jwt">ID Site Assertion JWT</a></li>
<li class="toctree-l4"><a class="reference internal" href="idsite.html#exchanging-the-id-site-jwt-for-an-oauth-token">Exchanging the ID Site JWT for an OAuth Token</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="idsite.html#step-3-optional-logging-out-of-id-site">Step 3: (Optional) Logging Out of ID Site</a></li>
<li class="toctree-l3"><a class="reference internal" href="idsite.html#resetting-your-password-with-id-site">Resetting Your Password with ID Site</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="idsite.html#using-id-site-for-multi-tenancy">7.5. Using ID Site for Multi-tenancy</a></li>
<li class="toctree-l2"><a class="reference internal" href="idsite.html#idsite-sso">7.6. ID Site &amp; Single Sign-On</a></li>
<li class="toctree-l2"><a class="reference internal" href="idsite.html#idsite-hosting">7.7. ID Site Hosting Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">REST API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="reference.html#rest-api-core-concepts">REST API Core Concepts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference.html#base-url">Base URL</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference.html#resource-format">Resource Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference.html#character-encoding">Character Encoding</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference.html#request-identifiers">Request Identifiers</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference.html#authentication">Authentication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reference.html#basic-authentication-over-https">Basic Authentication over HTTPS</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#digest-authentication">Digest Authentication</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="reference.html#creating-retrieving-updating-and-deleting-resources">Creating, Retrieving, Updating, and Deleting Resources</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reference.html#creating-resources">Creating Resources</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#retrieving-resources">Retrieving Resources</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#updating-resources">Updating Resources</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#deleting-resources">Deleting Resources</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="reference.html#rest-error-responses">REST Error Responses</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference.html#collection-resource">Collection Resource</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reference.html#pagination">Pagination</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#sorting">Sorting</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#search">Search</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="reference.html#links">Links</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#tenant">Tenant</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference.html#tenant-operations">Tenant Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reference.html#retrieve-a-tenant">Retrieve A Tenant</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#using-a-tenant-for-look-up">Using A Tenant for Look-Up</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="reference.html#other-resources-associated-with-a-tenant">Other Resources Associated with a Tenant</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reference.html#ref-id-site">ID Site</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#smtp-server">SMTP Server</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#application">Application</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference.html#application-operations">Application Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reference.html#create-an-application">Create An Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#retrieve-an-application">Retrieve an Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#update-an-application">Update an Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#delete-an-application">Delete an Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#using-an-application-for-look-up">Using an Application for Look-Up</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="reference.html#application-endpoints">Application Endpoints</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reference.html#login-attempts">Login Attempts</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#password-reset-tokens">Password Reset Tokens</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#verification-email">Verification Email</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#auth-tokens">Auth Tokens</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#oauth-token">OAuth Token</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="reference.html#other-resources-associated-with-an-application">Other Resources Associated with an Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reference.html#application-api-keys">Application API Keys</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#oauth-policy">OAuth Policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#saml-policy">SAML Policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#saml-service-provider">SAML Service Provider</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#saml-identity-provider">SAML Identity Provider</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#account-store-mapping">Account Store Mapping</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference.html#account-store-mapping-operations">Account Store Mapping Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reference.html#create-an-account-store-mapping">Create an Account Store Mapping</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#retrieve-an-account-store-mapping">Retrieve an Account Store Mapping</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#update-an-account-store-mapping">Update an Account Store Mapping</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#delete-an-account-store-mapping">Delete an Account Store Mapping</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#account-linking-policy">Account Linking Policy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference.html#account-linking-policy-operations">Account Linking Policy Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reference.html#create-an-account-linking-policy">Create an Account Linking Policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#retrieve-an-account-linking-policy">Retrieve an Account Linking Policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#update-an-account-linking-policy">Update an Account Linking Policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#delete-an-account-linking-policy">Delete an Account Linking Policy</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#directory">Directory</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference.html#directory-operations">Directory Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reference.html#create-a-directory">Create a Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#retrieve-a-directory">Retrieve a Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#update-a-directory">Update a Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#delete-a-directory">Delete a Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#using-a-directory-for-look-up">Using A Directory for Look-Up</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="reference.html#other-resources-associated-with-a-directory">Other Resources Associated with a Directory</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reference.html#account-creation-policy">Account Creation Policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#account-schema">Account Schema</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#password-policy">Password Policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#email-templates">Email Templates</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#password-strength">Password Strength</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#provider">Provider</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#group">Group</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference.html#group-operations">Group Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reference.html#create-a-group">Create a Group</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#retrieve-a-group">Retrieve a Group</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#update-a-group">Update a Group</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#delete-a-group">Delete a Group</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#using-a-group-for-look-up">Using a Group for Look-Up</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#group-membership">Group Membership</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference.html#group-membership-operations">Group Membership Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reference.html#create-a-group-membership">Create a Group Membership</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#retrieve-a-group-membership">Retrieve a Group Membership</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#update-a-group-membership">Update a Group Membership</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#delete-a-group-membership">Delete a Group Membership</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#organization">Organization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference.html#organization-operations">Organization Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reference.html#create-an-organization">Create an Organization</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#retrieve-an-organization">Retrieve an Organization</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#update-an-organization">Update an Organization</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#delete-an-organization">Delete an Organization</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#using-an-organization-for-look-up">Using an Organization for Look-Up</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#organization-account-store-mapping">Organization Account Store Mapping</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference.html#organization-account-store-mapping-operations">Organization Account Store Mapping Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reference.html#create-an-organization-account-store-mapping">Create an Organization Account Store Mapping</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#retrieve-an-organization-account-store-mapping">Retrieve an Organization Account Store Mapping</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#update-an-organization-account-store-mapping">Update an Organization Account Store Mapping</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#delete-an-organization-account-store-mapping">Delete an Organization Account Store Mapping</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#account">Account</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference.html#account-operations">Account Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reference.html#create-an-account">Create an Account</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#retrieve-an-account">Retrieve an Account</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#update-an-account">Update an Account</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#delete-an-account">Delete an Account</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#using-an-account-for-look-up">Using an Account for Look-Up</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="reference.html#other-resources-associated-with-an-account">Other Resources Associated with an Account</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reference.html#account-api-keys">Account API Keys</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#access-tokens">Access Tokens</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#refresh-tokens">Refresh Tokens</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#factor">Factor</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#challenge">Challenge</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#phone">Phone</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#provider-data">Provider Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#expanded-json-web-token">Expanded JSON Web Token</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#account-link">Account Link</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference.html#account-link-operations">Account Link Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reference.html#create-an-account-link">Create an Account Link</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#retrieve-an-account-link">Retrieve an Account Link</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#update-an-account-link">Update an Account Link</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#delete-an-account-link">Delete an Account Link</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#custom-data">Custom Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference.html#custom-data-operations">Custom Data Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reference.html#create-custom-data">Create Custom Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#retrieve-custom-data">Retrieve Custom Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#update-custom-data">Update Custom Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference.html#delete-custom-data">Delete Custom Data</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a><ul>
<li class="toctree-l2"><a class="reference internal" href="appendix.html#generating-an-oauth-2-0-access-token">Generating an OAuth 2.0 Access Token</a><ul>
<li class="toctree-l3"><a class="reference internal" href="appendix.html#client-credentials">Client Credentials</a></li>
<li class="toctree-l3"><a class="reference internal" href="appendix.html#social">Social</a></li>
<li class="toctree-l3"><a class="reference internal" href="appendix.html#password">Password</a></li>
<li class="toctree-l3"><a class="reference internal" href="appendix.html#stormpath-factor-challenge">Stormpath Factor Challenge</a></li>
<li class="toctree-l3"><a class="reference internal" href="appendix.html#token-generation-example">Token Generation Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="appendix.html#social-login-deprecated">Social Login (Deprecated)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="appendix.html#google">Google</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendix.html#facebook">Facebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendix.html#github">GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendix.html#linkedin">LinkedIn</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="errors.html">Stormpath Error Codes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="errors.html#x-communication">110X: Communication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-1100">Error 1100</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-1101">Error 1101</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xx-billing-payment">19XX: Billing / Payment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-1900">Error 1900</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-1902">Error 1902</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-1903">Error 1903</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-1904">Error 1904</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-1905">Error 1905</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-1906">Error 1906</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-1910">Error 1910</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xxx-general-validation">2XXX: General Validation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2000">Error 2000</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2001">Error 2001</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2002">Error 2002</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2003">Error 2003</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2004">Error 2004</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2005">Error 2005</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2006">Error 2006</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2007">Error 2007</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2008">Error 2008</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2009">Error 2009</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2010">Error 2010</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2011">Error 2011</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2012">Error 2012</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2013">Error 2013</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2014">Error 2014</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2015">Error 2015</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2016">Error 2016</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2017">Error 2017</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2020">Error 2020</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2021">Error 2021</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2022">Error 2022</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2100">Error 2100</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2101">Error 2101</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2102">Error 2102</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2103">Error 2103</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2104">Error 2104</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2105">Error 2105</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2106">Error 2106</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2107">Error 2107</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2108">Error 2108</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xxx-custom-data">3XXX: Custom Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-3000">Error 3000</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-3001">Error 3001</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-3002">Error 3002</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-3003">Error 3003</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-3004">Error 3004</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#x-tenant">400X: Tenant</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4001">Error 4001</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4002">Error 4002</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xxx-organization">4XXX: Organization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4520">Error 4520</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4600">Error 4600</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4601">Error 4601</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4602">Error 4602</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4603">Error 4603</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4604">Error 4604</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4605">Error 4605</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4606">Error 4606</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4608">Error 4608</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4610">Error 4610</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4612">Error 4612</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#id1">4614</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4700">Error 4700</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xxx-application">5XXX: Application</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5010">Error 5010</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5100">Error 5100</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5101">Error 5101</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5102">Error 5102</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5103">Error 5103</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5104">Error 5104</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5105">Error 5105</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5106">Error 5106</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5108">Error 5108</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5110">Error 5110</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5112">Error 5112</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5114">Error 5114</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5116">Error 5116</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5117">Error 5117</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5118">Error 5118</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5119">Error 5119</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5120">Error 5120</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5121">Error 5121</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5122">Error 5122</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5200">Error 5200</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xxx-directory">6XXX: Directory</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-6100">Error 6100</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-6101">Error 6101</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-6201">Error 6201</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-6202">Error 6202</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-6203">Error 6203</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xxx-account">7XXX: Account</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7100">Error 7100</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7101">Error 7101</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7102">Error 7102</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7103">Error 7103</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7104">Error 7104</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7105">Error 7105</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7106">Error 7106</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7107">Error 7107</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7200">Error 7200</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7201">Error 7201</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7202">Error 7202</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7205">Error 7205</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7206">Error 7206</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7301">Error 7301</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7500">Error 7500</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7501">Error 7501</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7502">Error 7502</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7503">Error 7503</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7504">Error 7504</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7505">Error 7505</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xxx-agent">9XXX: Agent</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-9000">Error 9000</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-9001">Error 9001</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-9002">Error 9002</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-9003">Error 9003</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-9004">Error 9004</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-9005">Error 9005</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-9006">Error 9006</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xx-oauth-errors">100XX: OAuth Errors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-10010">Error 10010</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-10011">Error 10011</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-10012">Error 10012</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-10013">Error 10013</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-10014">Error 10014</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-10015">Error 10015</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-10016">Error 10016</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-10017">Error 10017</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xx-saml-errors">101XX: SAML Errors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-10100">Error 10100</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-10101">Error 10101</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-10102">Error 10102</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xx-token-errors">110XX: Token Errors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-11001">Error 11001</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-11002">Error 11002</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-11003">Error 11003</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-11004">Error 11004</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-11005">Error 11005</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xx-id-site-jwt">120XX: ID Site JWT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-12001">Error 12001</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-12002">Error 12002</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xx-smtp-server">130XX: SMTP Server</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13000">Error 13000</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13001">Error 13001</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13002">Error 13002</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13003">Error 13003</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xxx-multi-factor-authentication">13XXX: Multi-Factor Authentication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13100">Error 13100</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13101">Error 13101</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13102">Error 13102</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13103">Error 13103</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13104">Error 13104</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13105">Error 13105</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13106">Error 13106</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13107">Error 13107</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13108">Error 13108</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13109">Error 13109</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13110">Error 13110</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13111">Error 13111</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13112">Error 13112</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13113">Error 13113</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a><ul>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id1">2017-02-10</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id2">2017-01-27</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id3">2017-01-18</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id4">2016-10-14</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id5">2016-09-26</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id6">2016-09-15</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id7">2016-08-22</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id8">2016-08-02</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id9">2016-07-21</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id10">2016-07-01</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id11">2016-06-30</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id12">2016-06-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id13">2016-06-20</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id14">2016-06-15</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id15">2016-06-09</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id16">2016-06-07</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id17">2016-06-03</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id18">2016-06-01</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id19">2016-05-25</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id20">2016-05-18</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id21">2016-05-11</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id22">2016-04-29</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id23">2016-04-28</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id24">2016-04-22</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id25">2016-04-21</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id26">2016-04-18</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id27">2016-03-16</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id28">2016-03-04</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id29">2016-03-01</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id30">2016-02-24</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id31">2016-02-19</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id32">2016-02-16</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id33">2016-02-10</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id34">2016-02-02</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#id35">2016-01-20</a></li>
</ul>
</li>
</ul>

            
          

  

  


        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Stormpath REST Documentation</a>
        
      </nav>


      

      <div id="migration-banner" class="wy-nav-content">
        <div id="banner">
          <img src="https://stormpath.com/wp-content/uploads/2017/03/stormpath-hero-logos-2.png" alt="" width="512">
          <p>
            The Stormpath API will shut down on 8/17/2017 at noon PST. Learn more in our <a href="https://stormpath.com/oktaplusstormpath">Migration FAQ</a>.
          </p>
        </div>
      </div>

      <div class="wy-nav-content">
        <div class="rst-content">
          

 







<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>4. Authenticating Accounts with Stormpath</li>
    <li class="wy-breadcrumbs-aside">
      
          
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="authenticating-accounts-with-stormpath">
<span id="authn"></span><h1>4. Authenticating Accounts with Stormpath<a class="headerlink" href="#authenticating-accounts-with-stormpath" title="Permalink to this headline">¶</a></h1>
<p>Authentication is the process by which a system identifies that someone is who they say they are. Perhaps the most accessible example of this process is at the airport, where you must present your passport and your plane ticket. The passport is used to authenticate you, that you are who you present yourself to be, and the plane ticket represents your authorization to board a specific flight.</p>
<p>In this chapter you will cover three of the ways that Stormpath allows you to authenticate users: <a class="reference internal" href="#password-authn"><span>password authentication</span></a>, <a class="reference internal" href="#token-authn"><span>token authentication</span></a>, and <a class="reference internal" href="#social-authn"><span>social authentication</span></a>.</p>
<div class="section" id="how-password-authentication-works-in-stormpath">
<span id="password-authn"></span><h2>4.1. How Password Authentication Works in Stormpath<a class="headerlink" href="#how-password-authentication-works-in-stormpath" title="Permalink to this headline">¶</a></h2>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#authenticating-an-account" id="id22">4.1.1. Authenticating An Account</a><ul>
<li><a class="reference internal" href="#how-login-attempts-work-in-stormpath" id="id23">4.1.2. How Login Attempts Work in Stormpath</a></li>
</ul>
</li>
<li><a class="reference internal" href="#manage-who-can-log-into-your-application" id="id24">4.1.3. Manage Who Can Log Into Your Application</a><ul>
<li><a class="reference internal" href="#mapping-a-new-account-store" id="id25">Mapping a new Account Store</a></li>
<li><a class="reference internal" href="#updating-an-existing-account-store" id="id26">Updating an Existing Account Store</a></li>
</ul>
</li>
</ul>
</div>
<p>Probably the single most common way of authenticating a user is to ask them for their account credentials. When a user creates an Account in Stormpath, it is required that they provide a username (or email) and a password. Those credentials can then be provided in order to authenticate that Account.</p>
<div class="section" id="authenticating-an-account">
<h3><a class="toc-backref" href="#id22">4.1.1. Authenticating An Account</a><a class="headerlink" href="#authenticating-an-account" title="Permalink to this headline">¶</a></h3>
<p>After an Account resource has been created, you can authenticate it given an input of a <code class="docutils literal"><span class="pre">username</span></code>/<code class="docutils literal"><span class="pre">email</span></code> and a <code class="docutils literal"><span class="pre">password</span></code> from the end-user. When authentication occurs, you are authenticating an Account within a specific Application against that Application’s Organizations, Directories and Groups (more on that <a class="reference internal" href="#how-login-works"><span>below</span></a>). The key point is that the Application resource is the starting point for authentication attempts.</p>
<p>Once you have the Application resource you may attempt authentication by sending a POST request to the Application’s <code class="docutils literal"><span class="pre">/loginAttempts</span></code> endpoint and providing a base64 encoded <code class="docutils literal"><span class="pre">username</span></code>/<code class="docutils literal"><span class="pre">email</span></code> and <code class="docutils literal"><span class="pre">password</span></code> pair that is separated with a colon (for example <code class="docutils literal"><span class="pre">testuser</span></code>:<code class="docutils literal"><span class="pre">testpassword</span></code>). Stormpath requires that the <code class="docutils literal"><span class="pre">username</span></code>/<code class="docutils literal"><span class="pre">email</span></code> and <code class="docutils literal"><span class="pre">password</span></code> are base64 encoded so that these values are not passed as clear text. For more information about the <code class="docutils literal"><span class="pre">/loginAttempts</span></code> endpoint please see the <a class="reference internal" href="reference.html#ref-loginattempts"><span>Reference Chapter</span></a>.</p>
<p>So, if you had a user Account &#8220;Han Solo&#8221; in the &#8220;Captains&#8221; Directory, and you wanted to log him in, you would first need to take the combination of his <code class="docutils literal"><span class="pre">username</span></code> and <code class="docutils literal"><span class="pre">password</span></code> (&#8220;first2shoot:Change+me1&#8221;) and then Base64 encode them: <code class="docutils literal"><span class="pre">Zmlyc3Qyc2hvb3Q6Q2hhbmdlK21lMQ==</span></code>.</p>
<p>You would issue the following POST to your Application with ID <code class="docutils literal"><span class="pre">1gk4Dxzi6o4PbdleXaMPLE</span></code>:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/applications/1gk4Dxzi6o4PbdleXaMPLE/loginAttempts</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;basic&quot;</span><span class="p">,</span>
  <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;Zmlyc3Qyc2hvb3Q6Q2hhbmdlK21lMQ==&quot;</span><span class="p">,</span>
  <span class="nt">&quot;accountStore&quot;</span><span class="p">:</span> <span class="p">{</span>
     <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/directories/2SKhstu8PlaekcaEXampLE&quot;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You are using the Base64 encoded <code class="docutils literal"><span class="pre">value</span></code> from above, and (optionally) specifying that the Account can be found in the &#8220;Captains&#8221; Directory from <a class="reference internal" href="accnt_mgmt.html#about-cloud-dir"><span>earlier</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>It is also possible to specify a Group or Organization&#8217;s <code class="docutils literal"><span class="pre">href</span></code> or an Organization&#8217;s <code class="docutils literal"><span class="pre">nameKey</span></code> instead of an Directory&#8217;s. Passing a <code class="docutils literal"><span class="pre">nameKey</span></code> would look like this:</p>
<div class="last highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/applications/1gk4Dxzi6o4PbdleXaMPLE/loginAttempts</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
  <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;basic&quot;</span><span class="p">,</span>
  <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;YWxhbkBzbWl0aGVlZS5jb206UGFzcexample&quot;</span><span class="p">,</span>
  <span class="nt">&quot;accountStore&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;nameKey&quot;</span><span class="p">:</span><span class="s2">&quot;anOrgNameKey&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>On success you would get back the <code class="docutils literal"><span class="pre">href</span></code> for the &#8220;Han Solo&#8221; Account:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://api.stormpath.com/v1/accounts/72EaYgOaq8lwTFHILydAid</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;account&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/72EaYgOaq8lwTFHILydAid&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The reason this succeeds is because there is an existing <strong>Account Store Mapping</strong> between the &#8220;Han Solo&#8221; Account&#8217;s &#8220;Captains&#8221; Directory and your Application. This mapping is what allows this Account to log in to the Application.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Instead of just receiving an Account&#8217;s <code class="docutils literal"><span class="pre">href</span></code> after successful authentication, it is possible to receive the full Account resource in the JSON response body. To do this, simply add the <strong>expand=account</strong> parameter to the end of your authentication query:</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">https://api.stormpath.com/v1/applications/$YOUR_APPLICATION_ID/loginAttempts?expand=account</span></code></div></blockquote>
<p class="last">For more information about link expansion, please see <a class="reference internal" href="reference.html#about-links"><span>the Reference chapter</span></a>.</p>
</div>
<div class="section" id="how-login-attempts-work-in-stormpath">
<span id="how-login-works"></span><h4><a class="toc-backref" href="#id23">4.1.2. How Login Attempts Work in Stormpath</a><a class="headerlink" href="#how-login-attempts-work-in-stormpath" title="Permalink to this headline">¶</a></h4>
<p>When the &#8220;Han Solo&#8221; Account tries to log in to the Application, the user submits a request to the Application’s <code class="docutils literal"><span class="pre">/loginAttempts</span></code> endpoint. Stormpath then consults the Application’s assigned <strong>Account Stores</strong> (Organizations, Directories, and Groups) in the order that they are assigned to the Application. When a matching Account is discovered in a mapped Account Store, it is used to verify the authentication attempt and all subsequent Account Stores are ignored. In other words, Accounts are matched for Application login based on a &#8220;first match wins&#8221; policy.</p>
<p>Let&#8217;s look at an example to illustrate this behavior. Assume that two Account Stores, a &#8220;Customers&#8221; Directory and an &#8220;Employees&#8221; Directory, have been assigned (mapped) to a &#8220;Foo&#8221; application. &#8220;Customers&#8221; was assigned first, and &#8220;Employees&#8221; was assigned next, and this will dictate the order in which they are checked.</p>
<p>The following flow chart shows what happens when an Account attempts to log in to the Foo application:</p>
<div class="figure align-center" id="id18">
<a class="reference internal image-reference" href="_images/LoginAttemptFlow.png"><img alt="Login Attempt Flow" src="_images/LoginAttemptFlow.png" /></a>
<p class="caption"><span class="caption-text"><em>The Login Attempt Flow</em></span></p>
</div>
<p>As you can see, Stormpath tries to find the Account in the &#8220;Customers&#8221; Directory first because it has a higher priority than the &#8220;Employees&#8221; directory. If not found, the &#8220;Employees&#8221; Directory is tried next as it has a lower priority.</p>
<p>You can map multiple Account Stores to an Application, but only one is required to enable login for an Application. Mapping multiple Account Stores to an Application, as well as configuring their priority, allows you precise control over the Account populations that may log in to your Application.</p>
</div>
</div>
<div class="section" id="manage-who-can-log-into-your-application">
<span id="managing-login"></span><h3><a class="toc-backref" href="#id24">4.1.3. Manage Who Can Log Into Your Application</a><a class="headerlink" href="#manage-who-can-log-into-your-application" title="Permalink to this headline">¶</a></h3>
<p>As is hopefully evident by now, controlling which Accounts can log in to your Application is largely a matter of manipulating the Application&#8217;s Account Store Mappings.</p>
<p>For more detailed information about this resource, please see the <a class="reference internal" href="reference.html#ref-asm"><span>Account Store Mapping</span></a> section of the Reference chapter.</p>
<p>The reason why your user &#8220;Han Solo&#8221; was able to log in to your application is because the Application resource that represents your application and your &#8220;Captains&#8221; Directory are mapped to one another by an <strong>Account Store Mapping</strong>.</p>
<p>You can find this mapping by sending a <code class="docutils literal"><span class="pre">GET</span></code> to your Application&#8217;s <code class="docutils literal"><span class="pre">/accountStoreMappings</span></code> endpoint, which would yield the following response:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/v1/applications/1gk4Dxzi6o4PbdleXaMPLE/accountStoreMappings&quot;</span><span class="p">,</span>
  <span class="nt">&quot;offset&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span>
  <span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
  <span class="nt">&quot;items&quot;</span><span class="p">:[</span>
    <span class="p">{</span>
      <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/v1/accountStoreMappings/5WKhSDXNR8Wiksjv808XHp&quot;</span><span class="p">,</span>
      <span class="nt">&quot;listIndex&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
      <span class="nt">&quot;isDefaultAccountStore&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
      <span class="nt">&quot;isDefaultGroupStore&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
      <span class="nt">&quot;application&quot;</span><span class="p">:{</span>
        <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/v1/applications/1gk4Dxzi6o4PbdleXaMPLE&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;accountStore&quot;</span><span class="p">:{</span>
        <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/v1/directories/2SKhstu8Plaekcai8lghrp&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Any new Accounts and Groups added to this Application via it&#8217;s <cite>/accounts</cite> and <cite>/groups</cite> endpoints will be added to this Directory by default, since <code class="docutils literal"><span class="pre">isDefaultAccountStore</span></code> and <code class="docutils literal"><span class="pre">isDefaultGroupStore</span></code> are both set to <code class="docutils literal"><span class="pre">true</span></code>.</p>
</div>
<div class="section" id="mapping-a-new-account-store">
<span id="create-asm"></span><h4><a class="toc-backref" href="#id25">Mapping a new Account Store</a><a class="headerlink" href="#mapping-a-new-account-store" title="Permalink to this headline">¶</a></h4>
<p>We would now like to map a new Account Store that will have the following characteristics:</p>
<ol class="arabic simple">
<li>It will have the highest login priority. This means that it will be consulted first during <a class="reference internal" href="#how-login-works"><span>the login process</span></a>, before any other Account Stores.</li>
<li>It will be the default Account Store for any new Accounts.</li>
<li>It will be the default Group Store for any new Groups.</li>
</ol>
<p>To accomplish this, you will send a <code class="docutils literal"><span class="pre">POST</span></code>:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">v1/accountStoreMappings</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;listIndex&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;isDefaultAccountStore&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nt">&quot;isDefaultGroupStore&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nt">&quot;application&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/applications/1gk4Dxzi6o4PbdleXaMPLE&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;accountStore&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/directories/2SKhstu8PlaekcaEXampLE&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You are mapping the Application (id: <code class="docutils literal"><span class="pre">1gk4Dxzi6o4PbdleXaMPLE</span></code>) to a new Directory (id: <code class="docutils literal"><span class="pre">2SKhstu8PlaekcaEXampLE</span></code>). Additionally, you are setting</p>
<ol class="arabic simple">
<li>the login priority to the highest priority, by sending a <code class="docutils literal"><span class="pre">listIndex</span></code> of <code class="docutils literal"><span class="pre">0</span></code>.</li>
<li><code class="docutils literal"><span class="pre">isDefaultAccountStore</span></code> to <code class="docutils literal"><span class="pre">true</span></code> and</li>
<li><code class="docutils literal"><span class="pre">isDefaultGroupStore</span></code> to <code class="docutils literal"><span class="pre">true</span></code> as well.</li>
</ol>
<p>So by sending a <code class="docutils literal"><span class="pre">POST</span></code> with these contents, you are able to create a new Account Store Mapping that supersedes the old one.</p>
<p>If you go back to the example from the <a class="reference internal" href="accnt_mgmt.html#account-mgmt"><span>Account Management chapter</span></a>, you can see the Account Store Mapping between the Directory and the Application. This now means that the Captain&#8217;s Account in the Directory will now be able to log in to the Application.</p>
<div class="figure align-center">
<img alt="&lt;ERD with accountStoreMapping&gt;" src="_images/authn_asm_erd.png" />
</div>
</div>
<div class="section" id="updating-an-existing-account-store">
<h4><a class="toc-backref" href="#id26">Updating an Existing Account Store</a><a class="headerlink" href="#updating-an-existing-account-store" title="Permalink to this headline">¶</a></h4>
<p>Updating an existing Account Store simply involves sending a request with the attributes that you would like to update.</p>
<p><strong>Changing Login Priority</strong></p>
<p>For example, if you want to update an existing Account Store to now have highest login priority, send this request that sets the Mapping&#8217;s list index value as <code class="docutils literal"><span class="pre">0</span></code>:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/accountStoreMappings/1NUhrCPT0q66bjyexample</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
  <span class="nt">&quot;listIndex&quot;</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The accountStoreMapping resource will be updated and all of the other Account Stores will have their <code class="docutils literal"><span class="pre">listIndex</span></code> incremented up by 1.</p>
<p><strong>Changing the Default Account or Group Store</strong></p>
<p>Setting an Account Store Mapping as the default Account or Group store would automatically supersede any other Account Store Mapping. Any other mapping that had previously been the default would have the &#8220;true&#8221; flag switched to &#8220;false&#8221;.</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/accountStoreMappings/1NUhrCPT0q66bjyexample</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
    <span class="nt">&quot;isDefaultAccountStore&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
    <span class="nt">&quot;isDefaultGroupStore&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Setting an Account Store Mapping&#8217;s Default Group/Account Store flag to <code class="docutils literal"><span class="pre">false</span></code> will <strong>not</strong> automatically set another Default Group/Account Store flag <code class="docutils literal"><span class="pre">true</span></code>. You are responsible for setting this yourself if you would like your Application to create new Accounts/Groups.</p>
</div>
</div>
</div>
</div>
<div class="section" id="how-token-based-authentication-works">
<span id="token-authn"></span><h2>4.2. How Token-Based Authentication Works<a class="headerlink" href="#how-token-based-authentication-works" title="Permalink to this headline">¶</a></h2>
<div class="contents local topic" id="id1">
<ul class="simple">
<li><a class="reference internal" href="#introduction-to-token-based-authentication" id="id27">4.2.1. Introduction to Token-Based Authentication</a><ul>
<li><a class="reference internal" href="#why-oauth-2-0" id="id28">Why OAuth 2.0?</a></li>
<li><a class="reference internal" href="#what-tokens-are-available-for-token-based-authentication" id="id29">What Tokens Are Available for Token-Based Authentication?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-stormpath-for-token-based-authentication" id="id30">4.2.2. Using Stormpath for Token-Based Authentication</a><ul>
<li><a class="reference internal" href="#configuring-token-based-authentication" id="id31">Configuring Token-Based Authentication</a></li>
<li><a class="reference internal" href="#generating-an-oauth-2-0-access-token" id="id32">Generating an OAuth 2.0 Access Token</a></li>
<li><a class="reference internal" href="#validating-an-access-token" id="id33">Validating an Access Token</a></li>
<li><a class="reference internal" href="#refreshing-access-tokens" id="id34">Refreshing Access Tokens</a></li>
<li><a class="reference internal" href="#revoking-access-and-refresh-tokens" id="id35">Revoking Access and Refresh Tokens</a></li>
</ul>
</li>
</ul>
</div>
<p>In this section, you will discuss how to use Stormpath to generate and manage OAuth 2.0 Access Token.</p>
<div class="section" id="introduction-to-token-based-authentication">
<h3><a class="toc-backref" href="#id27">4.2.1. Introduction to Token-Based Authentication</a><a class="headerlink" href="#introduction-to-token-based-authentication" title="Permalink to this headline">¶</a></h3>
<p>Since HTTP is considered a stateless protocol, if your application authenticates a user for one HTTP request, a problem arises when the next request is sent and your application doesn&#8217;t know who the user is. This is why many applications today pass some information to tie the request to a user. Traditionally, this requires <strong>Server-based authentication</strong>, where state is stored on the server and only a session identifier is stored on the client.</p>
<p><strong>Token-based authentication</strong> is an alternate, stateless strategy. With token-based authentication, you secure an application based on a security token that is generated for the user on authentication and then stored on the client-side. Token-based Authentication is all about removing the need to store information on the server while giving extra security to keep the token secure on the client. This helps you as a developer build stateless and scalable applications.</p>
<p>Stormpath&#8217;s approach to token-based authentication has two elements: JSON Web Tokens (JWTs) for authentication, and OAuth 2.0 for authorization.</p>
<div class="section" id="why-oauth-2-0">
<h4><a class="toc-backref" href="#id28">Why OAuth 2.0?</a><a class="headerlink" href="#why-oauth-2-0" title="Permalink to this headline">¶</a></h4>
<p>OAuth 2.0 is an authorization framework and provides a protocol to interact with a service that can delegate authentication or provide authorization. Its primary advantage as a standard is its wide adoption rate across many mobile and web applications today. If you have ever logged-in to a website using Facebook or Google, you have used one of OAuth 2.0&#8217;s many authorization flows. You can read more about the different OAuth 2.0 authorization flows or grant types in depth on <a class="reference external" href="https://stormpath.com/blog/what-the-heck-is-oauth/">Stormpath’s blog</a>.</p>
<p>Even though OAuth 2.0 has many authorization modes or &#8220;grant types&#8221;, Stormpath currently supports the following:</p>
<ul class="simple">
<li><strong>Password Grant Type:</strong> Provides the ability to get an Access Token based on a login and password.</li>
<li><strong>Client Credentials Grant Type</strong>: Provides the ability to exchange an API Key for an Access Token.</li>
<li><strong>Social Grant Type:</strong> Allows you to exchange a user&#8217;s social Access Token or Authorization Code</li>
<li><strong>Refresh Grant Type:</strong> Provides the ability to generate another Access Token based on a special Refresh Token.</li>
<li><strong>Stormpath Factor Challenge Grant Type:</strong> Provides the ability to generate an Access Token with a Multi-Factor Authentication challenge code</li>
</ul>
<p>To understand how to use Token-based Authentication, you need to talk about the different types of tokens that are available. To see how to generate an OAuth token, see <a class="reference internal" href="#generate-oauth-token"><span>below</span></a>.</p>
</div>
<div class="section" id="what-tokens-are-available-for-token-based-authentication">
<h4><a class="toc-backref" href="#id29">What Tokens Are Available for Token-Based Authentication?</a><a class="headerlink" href="#what-tokens-are-available-for-token-based-authentication" title="Permalink to this headline">¶</a></h4>
<p>For Token Based Authentication, there are a two different types of tokens that need to be managed. These are:</p>
<ul class="simple">
<li>Access Token</li>
<li>Refresh Token</li>
</ul>
<p>The <strong>Access Token</strong> is what grants access to a protected resource. The Access Token that Stormpath generates for Accounts on authentication is a <strong>JSON Web Token</strong>, or JWT. The JWT has security built-in to make sure that the Access Token is not tampered with on the client, and is only valid for a specified duration.</p>
<p>The <strong>Refresh Token</strong> is a special token that is used to generate additional Access Tokens. This allows you to have an short-lived Access Token without having to collect credentials every single time you need a new Access Token.</p>
<p>When using OAuth 2.0, the Access Token and Refresh Token are returned in the same response during the token exchange, this is called an <strong>Access Token Response</strong>.</p>
</div>
</div>
<div class="section" id="using-stormpath-for-token-based-authentication">
<span id="token-authn-config"></span><h3><a class="toc-backref" href="#id30">4.2.2. Using Stormpath for Token-Based Authentication</a><a class="headerlink" href="#using-stormpath-for-token-based-authentication" title="Permalink to this headline">¶</a></h3>
<p>Stormpath can be used to generate, manage, check, and revoke both Access and Refresh Tokens. Before diving in, let&#8217;s talk about configuration.</p>
<div class="section" id="configuring-token-based-authentication">
<h4><a class="toc-backref" href="#id31">Configuring Token-Based Authentication</a><a class="headerlink" href="#configuring-token-based-authentication" title="Permalink to this headline">¶</a></h4>
<p>Stormpath is configurable so you can set the time to live (TTL) for both the Access and Refresh tokens. This is important for many applications because it gives the ability to define how the tokens expire. For example, you could decide that your application requires a user to log in daily, but the access should only live for 10 minutes. Or, you could decide that for your application, users should be able to stay logged-in for two months and the access token expires in an hour.</p>
<p>Each Application resource in Stormpath has an associated <a class="reference external" href="ref-oauth-policy">OAuth Policy resource</a> where the TTLs for a particular Application&#8217;s tokens are stored:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/oAuthPolicies/1gk4Dxzi6o4PbdleXaMPLE&quot;</span><span class="p">,</span>
    <span class="nt">&quot;accessTokenTtl&quot;</span><span class="p">:</span> <span class="s2">&quot;PT1H&quot;</span><span class="p">,</span>
    <span class="nt">&quot;refreshTokenTtl&quot;</span><span class="p">:</span> <span class="s2">&quot;P60D&quot;</span><span class="p">,</span>
    <span class="nt">&quot;comment&quot;</span><span class="p">:</span><span class="s2">&quot; // This JSON has been truncated for readability&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The values for both properties are stored as <a class="reference external" href="https://en.wikipedia.org/wiki/ISO_8601#Durations">ISO 8601 Durations</a>. By <strong>default</strong>, the TTL for the Access Token is 1 hour and the Refresh Token&#8217;s is 60 days. The maximum value for both is 10 years and 1 day (<code class="docutils literal"><span class="pre">P10Y</span></code>), while the minimum value is 1 second (<code class="docutils literal"><span class="pre">PT1S</span></code>).</p>
<p>If you wanted to change the TTL for the Access Token to 30 minutes and the Refresh Token to 7 days, you could send the following request:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/oAuthPolicies/1gk4Dxzi6o4PbdleXaMPLE</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;accessTokenTtl&quot;</span><span class="p">:</span> <span class="s2">&quot;PT30M&quot;</span><span class="p">,</span>
  <span class="nt">&quot;refreshTokenTtl&quot;</span><span class="p">:</span> <span class="s2">&quot;P7D&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>And you would get the following response:</p>
<div class="highlight-HTTP"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://api.stormpath.com/v1/oAuthPolicies/1gk4Dxzi6o4PbdleXaMPLE</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/oAuthPolicies/1gk4Dxzi6o4PbdleXaMPLE&quot;</span><span class="p">,</span>
  <span class="nt">&quot;accessTokenTtl&quot;</span><span class="p">:</span> <span class="s2">&quot;PT30M&quot;</span><span class="p">,</span>
  <span class="nt">&quot;refreshTokenTtl&quot;</span><span class="p">:</span> <span class="s2">&quot;P7D&quot;</span><span class="p">,</span>
  <span class="nt">&quot;comment&quot;</span><span class="p">:</span><span class="s2">&quot; // This JSON has been truncated for readability&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Refresh Tokens are optional. If you would like to disable the Refresh Token from being generated, set a duration value of 0 (e.g. <code class="docutils literal"><span class="pre">PT0M</span></code>).</p>
</div>
</div>
<div class="section" id="generating-an-oauth-2-0-access-token">
<span id="generate-oauth-token"></span><h4><a class="toc-backref" href="#id32">Generating an OAuth 2.0 Access Token</a><a class="headerlink" href="#generating-an-oauth-2-0-access-token" title="Permalink to this headline">¶</a></h4>
<p>Stormpath can generate a brand new Access Token using the above-mentioned OAuth 2.0 grant types. This means that you can generate a new Access Token with:</p>
<ul class="simple">
<li><strong>Client Credentials Grant Type:</strong> a client&#8217;s credentials (e.g. Client ID and Secret)</li>
<li><strong>Social Grant Type:</strong> a user&#8217;s social login Access Token or Authorization Code</li>
<li><strong>Password Grant Type:</strong> a user&#8217;s credentials (e.g. username and password)</li>
<li><strong>Stormpath Factor Challenge Type:</strong> a Stormpath Challenge <code class="docutils literal"><span class="pre">href</span></code> and <code class="docutils literal"><span class="pre">code</span></code></li>
<li><strong>Refresh Grant Type:</strong> For information about using the an OAuth Refresh token <a class="reference internal" href="#refresh-oauth-token"><span>see below</span></a></li>
</ul>
<p>The recommended way of generating an OAuth token now is to using the Client API. For more information on this, please see <a class="reference external" href="https://docs.stormpath.com/client-api/product-guide/latest/authentication.html#oauth-2-0-login">the Client API Guide&#8217;s Authentication chapter</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The older, alternate way of generating an OAuth 2.0 token is documented <a class="reference internal" href="appendix.html#generate-oauth-token-old"><span>here</span></a>.</p>
</div>
</div>
<div class="section" id="validating-an-access-token">
<h4><a class="toc-backref" href="#id33">Validating an Access Token</a><a class="headerlink" href="#validating-an-access-token" title="Permalink to this headline">¶</a></h4>
<p>Once an Access Token has been generated, you have taken care of the Authentication part of your workflow. Now, the OAuth token can be used to authorize individual requests that the user makes. To do this, the client will need to pass it to your application.</p>
<p>For example, if you have a route <code class="docutils literal"><span class="pre">https://yourapplication.com/secure-resource</span></code>, the client would request authorization to access the resource by passing the access token as follows:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/secure-resource</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">https://yourapplication.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Bearer eyJraWQiOiIyWkZNV[...]dkhEZ2Z0THJ4Slp3dFExc2hFaTl2In0.xlCXL7UUVnMoBKj0p0bXM_cnraWo5Io-TvUt2WBOl3k</span>
</pre></div>
</div>
<p>Once your application receives the request, the first thing to do is to validate the token, either using Stormpath, or using local application-side logic. The benefit of using Stormpath to validate the token through the REST API (or an SDK that is using the REST API) is that Stormpath can validate the token against the state of your Application and Account resources. To illustrate the difference:</p>
<table border="1" class="docutils">
<colgroup>
<col width="67%" />
<col width="17%" />
<col width="17%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Validation Criteria</th>
<th class="head">Locally</th>
<th class="head">Stormpath</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Token hasn&#8217;t been tampered with</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>Token hasn&#8217;t expired</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>Token hasn&#8217;t been revoked</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>Account hasn&#8217;t been disabled or deleted</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>Issuer is Stormpath</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>Issuing Application is still enabled, and hasn&#8217;t been deleted</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>Account is still in an Account Store for the issuing Application</td>
<td>No</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<p>It is up to you to determine which kind of validation is important for your application. If you need to validate the state of the Account and/or Application resources, or if you need to use token revocation, then using Stormpath to validate the token is the obvious choice. If you only require that the token has not expired and has not been tampered with, you can validate the token locally and minimize the network requests to Stormpath.</p>
<div class="section" id="using-stormpath-to-validate-tokens">
<span id="about-token-validation"></span><h5>Using Stormpath to Validate Tokens<a class="headerlink" href="#using-stormpath-to-validate-tokens" title="Permalink to this headline">¶</a></h5>
<p>To see how to validate tokens with Stormpath, let&#8217;s go back to the example where a user has already generated an access token.</p>
<p>To recap, you have done the following:</p>
<ol class="arabic simple">
<li>Sent a POST to <code class="docutils literal"><span class="pre">https://api.stormpath.com/v1/applications/$YOUR_APPLICATION_ID/oauth/token</span></code> with a body that included information about the OAuth Grant Type you wanted, as well as your user&#8217;s username and password.</li>
<li>Received back an <strong>Access Token Response</strong>, which contained - among other things - an <strong>Access Token</strong> in JWT format.</li>
</ol>
<p>The user now attempts to access a secured resource by passing the <code class="docutils literal"><span class="pre">access_token</span></code> JWT value from the Access Token Response in the <code class="docutils literal"><span class="pre">Authorization</span></code> header:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/secure-resource</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">https://yourapplication.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Bearer eyJraWQiOiIyWkZNVjRXV[...]</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">Authorization</span></code> header contains the Access Token. To validate this Token with Stormpath, you can issue an HTTP GET to your Stormpath Application’s <code class="docutils literal"><span class="pre">/authTokens/</span></code> endpoint with the JWT token:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>https://api.stormpath.com/v1/applications/$YOUR_APPLICATION_ID/authTokens/eyJraWQiOiIyWkZNVjRXV[...]
</pre></div>
</div>
<p>If the access token can be validated, Stormpath will return a 302 to the Access Token resource:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Location Found</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://api.stormpath.com/v1/accessTokens/6zVrviSEIf26ggXdJG097f</span>
</pre></div>
</div>
<p>With the confirmation that the token is valid, you can now allow the user to access the secured resource that they requested.</p>
</div>
<div class="section" id="validating-the-token-locally">
<h5>Validating the Token Locally<a class="headerlink" href="#validating-the-token-locally" title="Permalink to this headline">¶</a></h5>
<p>Local validation would also begin at the point of the request to a secure resource:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/secure-resource</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">https://yourapplication.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Bearer eyJraWQiOiIyWkZNVjRXV[...]</span>
</pre></div>
</div>
<p>The token specified in the Authorization header has been digitally signed with the Stormpath API Key Secret that was used to generate the token.</p>
<p>This means that you can use a JWT library for your specific language to validate the token locally if necessary. For more information, please see one of our <a class="reference external" href="https://docs.stormpath.com/home/">Integration Guides</a>.</p>
</div>
</div>
<div class="section" id="refreshing-access-tokens">
<span id="refresh-oauth-token"></span><h4><a class="toc-backref" href="#id34">Refreshing Access Tokens</a><a class="headerlink" href="#refreshing-access-tokens" title="Permalink to this headline">¶</a></h4>
<p>In the event that the Access Token expires, the user can generate a new one using the Refresh Token without re-entering their credentials.</p>
<p>To use this Refresh Token, you make an HTTP POST to your Applications <code class="docutils literal"><span class="pre">/oauth/token</span></code> endpoint with it and you will get a new token back.</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/applications/$YOUR_APPLICATION_ID/oauth/token</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>

grant_type=refresh_token&amp;refresh_token=eyJraWQiOiIyWkZNVjRXVlZDVkczNVhBVElJOVQ5Nko3IiwiYWxnIjoiSFMyNTYifQ.eyJqdGkiOiIxdkhEZ2Z0THJ4Slp3dFExc2hFaTl2IiwiaWF0IjoxNDQxMTE4Nzk2LCJpc3MiOiJodHRwczovL2FwaS5zdG9ybXBhdGguY29tL3YxL2FwcGxpY2F0aW9ucy8xZ2s0RHh6aTZvNFBiZGxCVmE2dGZSIiwic3ViIjoiaHR0cHM6Ly9hcGkuc3Rvcm1wYXRoLmNvbS92MS9hY2NvdW50cy8zYXBlbll2TDBaOXY5c3BkenBGZmV5IiwiZXhwIjoxNDQxNzIzNTk2fQ.xUjcxTZhWx74aa6adnUXjuvUgqjC8TvvrB7cBEmNF_g
</pre></div>
</div>
<p>This would be the response:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>

{
  &quot;access_token&quot;: &quot;eyJraWQiOiIyWkZNVjRXVlZDVkczNVhBVElJOVQ5Nko3IiwiYWxnIjoiSFMyNTYifQ.eyJqdGkiOiI2TnJXSXM1aWttSVBWSkNuMnA0bnJyIiwiaWF0IjoxNDQxMTMzNjQ1LCJpc3MiOiJodHRwczovL2FwaS5zdG9ybXBhdGguY29tL3YxL2FwcGxpY2F0aW9ucy8xZ2s0RHh6aTZvNFBiZGxCVmE2dGZSIiwic3ViIjoiaHR0cHM6Ly9hcGkuc3Rvcm1wYXRoLmNvbS92MS9hY2NvdW50cy8zYXBlbll2TDBaOXY5c3BkenBGZmV5IiwiZXhwIjoxNDQxMTM1NDQ1LCJydGkiOiIxdkhEZ2Z0THJ4Slp3dFExc2hFaTl2In0.SbSmuPz0-v4J2BO9-lpyz_2_T62mSB1ql_0IMrftpgg&quot;,
  &quot;refresh_token&quot;: &quot;eyJraWQiOiIyWkZNVjRXVlZDVkczNVhBVElJOVQ5Nko3IiwiYWxnIjoiSFMyNTYifQ.eyJqdGkiOiIxdkhEZ2Z0THJ4Slp3dFExc2hFaTl2IiwiaWF0IjoxNDQxMTE4Nzk2LCJpc3MiOiJodHRwczovL2FwaS5zdG9ybXBhdGguY29tL3YxL2FwcGxpY2F0aW9ucy8xZ2s0RHh6aTZvNFBiZGxCVmE2dGZSIiwic3ViIjoiaHR0cHM6Ly9hcGkuc3Rvcm1wYXRoLmNvbS92MS9hY2NvdW50cy8zYXBlbll2TDBaOXY5c3BkenBGZmV5IiwiZXhwIjoxNDQxNzIzNTk2fQ.xUjcxTZhWx74aa6adnUXjuvUgqjC8TvvrB7cBEmNF_g&quot;,
  &quot;token_type&quot;: &quot;Bearer&quot;,
  &quot;expires_in&quot;: 1800,
  &quot;stormpath_access_token_href&quot;: &quot;https://api.stormpath.com/v1/accessTokens/6NrWIs5ikmIPVJCn2p4nrr&quot;
}
</pre></div>
</div>
<p>Note that this response contains the same Refresh Token as was in the request. This is because when Stormpath generates a new Access Token for a Refresh Token it does not generate a new Refresh token, nor does it modify its expiration time. This means that once the Refresh Token expires, the user must authenticate again to get a new Access and Refresh Tokens.</p>
</div>
<div class="section" id="revoking-access-and-refresh-tokens">
<h4><a class="toc-backref" href="#id35">Revoking Access and Refresh Tokens</a><a class="headerlink" href="#revoking-access-and-refresh-tokens" title="Permalink to this headline">¶</a></h4>
<p>There are cases where you might want to revoke the Access and Refresh Tokens that you have generated for a user. For example:</p>
<ul class="simple">
<li>The user has explicitly logged out, and your application needs to revoke their access, requiring re-authentication.</li>
<li>The application, device, and/or client has been compromised and you need to revoke tokens for an Account.</li>
</ul>
<p>To revoke the tokens, all you have to do is delete the Account&#8217;s <code class="docutils literal"><span class="pre">/accessTokens/:accessTokenId</span></code> resource.</p>
<p>First, you retrieve an Account&#8217;s Access and Refresh tokens. To do this, make an HTTP GET call for the Account information, then you will find the tokens inside the <code class="docutils literal"><span class="pre">/accessTokens</span></code> and <code class="docutils literal"><span class="pre">/refreshTokens</span></code> collections:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/3apenYvL0Z9v9spdzpFfey&quot;</span><span class="p">,</span>
  <span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;jlpicard&quot;</span><span class="p">,</span>
  <span class="nt">&quot;comment&quot;</span><span class="p">:</span><span class="s2">&quot; // This JSON has been truncated for readability&quot;</span><span class="p">,</span>
  <span class="nt">&quot;accessTokens&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/3apenYvL0Z9v9spdzpFfey/accessTokens&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;refreshTokens&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/3apenYvL0Z9v9spexample/refreshTokens&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you then perform a GET on the <code class="docutils literal"><span class="pre">accessTokens</span></code> link, you will get back the individual tokens:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/3apenYvL0Z9v9spexample/accessTokens&quot;</span><span class="p">,</span>
  <span class="nt">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
  <span class="nt">&quot;size&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&quot;items&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accessTokens/6NrWIs5ikmIPVJCexample&quot;</span><span class="p">,</span>
      <span class="nt">&quot;comment&quot;</span><span class="p">:</span><span class="s2">&quot; // This JSON has been truncated for readability&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>You can query the Access Tokens that an Account has for a specific Application by specifying the Application&#8217;s href as a URL parameter:</p>
<div class="last highlight-bash"><div class="highlight"><pre><span></span>curl --request GET <span class="se">\</span>
--user <span class="nv">$SP_API_KEY_ID</span>:<span class="nv">$SP_API_KEY_SECRET</span> <span class="se">\</span>
--header <span class="s1">&#39;content-type: application/json&#39;</span> <span class="se">\</span>
--url <span class="s2">&quot;https://api.stormpath.com/v1/accounts/3apenYvL0Z9v9spexample//accessTokens?application.href=https://api.stormpath.com/v1/applications/1p4R1r9UBMQz0e5EXAMPLE&quot;</span>
</pre></div>
</div>
</div>
<p>To revoke the token, send the following request:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/v1/accessTokens/6NrWIs5ikmIPVJCexample</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
</pre></div>
</div>
<p>You will get back a <code class="docutils literal"><span class="pre">204</span> <span class="pre">No</span> <span class="pre">Content</span></code> response back from Stormpath when the call succeeds.</p>
</div>
</div>
</div>
<div class="section" id="how-social-authentication-works">
<span id="social-authn"></span><h2>4.3. How Social Authentication Works<a class="headerlink" href="#how-social-authentication-works" title="Permalink to this headline">¶</a></h2>
<div class="contents local topic" id="id5">
<ul class="simple">
<li><a class="reference internal" href="#attribute-mappings" id="id36">Attribute Mappings</a></li>
<li><a class="reference internal" href="#scopes" id="id37">Scopes</a></li>
<li><a class="reference internal" href="#social-login-providers" id="id38">Social Login Providers</a><ul>
<li><a class="reference internal" href="#google" id="id39">4.3.1. Google</a></li>
<li><a class="reference internal" href="#facebook" id="id40">4.3.2. Facebook</a></li>
<li><a class="reference internal" href="#github" id="id41">4.3.3. Github</a></li>
<li><a class="reference internal" href="#linkedin" id="id42">4.3.4 LinkedIn</a></li>
<li><a class="reference internal" href="#twitter" id="id43">4.3.5. Twitter</a></li>
<li><a class="reference internal" href="#generic-oauth-2-0-login" id="id44">4.3.6. Generic OAuth 2.0 Login</a></li>
</ul>
</li>
</ul>
</div>
<p>Social authentication essentially means using the &#8220;Log in with x&#8221; button in your application, where &#8220;x&#8221; is a Social Login Provider of some kind. There are a number of Social Login Providers that Stormpath supports out-of-the-box:</p>
<ul class="simple">
<li><a class="reference internal" href="#authn-google"><span>Google</span></a></li>
<li><a class="reference internal" href="#authn-facebook"><span>Facebook</span></a></li>
<li><a class="reference internal" href="#authn-github"><span>Github</span></a></li>
<li><a class="reference internal" href="#authn-linkedin"><span>LinkedIn</span></a></li>
<li><a class="reference internal" href="#authn-twitter"><span>Twitter</span></a></li>
</ul>
<p>However, Stormpath also supports the creation of Social Directories for so-called Generic OAuth Providers. These Directories should work with any Social Login Provider that provides an OAuth 2.0 flow. For more information about this, see <a class="reference internal" href="#authn-generic-oauth"><span>below</span></a>.</p>
<p>Social Directories are a kind of mirrored Directory, in that they are used to mirror user information found in an external database. This means that entities like Groups can only exist in a your Stormpath Social Directory if they are mirrored in from the external Social provider. For more information, please see the <a class="reference internal" href="accnt_mgmt.html#about-mirror-dir"><span>Account Management chapter</span></a>.</p>
<p><em>The Social Login Process</em></p>
<p>In general, the social login process works as follows:</p>
<ol class="arabic simple">
<li>The user who wishes to authenticate will click a &#8220;Log in with x&#8221; link.</li>
<li>The user authenticates and is asked by the Provider to accept the permissions required by your app.</li>
<li>Once the user accepts the permissions, the Provider sends back the user&#8217;s information</li>
<li>Stormpath will look for an Account in your application&#8217;s Directories that matches this information.</li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li>If a matching Account is found, Stormpath will return the existing Account&#8217;s <code class="docutils literal"><span class="pre">href</span></code>.</li>
<li>If a matching Account is not found, Stormpath will create one and return the new Account&#8217;s <code class="docutils literal"><span class="pre">href</span></code>.</li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="5">
<li>At this point, a language/framework-specific integration would use this <code class="docutils literal"><span class="pre">href</span></code> to create a Session for the user.</li>
</ol>
<p>As a developer, integrating Social Login into your application with Stormpath only requires three steps:</p>
<ol class="arabic simple">
<li>Create a Social Directory for your Provider.</li>
<li>Map the Directory as an Account Store to an Application resource. When an Account Store (in this case a Directory) is mapped to an Application, the Accounts in the AccountStore are considered the Application’s users and they can log in to it.</li>
<li>Include the appropriate social login button for that Provider, linking it to the Stormpath Client API&#8217;s <code class="docutils literal"><span class="pre">/authorize</span></code> endpoint. For more information about this, see below, or go to <a class="reference external" href="https://docs.stormpath.com/client-api/product-guide/latest/social_login.html">the Client API Guide</a>.</li>
</ol>
<div class="section" id="attribute-mappings">
<span id="social-authn-mappings"></span><h3><a class="toc-backref" href="#id36">Attribute Mappings</a><a class="headerlink" href="#attribute-mappings" title="Permalink to this headline">¶</a></h3>
<p>Each social provider returns their own specific information about a user. The returned information is stored inside that Account&#8217;s Provider Data in a <code class="docutils literal"><span class="pre">userInfo</span></code> object. This information can also be mapped to Stormpath Account attributes using mapping configured in the Directory Provider&#8217;s <code class="docutils literal"><span class="pre">userInfoMappingRules</span></code>.</p>
<p>For example, if we look at a Google user&#8217;s <code class="docutils literal"><span class="pre">userInfo</span></code>:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/v1/accounts/1Voi7LQ6NGnTPskjn9eZBA/providerData&quot;</span><span class="p">,</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span><span class="s2">&quot;2016-04-29T17:31:23.676Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span><span class="s2">&quot;2016-11-10T18:22:46.749Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;accessToken&quot;</span><span class="p">:</span><span class="s2">&quot;ya2[...]Nhs&quot;</span><span class="p">,</span>
  <span class="nt">&quot;providerId&quot;</span><span class="p">:</span><span class="s2">&quot;google&quot;</span><span class="p">,</span>
  <span class="nt">&quot;refreshToken&quot;</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;userInfo&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;123111111111111111234&quot;</span><span class="p">,</span>
    <span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="s2">&quot;jakub@stormpath.com&quot;</span><span class="p">,</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Jakub Swiatczak&quot;</span><span class="p">,</span>
    <span class="nt">&quot;firstName&quot;</span><span class="p">:</span><span class="s2">&quot;Jakub&quot;</span><span class="p">,</span>
    <span class="nt">&quot;lastName&quot;</span><span class="p">:</span><span class="s2">&quot;Swiatczak&quot;</span><span class="p">,</span>
    <span class="nt">&quot;link&quot;</span><span class="p">:</span><span class="s2">&quot;https://plus.google.com/1023540111341293534&quot;</span><span class="p">,</span>
    <span class="nt">&quot;profilePictureUrl&quot;</span><span class="p">:</span><span class="s2">&quot;https://lh4.googleusercontent.com/-8HcexamplekMuE/AAAAAAAAAAI/AAAAAAAAACI/VtAVULicGV4/photo.jpg&quot;</span><span class="p">,</span>
    <span class="nt">&quot;gender&quot;</span><span class="p">:</span><span class="s2">&quot;male&quot;</span><span class="p">,</span>
    <span class="nt">&quot;locale&quot;</span><span class="p">:</span><span class="kc">null</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can see that Google returns an attribute called &#8220;gender&#8221;. We can map this to a piece of Custom Data attached to the Account by creating a new rule in the Directory Provider&#8217;s <code class="docutils literal"><span class="pre">userInfoMappingRules</span></code>.</p>
<div class="highlight-html"><div class="highlight"><pre><span></span>POST /v1/userInfoMappingRules/3HuqEWMWi7wts1CEXAMPLE HTTP/1.1
Host: api.stormpath.com
Content-Type: application/json
Authorization: Basic MlpGT[...]xxdmk0

{
  &quot;items&quot;:[
    {
      &quot;name&quot;:&quot;gender&quot;,
      &quot;accountAttributes&quot;:[
        &quot;customData.gender&quot;
        ]
    }
    ]
}
</pre></div>
</div>
<p>The response is a <code class="docutils literal"><span class="pre">200</span> <span class="pre">OK</span></code> along with the User Info Mapping Rules:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/v1/userInfoMappingRules/3HuqEWMWi7wts1CEXAMPLE&quot;</span><span class="p">,</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span><span class="s2">&quot;2016-10-27T16:56:10.429Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span><span class="s2">&quot;2016-12-02T15:31:38.928Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;items&quot;</span><span class="p">:[</span>
    <span class="p">{</span>
      <span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;gender&quot;</span><span class="p">,</span>
      <span class="nt">&quot;accountAttributes&quot;</span><span class="p">:[</span>
        <span class="s2">&quot;customData.gender&quot;</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Any Accounts that log into this Directory will now have a new Custom Data value created and Google&#8217;s &#8220;gender&#8221; value will be placed in there.</p>
</div>
<div class="section" id="scopes">
<h3><a class="toc-backref" href="#id37">Scopes</a><a class="headerlink" href="#scopes" title="Permalink to this headline">¶</a></h3>
<p>The Directory&#8217;s Provider now has a <code class="docutils literal"><span class="pre">scope</span></code> array where you can define what Scopes are requested from the Social provider. These arrays have default values that are automatically included for each different kind of provider.</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="40%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Social Provider</th>
<th class="head">Default Scopes</th>
<th class="head">More Info</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Google</td>
<td><code class="docutils literal"><span class="pre">profile</span></code>, <code class="docutils literal"><span class="pre">email</span></code></td>
<td><a class="reference external" href="Google’sOAuthLoginScopesdocumentation">Google OAuth Scopes</a></td>
</tr>
<tr class="row-odd"><td>Facebook</td>
<td><code class="docutils literal"><span class="pre">public_profile</span></code>, <code class="docutils literal"><span class="pre">email</span></code></td>
<td><a class="reference external" href="https://developers.facebook.com/docs/facebook-login/permissions/">Permissions With Facebook Login</a></td>
</tr>
<tr class="row-even"><td>GitHub</td>
<td><code class="docutils literal"><span class="pre">user:email</span></code></td>
<td><a class="reference external" href="https://developer.github.com/v3/oauth/#scopes">GitHub OAuth Scopes</a></td>
</tr>
<tr class="row-odd"><td>LinkedIn</td>
<td><code class="docutils literal"><span class="pre">r_basicprofile</span></code>, <code class="docutils literal"><span class="pre">r_emailaddress</span></code></td>
<td><a class="reference external" href="LinkedIn’s“ProfileFields”documentation">LinkedIn Profile Fields</a></td>
</tr>
</tbody>
</table>
<p>Additional scopes can be selected by going to the Directory&#8217;s page in the Stormpath Admin Console and clicking on the <strong>Scopes</strong> tab found under &#8220;Provider Configuration&#8221; or by passing a <code class="docutils literal"><span class="pre">scopes</span></code> array to the Directory&#8217;s Provider resource:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/directories/4LL10Q3FNkiMLWmXfFQ1OU/provider</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic NVdYR...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json; charset=utf-8</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>

<span class="p">{</span>
  <span class="nt">&quot;scopes&quot;</span><span class="p">:[</span>
    <span class="s2">&quot;user_about_me&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="social-login-providers">
<h3><a class="toc-backref" href="#id38">Social Login Providers</a><a class="headerlink" href="#social-login-providers" title="Permalink to this headline">¶</a></h3>
<div class="section" id="google">
<span id="authn-google"></span><h4><a class="toc-backref" href="#id39">4.3.1. Google</a><a class="headerlink" href="#google" title="Permalink to this headline">¶</a></h4>
<p>Before you integrate Google Login with Stormpath, you must complete the following steps:</p>
<ul class="simple">
<li>Create an application in the <a class="reference external" href="https://console.developers.google.com/start">Google Developer Console</a></li>
<li>Enable Google Login for your Google application</li>
<li>Retrieve the OAuth Credentials (Client ID and Secret) for your Google application</li>
<li>Add your application&#8217;s redirect URL, which is the URL the user will be returned to after successful authentication. If you are using the <a class="reference external" href="https://docs.stormpath.com/client-api/product-guide/latest/social_login.html">Client API</a>, then this will be your Application&#8217;s <code class="docutils literal"><span class="pre">/authorize</span></code> endpoint (e.g. <code class="docutils literal"><span class="pre">https://cold-diver.apps.stormpath.io/authorize/callback</span></code>).</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Be sure to only enter the Redirect URL you are currently using. So, if you are running your app in development mode, set it to your local URL, and if you&#8217;re running your app in production mode, set it to your production URL.</p>
</div>
<p>For more information, please see the <a class="reference external" href="https://developers.google.com/identity/protocols/OAuth2">Google OAuth 2.0 documentation</a>.</p>
<div class="section" id="step-1-create-a-social-directory-for-google">
<h5>Step 1: Create a Social Directory for Google<a class="headerlink" href="#step-1-create-a-social-directory-for-google" title="Permalink to this headline">¶</a></h5>
<p>Creating this Directory for Google requires that you provide information from Google as a Provider resource. This can be accomplished by creating a new Directory:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Instead of specifying the Redirect URI in the Provider resource, you can also just include it as part of your authentication process. For more information, continue reading.</p>
</div>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/directories</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
    <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;my-google-directory&quot;</span><span class="p">,</span>
    <span class="nt">&quot;description&quot;</span> <span class="p">:</span> <span class="s2">&quot;A Google directory&quot;</span><span class="p">,</span>
    <span class="nt">&quot;provider&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;providerId&quot;</span><span class="p">:</span> <span class="s2">&quot;google&quot;</span><span class="p">,</span>
        <span class="nt">&quot;clientId&quot;</span><span class="p">:</span><span class="s2">&quot;YOUR_GOOGLE_CLIENT_ID&quot;</span><span class="p">,</span>
        <span class="nt">&quot;clientSecret&quot;</span><span class="p">:</span><span class="s2">&quot;YOUR_GOOGLE_CLIENT_SECRET&quot;</span><span class="p">,</span>
        <span class="nt">&quot;redirectUri&quot;</span><span class="p">:</span><span class="s2">&quot;YOUR_GOOGLE_REDIRECT_URI&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you are using <a class="reference external" href="https://developers.google.com/identity/sign-in/web/server-side-flow">Google+ Sign-In for server-side apps</a>, Google recommends that you leave the &#8220;Authorized Redirect URI&#8221; field blank in the Google Developer Console. In Stormpath, when creating the Google Directory, you must set the redirect URI to <code class="docutils literal"><span class="pre">postmessage</span></code>.</p>
</div>
</div>
<div class="section" id="step-2-map-the-google-directory-as-an-account-store-for-your-application">
<h5>Step 2: Map the Google Directory as an Account Store for Your Application<a class="headerlink" href="#step-2-map-the-google-directory-as-an-account-store-for-your-application" title="Permalink to this headline">¶</a></h5>
<p>Creating an Account Store Mapping between your new Google Directory and your Stormpath Application can be done as described in <a class="reference internal" href="#create-asm"><span>Mapping a new Account Store</span></a>.</p>
</div>
<div class="section" id="step-3-access-an-account-with-google-tokens">
<h5>Step 3: Access an Account with Google Tokens<a class="headerlink" href="#step-3-access-an-account-with-google-tokens" title="Permalink to this headline">¶</a></h5>
<p>To access or create an Account in your new Google Directory you use the Client API&#8217;s <code class="docutils literal"><span class="pre">/authorize</span></code> endpoint. Full documentation of this endpoint can be found in <a class="reference external" href="https://docs.stormpath.com/client-api/product-guide/latest/social_login.html">the Client API Product Guide</a>.</p>
<p>At a high level, the process works as follows:</p>
<ol class="arabic simple">
<li>The user clicks on a “Login with Google” link pointing at your application&#8217;s <code class="docutils literal"><span class="pre">/authorize</span></code> endpoint</li>
<li>Stormpath handles the login to Google and redirects the user back to your app with a Stormpath Token JWT response</li>
</ol>
<p>You can then, for example, pass that Stormpath token to the <code class="docutils literal"><span class="pre">/oauth/token</span></code> endpoint and receive back OAuth 2.0 access and refresh tokens as described in <a class="reference internal" href="#generate-oauth-token"><span>Generating an OAuth 2.0 Access Token</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The older, alternate way of handling this login is documented <a class="reference internal" href="appendix.html#authn-google-old"><span>here</span></a>.</p>
</div>
</div>
</div>
<div class="section" id="facebook">
<span id="authn-facebook"></span><h4><a class="toc-backref" href="#id40">4.3.2. Facebook</a><a class="headerlink" href="#facebook" title="Permalink to this headline">¶</a></h4>
<p>Before you integrate Facebook Login with Stormpath, you must complete the following steps:</p>
<ul class="simple">
<li>Create an application on the <a class="reference external" href="https://developers.facebook.com/">Facebook Developer Site</a></li>
<li>Retrieve your OAuth credentials (App ID and App Secret)</li>
<li>Add your application&#8217;s private and public root URLs</li>
<li>Add your application&#8217;s redirect URL, which is the URL the user will be returned to after successful authentication. If you are using the <a class="reference external" href="https://docs.stormpath.com/client-api/product-guide/latest/social_login.html">Client API</a>, then this will be your Application&#8217;s <code class="docutils literal"><span class="pre">/authorize</span></code> endpoint (e.g. <code class="docutils literal"><span class="pre">https://cold-diver.apps.stormpath.io/authorize/callback</span></code>).</li>
</ul>
<p>For more information, please see the <a class="reference external" href="https://developers.facebook.com/docs/apps/register">Facebook documentation</a>.</p>
<div class="section" id="step-1-create-a-social-directory-for-facebook">
<h5>Step 1: Create a Social Directory for Facebook<a class="headerlink" href="#step-1-create-a-social-directory-for-facebook" title="Permalink to this headline">¶</a></h5>
<p>Creating this Directory requires that you provide information from Facebook as a Provider resource. This can be accomplished by creating a new Directory:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/directories</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
    <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;my-facebook-directory&quot;</span><span class="p">,</span>
    <span class="nt">&quot;description&quot;</span> <span class="p">:</span> <span class="s2">&quot;A Facebook directory&quot;</span><span class="p">,</span>
    <span class="nt">&quot;provider&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;providerId&quot;</span><span class="p">:</span> <span class="s2">&quot;facebook&quot;</span><span class="p">,</span>
      <span class="nt">&quot;clientId&quot;</span><span class="p">:</span><span class="s2">&quot;YOUR_FACEBOOK_APP_ID&quot;</span><span class="p">,</span>
      <span class="nt">&quot;clientSecret&quot;</span><span class="p">:</span><span class="s2">&quot;YOUR_FACEBOOK_APP_SECRET&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="step-2-map-the-facebook-directory-as-an-account-store-for-your-application">
<h5>Step 2: Map the Facebook Directory as an Account Store for Your Application<a class="headerlink" href="#step-2-map-the-facebook-directory-as-an-account-store-for-your-application" title="Permalink to this headline">¶</a></h5>
<p>Creating an Account Store Mapping between your new Facebook Directory and your Stormpath Application can be done as described in <a class="reference internal" href="#create-asm"><span>Mapping a new Account Store</span></a>.</p>
</div>
<div class="section" id="step-3-access-an-account-with-facebook-tokens">
<h5>Step 3: Access an Account with Facebook Tokens<a class="headerlink" href="#step-3-access-an-account-with-facebook-tokens" title="Permalink to this headline">¶</a></h5>
<p>To access or create an Account in your new Facebook Directory you use the Client API&#8217;s <code class="docutils literal"><span class="pre">/authorize</span></code> endpoint. Full documentation of this endpoint can be found in <a class="reference external" href="https://docs.stormpath.com/client-api/product-guide/latest/social_login.html">the Client API Product Guide</a>.</p>
<p>At a high level, the process works as follows:</p>
<ol class="arabic simple">
<li>The user clicks on a “Login with Facebook&#8221; link pointing at your application&#8217;s <code class="docutils literal"><span class="pre">/authorize</span></code> endpoint</li>
<li>Stormpath handles the login to Facebook and redirects the user back to your app with a Stormpath Token JWT response</li>
</ol>
<p>You can then, for example, pass that Stormpath token to the <code class="docutils literal"><span class="pre">/oauth/token</span></code> endpoint and receive back OAuth 2.0 access and refresh tokens as described in <a class="reference internal" href="#generate-oauth-token"><span>Generating an OAuth 2.0 Access Token</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The older, alternate way of handling this login is documented <a class="reference internal" href="appendix.html#authn-facebook-old"><span>here</span></a>.</p>
</div>
</div>
</div>
<div class="section" id="github">
<span id="authn-github"></span><h4><a class="toc-backref" href="#id41">4.3.3. Github</a><a class="headerlink" href="#github" title="Permalink to this headline">¶</a></h4>
<p>Before you integrate GitHub Login with Stormpath, you must complete the following steps:</p>
<ul class="simple">
<li>Create an application in the <a class="reference external" href="https://developer.github.com/">GitHub Developer Site</a></li>
<li>Retrieve OAuth Credentials (Client ID and Secret) for your GitHub application. If you are using the <a class="reference external" href="https://docs.stormpath.com/client-api/product-guide/latest/social_login.html">Client API</a>, then this will be your Application&#8217;s <code class="docutils literal"><span class="pre">/authorize</span></code> endpoint (e.g. <code class="docutils literal"><span class="pre">https://cold-diver.apps.stormpath.io/authorize/callback</span></code>).</li>
<li>Add your application&#8217;s redirect URL, which is the URL the user will be returned to after successful authentication.</li>
</ul>
<p>For more information, please see the <a class="reference external" href="https://developer.github.com/guides/basics-of-authentication/#registering-your-app">GitHub documentation on registering your app</a>.</p>
<div class="section" id="step-1-create-a-social-directory-for-github">
<h5>Step 1: Create a Social Directory for GitHub<a class="headerlink" href="#step-1-create-a-social-directory-for-github" title="Permalink to this headline">¶</a></h5>
<p>Creating this Directory requires that you provide information from GitHub as a Provider resource. This can be accomplished by creating a new Directory:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/directories</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
    <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;my-github-directory&quot;</span><span class="p">,</span>
    <span class="nt">&quot;description&quot;</span> <span class="p">:</span> <span class="s2">&quot;A GitHub directory&quot;</span><span class="p">,</span>
    <span class="nt">&quot;provider&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;providerId&quot;</span><span class="p">:</span> <span class="s2">&quot;github&quot;</span><span class="p">,</span>
      <span class="nt">&quot;clientId&quot;</span><span class="p">:</span><span class="s2">&quot;YOUR_GITHUB_CLIENT_ID&quot;</span><span class="p">,</span>
      <span class="nt">&quot;clientSecret&quot;</span><span class="p">:</span><span class="s2">&quot;YOUR_GITHUB_CLIENT_SECRET&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="step-2-map-the-github-directory-as-an-account-store-for-your-application">
<h5>Step 2: Map the GitHub Directory as an Account Store for Your Application<a class="headerlink" href="#step-2-map-the-github-directory-as-an-account-store-for-your-application" title="Permalink to this headline">¶</a></h5>
<p>Creating an Account Store Mapping between your new GitHub Directory and your Stormpath Application can be done as described in <a class="reference internal" href="#create-asm"><span>Mapping a new Account Store</span></a>.</p>
</div>
<div class="section" id="step-3-access-an-account-with-github-tokens">
<h5>Step 3: Access an Account with GitHub Tokens<a class="headerlink" href="#step-3-access-an-account-with-github-tokens" title="Permalink to this headline">¶</a></h5>
<p>To access or create an Account in your new GitHub Directory you use the Client API&#8217;s <code class="docutils literal"><span class="pre">/authorize</span></code> endpoint. Full documentation of this endpoint can be found in <a class="reference external" href="https://docs.stormpath.com/client-api/product-guide/latest/social_login.html">the Client API Product Guide</a>.</p>
<p>At a high level, the process works as follows:</p>
<ol class="arabic simple">
<li>The user clicks on a “Login with GitHub” link pointing at your application&#8217;s <code class="docutils literal"><span class="pre">/authorize</span></code> endpoint</li>
<li>Stormpath handles the login to GitHub and redirects the user back to your app with a Stormpath Token JWT response</li>
</ol>
<p>You can then, for example, pass that Stormpath token to the <code class="docutils literal"><span class="pre">/oauth/token</span></code> endpoint and receive back OAuth 2.0 access and refresh tokens as described in <a class="reference internal" href="#generate-oauth-token"><span>Generating an OAuth 2.0 Access Token</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The older, alternate way of handling this login is documented <a class="reference internal" href="appendix.html#authn-github-old"><span>here</span></a>.</p>
</div>
</div>
</div>
<div class="section" id="linkedin">
<span id="authn-linkedin"></span><h4><a class="toc-backref" href="#id42">4.3.4 LinkedIn</a><a class="headerlink" href="#linkedin" title="Permalink to this headline">¶</a></h4>
<p>Before you integrate LinkedIn Login with Stormpath, you must complete the following steps:</p>
<ul class="simple">
<li>Create an application in the <a class="reference external" href="https://www.linkedin.com/secure/developer?newapp=">LinkedIn Developer Site</a></li>
<li>Add your application&#8217;s redirect URLs, which are the URL the user will be returned to after successful authentication. If you are using the <a class="reference external" href="https://docs.stormpath.com/client-api/product-guide/latest/social_login.html">Client API</a>, then this will be your Application&#8217;s <code class="docutils literal"><span class="pre">/authorize</span></code> endpoint (e.g. <code class="docutils literal"><span class="pre">https://cold-diver.apps.stormpath.io/authorize/callback</span></code>).</li>
<li>Retrieve OAuth Credentials (Client ID and Secret) for your LinkedIn application</li>
</ul>
<p>For more information, please see <a class="reference external" href="https://developer.linkedin.com/docs/oauth2">LinkedIn&#8217;s OAuth documentation</a>.</p>
<div class="section" id="step-1-create-a-social-directory-for-linkedin">
<h5>Step 1: Create a Social Directory for LinkedIn<a class="headerlink" href="#step-1-create-a-social-directory-for-linkedin" title="Permalink to this headline">¶</a></h5>
<p>Creating this Directory requires that you provide information from LinkedIn as a Provider resource. This can be accomplished by creating a new Directory:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/directories</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
    <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;my-linkedin-directory&quot;</span><span class="p">,</span>
    <span class="nt">&quot;description&quot;</span> <span class="p">:</span> <span class="s2">&quot;A LinkedIn Directory&quot;</span><span class="p">,</span>
    <span class="nt">&quot;provider&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;providerId&quot;</span><span class="p">:</span> <span class="s2">&quot;linkedin&quot;</span><span class="p">,</span>
      <span class="nt">&quot;clientId&quot;</span><span class="p">:</span><span class="s2">&quot;YOUR_LINKEDIN_APP_ID&quot;</span><span class="p">,</span>
      <span class="nt">&quot;clientSecret&quot;</span><span class="p">:</span><span class="s2">&quot;YOUR_LINKEDIN_APP_SECRET&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="step-2-map-the-linkedin-directory-as-an-account-store-for-your-application">
<h5>Step 2: Map the LinkedIn Directory as an Account Store for Your Application<a class="headerlink" href="#step-2-map-the-linkedin-directory-as-an-account-store-for-your-application" title="Permalink to this headline">¶</a></h5>
<p>Creating an Account Store Mapping between your new LinkedIn Directory and your Stormpath Application can be done as described in <a class="reference internal" href="#create-asm"><span>Mapping a new Account Store</span></a>.</p>
</div>
<div class="section" id="step-3-access-an-account-with-linkedin-tokens">
<h5>Step 3: Access an Account with LinkedIn Tokens<a class="headerlink" href="#step-3-access-an-account-with-linkedin-tokens" title="Permalink to this headline">¶</a></h5>
<p>To access or create an Account in your new LinkedIn Directory you use the Client API&#8217;s <code class="docutils literal"><span class="pre">/authorize</span></code> endpoint. Full documentation of this endpoint can be found in <a class="reference external" href="https://docs.stormpath.com/client-api/product-guide/latest/social_login.html">the Client API Product Guide</a>.</p>
<p>At a high level, the process works as follows:</p>
<ol class="arabic simple">
<li>The user clicks on a “Login with LinkedIn” link pointing at your application&#8217;s <code class="docutils literal"><span class="pre">/authorize</span></code> endpoint</li>
<li>Stormpath handles the login to LinkedIn and redirects the user back to your app with a Stormpath Token JWT response</li>
</ol>
<p>You can then, for example, pass that Stormpath token to the <code class="docutils literal"><span class="pre">/oauth/token</span></code> endpoint and receive back OAuth 2.0 access and refresh tokens as described in <a class="reference internal" href="#generate-oauth-token"><span>Generating an OAuth 2.0 Access Token</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The older, alternate way of handling this login is documented <a class="reference internal" href="appendix.html#authn-github-old"><span>here</span></a>.</p>
</div>
</div>
</div>
<div class="section" id="twitter">
<span id="authn-twitter"></span><h4><a class="toc-backref" href="#id43">4.3.5. Twitter</a><a class="headerlink" href="#twitter" title="Permalink to this headline">¶</a></h4>
<p>Before you integrate Twitter Login with Stormpath, you must complete the following steps:</p>
<ul class="simple">
<li>Create an application on the <a class="reference external" href="https://apps.twitter.com/">Twitter Application Management Site</a></li>
<li>Retrieve your OAuth credentials (App ID and App Secret)</li>
<li>Add your application&#8217;s &#8220;Callback URL&#8221;, which is the URL the user will be returned to after successful authentication. If you are using the <a class="reference external" href="https://docs.stormpath.com/client-api/product-guide/latest/social_login.html">Client API</a>, then this will be your Application&#8217;s <code class="docutils literal"><span class="pre">/authorize</span></code> endpoint (e.g. <code class="docutils literal"><span class="pre">https://cold-diver.apps.stormpath.io/authorize/callback</span></code>).</li>
</ul>
<p>For more information, please see the <a class="reference external" href="https://dev.twitter.com/oauth/overview/application-owner-access-tokens">Twitter documentation</a>.</p>
<div class="section" id="step-1-create-a-social-directory-for-twitter">
<h5>Step 1: Create a Social Directory for Twitter<a class="headerlink" href="#step-1-create-a-social-directory-for-twitter" title="Permalink to this headline">¶</a></h5>
<p>Creating this Directory requires that you provide information from Twitter as a Provider resource. This can be accomplished by creating a new Directory:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/directories</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic NVdYRVp...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json; charset=utf-8</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>

<span class="p">{</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Twitter&quot;</span><span class="p">,</span>
  <span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="s2">&quot;A Twitter directory&quot;</span><span class="p">,</span>
  <span class="nt">&quot;provider&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;providerId&quot;</span><span class="p">:</span><span class="s2">&quot;twitter&quot;</span><span class="p">,</span>
    <span class="nt">&quot;clientId&quot;</span><span class="p">:</span><span class="s2">&quot;OybhZelDAuncdBX3KVmIExample&quot;</span><span class="p">,</span>
    <span class="nt">&quot;clientSecret&quot;</span><span class="p">:</span><span class="s2">&quot;d2hzXHLZsJs4FdDX0l5Queen8Ww21v9L2T1YrOJAE2lLfExample&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="step-2-map-the-twitter-directory-as-an-account-store-for-your-application">
<h5>Step 2: Map the Twitter Directory as an Account Store for Your Application<a class="headerlink" href="#step-2-map-the-twitter-directory-as-an-account-store-for-your-application" title="Permalink to this headline">¶</a></h5>
<p>Creating an Account Store Mapping between your new Twitter Directory and your Stormpath Application can be done as described in <a class="reference internal" href="#create-asm"><span>Mapping a new Account Store</span></a>.</p>
</div>
<div class="section" id="step-3-access-an-account-with-twitter-tokens">
<h5>Step 3: Access an Account with Twitter Tokens<a class="headerlink" href="#step-3-access-an-account-with-twitter-tokens" title="Permalink to this headline">¶</a></h5>
<p>To access or create an Account in your new Twitter Directory you use the Client API&#8217;s <code class="docutils literal"><span class="pre">/authorize</span></code> endpoint. Full documentation of this endpoint can be found in <a class="reference external" href="https://docs.stormpath.com/client-api/product-guide/latest/social_login.html">the Client API Product Guide</a>.</p>
<p>At a high level, the process works as follows:</p>
<ol class="arabic simple">
<li>The user clicks on a “Login with Twitter&#8221; link pointing at your application&#8217;s <code class="docutils literal"><span class="pre">/authorize</span></code> endpoint</li>
<li>Stormpath handles the login to Twitter and redirects the user back to your app with a Stormpath Token JWT response</li>
</ol>
<p>You can then, for example, pass that Stormpath token to the <code class="docutils literal"><span class="pre">/oauth/token</span></code> endpoint and receive back OAuth 2.0 access and refresh tokens as described in <a class="reference internal" href="#generate-oauth-token"><span>Generating an OAuth 2.0 Access Token</span></a>.</p>
</div>
</div>
<div class="section" id="generic-oauth-2-0-login">
<span id="authn-generic-oauth"></span><h4><a class="toc-backref" href="#id44">4.3.6. Generic OAuth 2.0 Login</a><a class="headerlink" href="#generic-oauth-2-0-login" title="Permalink to this headline">¶</a></h4>
<p>While Stormpath supports any provider that offers login via an OAuth 2.0 flow, the following providers have been tested and confirmed as working:</p>
<ul class="simple">
<li>Amazon</li>
<li>Imgur</li>
<li>Instagram</li>
<li>StackExchange</li>
<li>Twitch</li>
</ul>
<p>You can find example configurations for these providers <a class="reference internal" href="#generic-oauth-config"><span>below</span></a>. The instructions below should allow you to integrate with any other OAuth provider not listed here. If you have any questions about integrating with an OAuth provider not listed here, feel free to contact us at <a class="reference external" href="mailto:support&#37;&#52;&#48;stormpath&#46;com">support<span>&#64;</span>stormpath<span>&#46;</span>com</a> and we will help as best as we can.</p>
<p>Before you integrate your OAuth provider with Stormpath, you must complete the following steps:</p>
<ul class="simple">
<li>Create an application with that provider</li>
<li>Enable OAuth 2.0 login with that provider</li>
<li>Add your application&#8217;s redirect URL, which is the URL the user will be returned to after successful authentication. If you are using the <a class="reference external" href="https://docs.stormpath.com/client-api/product-guide/latest/social_login.html">Client API</a>, then this will be your Application&#8217;s <code class="docutils literal"><span class="pre">/authorize</span></code> endpoint (e.g. <code class="docutils literal"><span class="pre">https://endless-winter.apps.stormpath.io/authorize/callback</span></code>).</li>
</ul>
<p>You will also need to gather the following information from the provider:</p>
<ul class="simple">
<li><strong>Client ID &amp; Secret:</strong> These are the OAuth credentials that Stormpath will need in order to communicate with the provider.</li>
<li><strong>Authorization Endpoint:</strong> Used to retrieve the Authorization Code from the provider. This endpoint will often end with <code class="docutils literal"><span class="pre">/authorize</span></code>.</li>
<li><strong>Token Endpoint:</strong> Accepts the Authorization Code you retrieve from the Authorization Endpoint and returns an Access Token. This endpoint will often end with <code class="docutils literal"><span class="pre">/token</span></code>.</li>
<li><strong>Resource Endpoint:</strong> Accepts the Access Token you got from the Token Endpoint and returns the user data. This is usually the endpoint that is used to retrieve the user object.</li>
<li><strong>Access Token Type:</strong> This is the format of the token that is passed by Stormpath to the provider in order to retrieve the user data. Most providers support all three formats: <code class="docutils literal"><span class="pre">bearer</span></code>, <code class="docutils literal"><span class="pre">oauth_token</span></code>, <code class="docutils literal"><span class="pre">access_token</span></code>. <code class="docutils literal"><span class="pre">bearer</span></code> means that the token is passed as part of a Bearer Authentication header, while <code class="docutils literal"><span class="pre">oauth_token</span></code> and <code class="docutils literal"><span class="pre">access_token</span></code> are both URL parameters. Most providers support all three, but this is not always true.</li>
<li><strong>ID Field:</strong> This is the field that contains the user ID in the user data that is retrieved by Stormpath from the Resource Endpoint.</li>
</ul>
<p>Example configurations can be found <a class="reference internal" href="#generic-oauth-config"><span>below</span></a>. Information about actually initiating Social Login can be found in <a class="reference external" href="https://docs.stormpath.com/client-api/product-guide/latest/social_login.html#initiate-social-login">the Client API documentation</a>.</p>
<div class="section" id="step-1-create-a-directory-for-your-oauth-provider">
<h5>Step 1: Create a Directory for your OAuth provider<a class="headerlink" href="#step-1-create-a-directory-for-your-oauth-provider" title="Permalink to this headline">¶</a></h5>
<p>Creating this Directory requires that you provide information about your Provider resource. This can be accomplished by creating a new Directory:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/directories</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic NVdYR...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json; charset=utf-8</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>

<span class="p">{</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Amazon&quot;</span><span class="p">,</span>
  <span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="s2">&quot;A generic OAuth directory for Amazon&quot;</span><span class="p">,</span>
  <span class="nt">&quot;provider&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;providerId&quot;</span><span class="p">:</span><span class="s2">&quot;amazon&quot;</span><span class="p">,</span>
    <span class="nt">&quot;clientId&quot;</span><span class="p">:</span><span class="s2">&quot;amzn1.application-oa2-client.99daa08example302d144a8ea&quot;</span><span class="p">,</span>
    <span class="nt">&quot;clientSecret&quot;</span><span class="p">:</span><span class="s2">&quot;93342d47bbecbexample0655228fced82&quot;</span><span class="p">,</span>
    <span class="nt">&quot;authorizationEndpoint&quot;</span><span class="p">:</span><span class="s2">&quot;https://www.amazon.com/ap/oa&quot;</span><span class="p">,</span>
    <span class="nt">&quot;tokenEndpoint&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.amazon.com/auth/o2/token&quot;</span><span class="p">,</span>
    <span class="nt">&quot;resourceEndpoint&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.amazon.com/user/profile&quot;</span><span class="p">,</span>
    <span class="nt">&quot;idField&quot;</span><span class="p">:</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span>
    <span class="nt">&quot;accessTokenType&quot;</span><span class="p">:</span><span class="s2">&quot;bearer&quot;</span><span class="p">,</span>
    <span class="nt">&quot;scope&quot;</span><span class="p">:[</span>
      <span class="s2">&quot;profile&quot;</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="step-2-map-the-directory-as-an-account-store-for-your-application">
<h5>Step 2: Map the Directory as an Account Store for Your Application<a class="headerlink" href="#step-2-map-the-directory-as-an-account-store-for-your-application" title="Permalink to this headline">¶</a></h5>
<p>Creating an Account Store Mapping between your new Google Directory and your Stormpath Application can be done as described in <a class="reference internal" href="#create-asm"><span>Mapping a new Account Store</span></a>.</p>
</div>
<div class="section" id="step-3-access-an-account-with-the-client-api">
<h5>Step 3: Access an Account with the Client API<a class="headerlink" href="#step-3-access-an-account-with-the-client-api" title="Permalink to this headline">¶</a></h5>
<p>To access or create an Account in your new Directory you use the Client API&#8217;s <code class="docutils literal"><span class="pre">/authorize</span></code> endpoint. Full documentation of this endpoint can be found in <a class="reference external" href="https://docs.stormpath.com/client-api/product-guide/latest/social_login.html">the Client API Product Guide</a>.</p>
<p>At a high level, the process works as follows:</p>
<ol class="arabic simple">
<li>The user clicks on a “Login with ______” link pointing at your application&#8217;s <code class="docutils literal"><span class="pre">/authorize</span></code> endpoint</li>
<li>Stormpath handles the login and redirects the user back to your app with a Stormpath Token JWT response</li>
</ol>
<p>You can then, for example, pass that Stormpath token to the <code class="docutils literal"><span class="pre">/oauth/token</span></code> endpoint and receive back OAuth 2.0 access and refresh tokens as described in <a class="reference external" href="https://docs.stormpath.com/client-api/product-guide/latest/authentication.html#oauth-2-0-login">the Client API Guide</a>.</p>
</div>
<div class="section" id="example-configurations">
<span id="generic-oauth-config"></span><h5>Example Configurations<a class="headerlink" href="#example-configurations" title="Permalink to this headline">¶</a></h5>
<p>This section contains examples of Providers configured for 5 common OAuth login providers, though we have removed irrelevant values (e.g. <code class="docutils literal"><span class="pre">createdAt</span></code>), which means that you can copy this JSON and simply fill-in your own values where necessary.</p>
<p><em>ID Field</em></p>
<p>ID Field must refer to the location of the user&#8217;s ID as found within the user object returned from the Resource Endpoint. If not specified, the default value for this field is simply <code class="docutils literal"><span class="pre">id</span></code>.</p>
<p>Some providers return the ID field nested inside other objects. In this case, you must indicate the nesting using a period. For example, Imgur returns the <code class="docutils literal"><span class="pre">id</span></code> within a <code class="docutils literal"><span class="pre">data</span></code> object. This means that the value of <code class="docutils literal"><span class="pre">idField</span></code> should be <code class="docutils literal"><span class="pre">data.id</span></code>.</p>
<p><em>Provider ID</em></p>
<p>The provider ID can contain any string value that you like, but your Application cannot have more than one Directory with any given <code class="docutils literal"><span class="pre">providerId</span></code> value.</p>
<div class="section" id="amazon">
<span id="config-amazon"></span><h6>Amazon<a class="headerlink" href="#amazon" title="Permalink to this headline">¶</a></h6>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;accessTokenType&quot;</span><span class="p">:</span> <span class="s2">&quot;bearer&quot;</span><span class="p">,</span>
  <span class="nt">&quot;authorizationEndpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;https://www.amazon.com/ap/oa&quot;</span><span class="p">,</span>
  <span class="nt">&quot;clientId&quot;</span><span class="p">:</span> <span class="s2">&quot;YOUR_CLIENT_ID&quot;</span><span class="p">,</span>
  <span class="nt">&quot;clientSecret&quot;</span><span class="p">:</span> <span class="s2">&quot;YOUR_CLIENT_SECRET&quot;</span><span class="p">,</span>
  <span class="nt">&quot;idField&quot;</span><span class="p">:</span> <span class="s2">&quot;user_id&quot;</span><span class="p">,</span>
  <span class="nt">&quot;providerId&quot;</span><span class="p">:</span> <span class="s2">&quot;amazon&quot;</span><span class="p">,</span>
  <span class="nt">&quot;providerType&quot;</span><span class="p">:</span> <span class="s2">&quot;oauth2&quot;</span><span class="p">,</span>
  <span class="nt">&quot;resourceEndpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.amazon.com/user/profile&quot;</span><span class="p">,</span>
  <span class="nt">&quot;scope&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;profile&quot;</span>
  <span class="p">],</span>
  <span class="nt">&quot;tokenEndpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.amazon.com/auth/o2/token&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In order for the flow to succeed, Amazon requires that you  specify a scope. This example only shows one of the possible scopes. For more information see the <a class="reference external" href="https://developer.amazon.com/public/apis/engage/login-with-amazon/docs/customer_profile.html">Amazon Documentation</a>.</p>
</div>
</div>
<div class="section" id="imgur">
<h6>Imgur<a class="headerlink" href="#imgur" title="Permalink to this headline">¶</a></h6>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;accessTokenType&quot;</span><span class="p">:</span> <span class="s2">&quot;bearer&quot;</span><span class="p">,</span>
  <span class="nt">&quot;authorizationEndpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.imgur.com/oauth2/authorize&quot;</span><span class="p">,</span>
  <span class="nt">&quot;clientId&quot;</span><span class="p">:</span> <span class="s2">&quot;YOUR_CLIENT_ID&quot;</span><span class="p">,</span>
  <span class="nt">&quot;clientSecret&quot;</span><span class="p">:</span> <span class="s2">&quot;YOUR_CLIENT_SECRET&quot;</span><span class="p">,</span>
  <span class="nt">&quot;idField&quot;</span><span class="p">:</span> <span class="s2">&quot;data.id&quot;</span><span class="p">,</span>
  <span class="nt">&quot;providerId&quot;</span><span class="p">:</span> <span class="s2">&quot;imgur&quot;</span><span class="p">,</span>
  <span class="nt">&quot;providerType&quot;</span><span class="p">:</span> <span class="s2">&quot;oauth2&quot;</span><span class="p">,</span>
  <span class="nt">&quot;resourceEndpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.imgur.com/3/account/me&quot;</span><span class="p">,</span>
  <span class="nt">&quot;scope&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="nt">&quot;tokenEndpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.imgur.com/oauth2/token&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="instagram">
<h6>Instagram<a class="headerlink" href="#instagram" title="Permalink to this headline">¶</a></h6>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;accessTokenType&quot;</span><span class="p">:</span> <span class="s2">&quot;access_token&quot;</span><span class="p">,</span>
  <span class="nt">&quot;authorizationEndpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.instagram.com/oauth/authorize&quot;</span><span class="p">,</span>
  <span class="nt">&quot;clientId&quot;</span><span class="p">:</span> <span class="s2">&quot;YOUR_CLIENT_ID&quot;</span><span class="p">,</span>
  <span class="nt">&quot;clientSecret&quot;</span><span class="p">:</span> <span class="s2">&quot;YOUR_CLIENT_SECRET&quot;</span><span class="p">,</span>
  <span class="nt">&quot;idField&quot;</span><span class="p">:</span> <span class="s2">&quot;data.id&quot;</span><span class="p">,</span>
  <span class="nt">&quot;providerId&quot;</span><span class="p">:</span> <span class="s2">&quot;instagram&quot;</span><span class="p">,</span>
  <span class="nt">&quot;providerType&quot;</span><span class="p">:</span> <span class="s2">&quot;oauth2&quot;</span><span class="p">,</span>
  <span class="nt">&quot;resourceEndpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.instagram.com/v1/users/self&quot;</span><span class="p">,</span>
  <span class="nt">&quot;scope&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="nt">&quot;tokenEndpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.instagram.com/oauth/access_token&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="stackexchange">
<h6>StackExchange<a class="headerlink" href="#stackexchange" title="Permalink to this headline">¶</a></h6>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;accessTokenType&quot;</span><span class="p">:</span> <span class="s2">&quot;access_token&quot;</span><span class="p">,</span>
  <span class="nt">&quot;authorizationEndpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;https://stackexchange.com/oauth&quot;</span><span class="p">,</span>
  <span class="nt">&quot;clientId&quot;</span><span class="p">:</span> <span class="s2">&quot;YOUR_CLIENT_ID&quot;</span><span class="p">,</span>
  <span class="nt">&quot;clientSecret&quot;</span><span class="p">:</span> <span class="s2">&quot;YOUR_CLIENT_SECRET&quot;</span><span class="p">,</span>
  <span class="nt">&quot;idField&quot;</span><span class="p">:</span> <span class="s2">&quot;items[0].user_id&quot;</span><span class="p">,</span>
  <span class="nt">&quot;providerId&quot;</span><span class="p">:</span> <span class="s2">&quot;stackexchange&quot;</span><span class="p">,</span>
  <span class="nt">&quot;providerType&quot;</span><span class="p">:</span> <span class="s2">&quot;oauth2&quot;</span><span class="p">,</span>
  <span class="nt">&quot;resourceEndpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stackexchange.com/2.2/me?order=desc&amp;sort=reputation&amp;site=stackapps&amp;key=YOUR_APP_KEY&quot;</span><span class="p">,</span>
  <span class="nt">&quot;scope&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;no_expiry&quot;</span>
  <span class="p">],</span>
  <span class="nt">&quot;tokenEndpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;https://stackexchange.com/oauth/access_token&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In order for the flow to succeed, you must configure Stormpath to request a scope. This example uses the <code class="docutils literal"><span class="pre">no_expiry</span></code> scope. For more information, see the <a class="reference external" href="https://api.stackexchange.com/docs/authentication#scope">StackExchange documentation</a>.</p>
<p class="last">Also the Resource Endpoint requires you to include a <code class="docutils literal"><span class="pre">key</span></code> that is found on your StackApp&#8217;s configuration page.</p>
</div>
</div>
<div class="section" id="twitch">
<h6>Twitch<a class="headerlink" href="#twitch" title="Permalink to this headline">¶</a></h6>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;accessTokenType&quot;</span><span class="p">:</span> <span class="s2">&quot;oauth_token&quot;</span><span class="p">,</span>
  <span class="nt">&quot;authorizationEndpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.twitch.tv/kraken/oauth2/authorize&quot;</span><span class="p">,</span>
  <span class="nt">&quot;clientId&quot;</span><span class="p">:</span> <span class="s2">&quot;YOUR_CLIENT_ID&quot;</span><span class="p">,</span>
  <span class="nt">&quot;clientSecret&quot;</span><span class="p">:</span> <span class="s2">&quot;YOUR_CLIENT_SECRET&quot;</span><span class="p">,</span>
  <span class="nt">&quot;idField&quot;</span><span class="p">:</span> <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
  <span class="nt">&quot;providerId&quot;</span><span class="p">:</span> <span class="s2">&quot;twitch&quot;</span><span class="p">,</span>
  <span class="nt">&quot;providerType&quot;</span><span class="p">:</span> <span class="s2">&quot;oauth2&quot;</span><span class="p">,</span>
  <span class="nt">&quot;resourceEndpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.twitch.tv/kraken/user&quot;</span><span class="p">,</span>
  <span class="nt">&quot;scope&quot;</span><span class="p">:</span> <span class="p">[],</span>
  <span class="nt">&quot;tokenEndpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.twitch.tv/kraken/oauth2/token&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="authenticating-against-an-ldap-directory">
<span id="ldap-dir-authn"></span><h2>4.4. Authenticating Against an LDAP Directory<a class="headerlink" href="#authenticating-against-an-ldap-directory" title="Permalink to this headline">¶</a></h2>
<div class="contents local topic" id="id6">
<ul class="simple">
<li><a class="reference internal" href="#the-ldap-authentication-flow" id="id45">The LDAP Authentication Flow</a></li>
<li><a class="reference internal" href="#mirror-directories-and-ldap" id="id46">Mirror Directories and LDAP</a></li>
<li><a class="reference internal" href="#setting-up-login-with-ldap" id="id47">Setting Up Login With LDAP</a><ul>
<li><a class="reference internal" href="#step-1-create-an-ldap-directory" id="id48">Step 1: Create an LDAP Directory</a></li>
<li><a class="reference internal" href="#step-2-install-your-ldap-agent" id="id49">Step 2: Install your LDAP Agent</a></li>
<li><a class="reference internal" href="#step-3-map-the-ldap-directory-as-an-account-store-for-your-application" id="id50">Step 3: Map the LDAP Directory as an Account Store for Your Application</a></li>
</ul>
</li>
</ul>
</div>
<p>This section assumes that you are already familiar both with <a class="reference internal" href="#how-login-works"><span>4.1.2. How Login Attempts Work in Stormpath</span></a> and the concept of Stormpath <a class="reference internal" href="accnt_mgmt.html#about-ldap-dir"><span>LDAP Directories</span></a>. The instructions in this section apply to all LDAP user directories, including Active Directory, with two exceptions:</p>
<ul class="simple">
<li>If you are using an LDAP user directory in conjunction with <strong>Active Directory Federation Services</strong>, you will want to read the <a class="reference internal" href="#adfs"><span>Active Directory Federation Services</span></a> section below.</li>
<li>If you are using Azure Active Directory, then you will want to read the <a class="reference internal" href="#azure"><span>Azure Active Directory</span></a> section.</li>
</ul>
<div class="section" id="the-ldap-authentication-flow">
<h3><a class="toc-backref" href="#id45">The LDAP Authentication Flow</a><a class="headerlink" href="#the-ldap-authentication-flow" title="Permalink to this headline">¶</a></h3>
<p>There are two different authentication flows for LDAP directories: one for Active Directory, and another for all other directories that use the LDAP protocol.</p>
<p><strong>LDAP</strong></p>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/ldap_vanilla_seq.png"><img alt="Non-AD LDAP Auth Sequence" src="_images/ldap_vanilla_seq.png" /></a>
</div>
<p><strong>Active Directory Authentication</strong></p>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/ldap_ad_seq.png"><img alt="AD LDAP Auth Sequence" src="_images/ldap_ad_seq.png" /></a>
</div>
</div>
<div class="section" id="mirror-directories-and-ldap">
<h3><a class="toc-backref" href="#id46">Mirror Directories and LDAP</a><a class="headerlink" href="#mirror-directories-and-ldap" title="Permalink to this headline">¶</a></h3>
<p>To recap: With LDAP integration, Stormpath is simply mirroring the canonical LDAP user directory. If this fulfills your requirements, then the story ends here. However, if you need to support other kinds of login (and therefore other kinds of Directories) it is recommended that you maintain a &#8220;master&#8221; Directory alongside your Mirror Directory. For more about this, see <a class="reference internal" href="accnt_mgmt.html#account-linking"><span>3.8. Account Linking</span></a>.</p>
</div>
<div class="section" id="setting-up-login-with-ldap">
<h3><a class="toc-backref" href="#id47">Setting Up Login With LDAP</a><a class="headerlink" href="#setting-up-login-with-ldap" title="Permalink to this headline">¶</a></h3>
<p>The step-by-step process for setting-up LDAP login is as follows:</p>
<div class="section" id="step-1-create-an-ldap-directory">
<span id="authn-ldap-dir-creation"></span><h4><a class="toc-backref" href="#id48">Step 1: Create an LDAP Directory</a><a class="headerlink" href="#step-1-create-an-ldap-directory" title="Permalink to this headline">¶</a></h4>
<p>HTTP POST a new Directory resource to the <code class="docutils literal"><span class="pre">/directories</span></code> endpoint. This Directory will contain a <a class="reference internal" href="reference.html#ref-provider"><span>Provider</span></a> resource with <code class="docutils literal"><span class="pre">providerId</span></code> set to <code class="docutils literal"><span class="pre">ldap</span></code> or <code class="docutils literal"><span class="pre">ad</span></code>. This Provider resource will in turn contain an <a class="reference internal" href="reference.html#ref-ldap-agent"><span>LDAP Agent</span></a> object, which in turn also contains a few nested configuration resources.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>All of these must be passed at the same time:</p>
<div class="last highlight-none"><div class="highlight"><pre><span></span>directory
  └──provider
      └──agent
          └──config
              ├──accountConfig
              └──groupConfig
</pre></div>
</div>
</div>
<p>The full Directory object, with all of the required resources, will look like this:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/directories</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;My LDAP Directory&quot;</span><span class="p">,</span>
  <span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="s2">&quot;An LDAP Directory created with the Stormpath API&quot;</span><span class="p">,</span>
  <span class="nt">&quot;provider&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;providerId&quot;</span><span class="p">:</span><span class="s2">&quot;ldap&quot;</span><span class="p">,</span>
    <span class="nt">&quot;agent&quot;</span><span class="p">:{</span>
      <span class="nt">&quot;config&quot;</span><span class="p">:{</span>
        <span class="nt">&quot;directoryHost&quot;</span><span class="p">:</span><span class="s2">&quot;ldap.local&quot;</span><span class="p">,</span>
        <span class="nt">&quot;directoryPort&quot;</span><span class="p">:</span><span class="s2">&quot;636&quot;</span><span class="p">,</span>
        <span class="nt">&quot;sslRequired&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
        <span class="nt">&quot;agentUserDn&quot;</span><span class="p">:</span><span class="s2">&quot;tom@stormpath.com&quot;</span><span class="p">,</span>
        <span class="nt">&quot;agentUserDnPassword&quot;</span><span class="p">:</span><span class="s2">&quot;StormpathRulez&quot;</span><span class="p">,</span>
        <span class="nt">&quot;baseDn&quot;</span><span class="p">:</span><span class="s2">&quot;dc=example,dc=com&quot;</span><span class="p">,</span>
        <span class="nt">&quot;pollInterval&quot;</span><span class="p">:</span><span class="mi">60</span><span class="p">,</span>
        <span class="nt">&quot;accountConfig&quot;</span><span class="p">:{</span>
          <span class="nt">&quot;dnSuffix&quot;</span><span class="p">:</span><span class="s2">&quot;ou=employees&quot;</span><span class="p">,</span>
          <span class="nt">&quot;objectClass&quot;</span><span class="p">:</span><span class="s2">&quot;person&quot;</span><span class="p">,</span>
          <span class="nt">&quot;objectFilter&quot;</span><span class="p">:</span><span class="s2">&quot;(cn=finance)&quot;</span><span class="p">,</span>
          <span class="nt">&quot;emailRdn&quot;</span><span class="p">:</span><span class="s2">&quot;email&quot;</span><span class="p">,</span>
          <span class="nt">&quot;givenNameRdn&quot;</span><span class="p">:</span><span class="s2">&quot;givenName&quot;</span><span class="p">,</span>
          <span class="nt">&quot;middleNameRdn&quot;</span><span class="p">:</span><span class="s2">&quot;middleName&quot;</span><span class="p">,</span>
          <span class="nt">&quot;surnameRdn&quot;</span><span class="p">:</span><span class="s2">&quot;sn&quot;</span><span class="p">,</span>
          <span class="nt">&quot;usernameRdn&quot;</span><span class="p">:</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span>
          <span class="nt">&quot;passwordRdn&quot;</span><span class="p">:</span><span class="s2">&quot;userPassword&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;groupConfig&quot;</span><span class="p">:{</span>
          <span class="nt">&quot;dnSuffix&quot;</span><span class="p">:</span><span class="s2">&quot;ou=groups&quot;</span><span class="p">,</span>
          <span class="nt">&quot;objectClass&quot;</span><span class="p">:</span><span class="s2">&quot;groupOfUniqueNames&quot;</span><span class="p">,</span>
          <span class="nt">&quot;objectFilter&quot;</span><span class="p">:</span><span class="s2">&quot;(ou=*-group)&quot;</span><span class="p">,</span>
          <span class="nt">&quot;nameRdn&quot;</span><span class="p">:</span><span class="s2">&quot;cn&quot;</span><span class="p">,</span>
          <span class="nt">&quot;descriptionRdn&quot;</span><span class="p">:</span><span class="s2">&quot;description&quot;</span><span class="p">,</span>
          <span class="nt">&quot;membersRdn&quot;</span><span class="p">:</span><span class="s2">&quot;uniqueMember&quot;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For more information about all of these values, please see the Reference chapter&#8217;s <a class="reference external" href="https://docs.stormpath.com/rest/product-guide/latest/reference.html#directory">Directory</a> section.</p>
</div>
<div class="section" id="step-2-install-your-ldap-agent">
<h4><a class="toc-backref" href="#id49">Step 2: Install your LDAP Agent</a><a class="headerlink" href="#step-2-install-your-ldap-agent" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The LDAP Agent can be installed anywhere, as long as the location allows it access to your LDAP server.</p>
</div>
<p>Once the Directory, Provider and Agent are created, installing your Agent is done in three steps.</p>
<p><strong>1. Download</strong></p>
<p>Download your Agent by following the Download link on the Agent page in the Admin Console.</p>
<p><strong>2. Configure</strong></p>
<p><em>a.</em> Make sure Java 1.8 is installed</p>
<p><em>b.</em> Unzip to a location in your file system, for example <code class="docutils literal"><span class="pre">C:\stormpath\agent</span></code> in Windows or <code class="docutils literal"><span class="pre">/opt/stormpath/agent</span></code> in Unix.</p>
<p>In the same location, open the file <code class="docutils literal"><span class="pre">dapper.properties</span></code> from the config folder and replace this line:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">agent</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">PutAgentSpecificIdHere</span>
</pre></div>
</div>
<p>With this line:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>agent.id  = 72MlbWz6C4dLo1oBhgjjTt
</pre></div>
</div>
<p>Follow the instructions in the <code class="docutils literal"><span class="pre">dapper.properties</span></code> file to reference your account&#8217;s API authentication.</p>
<p><strong>3. Start</strong></p>
<p>In Windows:</p>
<p>(Go to your agent directory, for example <code class="docutils literal"><span class="pre">C:\stormpath\agent</span></code>)</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>C:\stormpath\agent&gt;cd bin
C:\stormpath\agent\bin&gt;startup.bat
</pre></div>
</div>
<p>In Unix:</p>
<p>(Go to your agent directory, for example <code class="docutils literal"><span class="pre">/opt/stormpath/agent</span></code>)</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> bin
$ startup.sh
</pre></div>
</div>
<p>The Agent will start synchronizing immediately, pushing the configured data to Stormpath. You will see the synchronized user Accounts and Groups appear in the Stormpath Directory, and the Accounts will be able to log in to any Stormpath-enabled application that you assign. When the Agent detects local changes, additions or deletions to the mirrored Accounts or Groups, it will automatically propagate those changes to Stormpath.</p>
</div>
<div class="section" id="step-3-map-the-ldap-directory-as-an-account-store-for-your-application">
<h4><a class="toc-backref" href="#id50">Step 3: Map the LDAP Directory as an Account Store for Your Application</a><a class="headerlink" href="#step-3-map-the-ldap-directory-as-an-account-store-for-your-application" title="Permalink to this headline">¶</a></h4>
<p>Creating an Account Store Mapping between your new LDAP Directory and your Stormpath Application can be done as described in <a class="reference internal" href="#create-asm"><span>Mapping a new Account Store</span></a>.</p>
<p>The log-in process will now proceed as it would for <a class="reference internal" href="#how-login-works"><span>any other kind of Directory</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the case of Active Directory, the login process does not proceed as normal, and instead involves something called &#8220;delegated authentication&#8221;. The user accounts pulled-in from an Active Directory do not include the passwords. Consequently, the LDAP Agent does double duty in the case of Active Directory: it synchronizes accounts, and also handles authentication attempts and relays the outcome back to Stormpath.</p>
</div>
</div>
</div>
</div>
<div class="section" id="authenticating-against-a-saml-directory">
<span id="saml-authn"></span><h2>4.5. Authenticating Against a SAML Directory<a class="headerlink" href="#authenticating-against-a-saml-directory" title="Permalink to this headline">¶</a></h2>
<div class="contents local topic" id="id7">
<ul class="simple">
<li><a class="reference internal" href="#stormpath-as-the-identity-provider" id="id51">4.5.1. Stormpath as the Identity Provider</a></li>
<li><a class="reference internal" href="#stormpath-as-the-service-provider" id="id52">4.5.2. Stormpath as the Service Provider</a></li>
<li><a class="reference internal" href="#the-stormpath-saml-flow" id="id53">4.5.4. The Stormpath SAML Flow</a></li>
</ul>
</div>
<p>SAML is an XML-based standard for exchanging authentication and authorization data between security domains. The security domains are the Service Provider and the Identity Provider. The <strong>Service Provider</strong> is the service that the user is trying to access, but access requires authentication. This authentication is done with the <strong>Identity Provider</strong>, which is the canonical source of user information.</p>
<p>Stormpath is able to function as either end of the SAML authentication. This means that your Stormpath-powered application could either be the Identity Provider, and provide authentication for a third-party application such as Zendesk, or it could be the Service Provider, and require authentication with a third-party Identity Provider like Okta.</p>
<p>If you&#8217;d like to understand the steps involved in a SAML login, see the <a class="reference internal" href="#saml-flow"><span>SAML Login Flow section</span></a>.</p>
<p>If you&#8217;d like to know more about using Stormpath as an Identity Provider, see <a class="reference internal" href="#saml-idp"><span>4.5.1. Stormpath as the Identity Provider</span></a>.</p>
<p>If you&#8217;d like to know more about using Stormpath as a Service Provider, see <a class="reference internal" href="#saml-sp"><span>4.5.2. Stormpath as the Service Provider</span></a>.</p>
<p>If you want a step-by-step guide to configuring Stormpath to work as a Service Provider with Identity Providers like Salesforce, OneLogin and Okta, as well as with your ADFS or Azure AD deployment, see the <a class="reference external" href="https://docs.stormpath.com/console/product-guide/latest/appendix-saml.html">Stormpath Admin Console Guide</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Configuring Stormpath as an Identity Provider is currently not supported in the Admin Console.</p>
</div>
<p>If you&#8217;d like to know about how to configure SAML using just the REST API, please see either:</p>
<ul class="simple">
<li><a class="reference internal" href="#saml-idp-configuration-rest"><span>Configuring Stormpath as an Identity Provider via REST</span></a></li>
<li><a class="reference internal" href="#saml-sp-configuration-rest"><span>Configuring Stormpath as a Service Provider via REST</span></a></li>
</ul>
<div class="section" id="stormpath-as-the-identity-provider">
<span id="saml-idp"></span><h3><a class="toc-backref" href="#id51">4.5.1. Stormpath as the Identity Provider</a><a class="headerlink" href="#stormpath-as-the-identity-provider" title="Permalink to this headline">¶</a></h3>
<p>In this case, Stormpath is serving as the IdP, which is the repository for user data. A request is first made to the Service Provider, who redirects to Stormpath. Authentication is done against Stormpath, and then the user is passed back to the Service Provider in an authenticated state.</p>
<p>For example:</p>
<ol class="arabic simple">
<li>A user tries to access Zendesk: <code class="docutils literal"><span class="pre">https://samlexample.zendesk.com/</span></code></li>
<li>The user is redirected to your Stormpath ID Site page: <code class="docutils literal"><span class="pre">https://iron-troop.id.stormpath.io/#/</span></code></li>
<li>The user authenticates with Stormpath</li>
<li>On successful authentication, the user is redirected back to Zendesk</li>
</ol>
<p>The steps below will use Zendesk as an example, although any Service Provider that supports SAML should be compatible.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Stormpath as an Identity Provider (IdP) supports only the Service Provider initiated flow.</p>
</div>
<div class="section" id="configuring-stormpath-as-an-identity-provider-via-rest">
<span id="saml-idp-configuration-rest"></span><h4>Configuring Stormpath as an Identity Provider via REST<a class="headerlink" href="#configuring-stormpath-as-an-identity-provider-via-rest" title="Permalink to this headline">¶</a></h4>
<p>Here you will find the steps that are required to configure Stormpath as a SAML Identity Provider using only the REST API.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Currently Stormpath as an Identity Provider can only be configured via REST.</p>
</div>
<div class="section" id="step-1-gather-idp-data-from-stormpath">
<h5>Step 1: Gather IdP Data from Stormpath<a class="headerlink" href="#step-1-gather-idp-data-from-stormpath" title="Permalink to this headline">¶</a></h5>
<p>The Stormpath IdP data can be found in your Application&#8217;s SAML Policy, inside the <code class="docutils literal"><span class="pre">identityProvider</span></code> object:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/v1/samlIdentityProviders/$SAML_IDP_ID</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/xml</span>
</pre></div>
</div>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/samlIdentityProviders/7l4yLIJYpzpdfj7gEvDiz7&quot;</span><span class="p">,</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2017-01-31T23:28:39.595Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2017-01-31T23:28:39.595Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ENABLED&quot;</span><span class="p">,</span>
  <span class="nt">&quot;ssoLoginEndpoint&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://wise-galaxy.apps.stormpath.io/saml/sso&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;signatureAlgorithm&quot;</span><span class="p">:</span> <span class="s2">&quot;RSA-SHA256&quot;</span><span class="p">,</span>
  <span class="nt">&quot;shaFingerprint&quot;</span><span class="p">:</span> <span class="s2">&quot;412f20963b65114d7301350274b66b935c70e702&quot;</span><span class="p">,</span>
  <span class="nt">&quot;x509SigningCert&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/x509certificates/7l4YOyYSiX0Noaas18Oifd&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/samlIdentityProviderMetadatas/7l4yLLddka8cIYDXRB4zbB&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;attributeStatementMappingRules&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/attributeStatementMappingRules/7l4phBjC8AtDigHPUzc3Xx&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;registeredSamlServiceProviders&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/samlIdentityProviders/7l4yLIJYpzpdfj7gEvDiz7/registeredSamlServiceProviders&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;samlServiceProviderRegistrations&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/samlIdentityProviders/7l4yLIJYpzpdfj7gEvDiz7/samlServiceProviderRegistrations&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Your Service Provider will require some of the information in this resource:</p>
<ul class="simple">
<li><strong>SSO Login Endpoint:</strong> The URL at the IdP to which SAML authentication requests should be sent.</li>
<li><strong>Signature Algorithm:</strong> The algorithm used to encode the x.509 certificate.</li>
<li><strong>SHA Fingerprint:</strong> A short identifier for the x.509 certificate</li>
<li><strong>x509 Signing Certificate:</strong> This certificate is used to sign the requests sent by your Service Provider to Stormpath.</li>
</ul>
<p>Some or all of this information needs to be entered into your Service Provider&#8217;s SAML configuration.</p>
</div>
<div class="section" id="step-2-configure-your-service-provider-inside-stormpath">
<h5>Step 2: Configure your Service Provider inside Stormpath<a class="headerlink" href="#step-2-configure-your-service-provider-inside-stormpath" title="Permalink to this headline">¶</a></h5>
<p>You will need the following information from your SAML Service Provider:</p>
<ul class="simple">
<li><strong>Assertion Consumer Service (ACS) URL:</strong> The Service Provider endpoint to which SAML responses are sent.</li>
<li><strong>Entity ID:</strong> The unique identifier for the Service Provider.</li>
<li><strong>Name ID Format:</strong> The unique identifier used by the Service Provider for its user entities.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Be especially careful with these values. Even a minor change can cause an error. For example, adding a slash at the end of the Zendesk <code class="docutils literal"><span class="pre">entityId</span></code> like so: <code class="docutils literal"><span class="pre">https://YourSubdomain.zendesk.com/</span></code> will result in an error. Removing the final slash will fix the error.</p>
</div>
<p>The Name ID Format can have three possible values in Stormpath:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">EMAIL</span></code></li>
<li><code class="docutils literal"><span class="pre">PERSISTENT</span></code></li>
<li><code class="docutils literal"><span class="pre">TRANSIENT</span></code></li>
</ul>
<p>Your Service Provider&#8217;s documentation likely has the Name ID Format as a URN, in which case the end of that URN will tell you which value to use.</p>
<p>For example, Zendesk&#8217;s SAML metadata specifies this: <code class="docutils literal"><span class="pre">&lt;NameIDFormat&gt;urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress&lt;/NameIDFormat&gt;</span></code>, which means that for a Zendesk configuration in Stormpath you would give <code class="docutils literal"><span class="pre">nameIdFormat</span></code> as <code class="docutils literal"><span class="pre">EMAIL</span></code>.</p>
<p>This information is passed to Stormpath to create a new Registered SAML Service Provider:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/registeredSamlServiceProviders</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic NVdY...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json; charset=utf-8</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>

<span class="p">{</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Zendesk Example&quot;</span><span class="p">,</span>
  <span class="nt">&quot;assertionConsumerServiceURL&quot;</span><span class="p">:</span><span class="s2">&quot;https://jakubsamltest.zendesk.com/access/saml&quot;</span><span class="p">,</span>
  <span class="nt">&quot;entityId&quot;</span><span class="p">:</span><span class="s2">&quot;https://jakubsamltest.zendesk.com&quot;</span><span class="p">,</span>
  <span class="nt">&quot;nameIdFormat&quot;</span><span class="p">:</span><span class="s2">&quot;EMAIL&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>On success, you will get back the SAML Service Provider resource:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/registeredSamlServiceProviders/2wXFkagK2s52nJKFtCZoa4&quot;</span><span class="p">,</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2017-02-01T22:32:56.523Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2017-02-01T22:32:56.523Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Zendesk Example&quot;</span><span class="p">,</span>
  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;A description&quot;</span><span class="p">,</span>
  <span class="nt">&quot;assertionConsumerServiceUrl&quot;</span><span class="p">:</span> <span class="s2">&quot;https://jakubsamltest.zendesk.com/access/saml&quot;</span><span class="p">,</span>
  <span class="nt">&quot;nameIdFormat&quot;</span><span class="p">:</span> <span class="s2">&quot;EMAIL&quot;</span><span class="p">,</span>
  <span class="nt">&quot;entityId&quot;</span><span class="p">:</span> <span class="s2">&quot;https://jakubsamltest.zendesk.com/&quot;</span><span class="p">,</span>
  <span class="nt">&quot;encodedX509Certificate&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;tenant&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/tenants/1gBTncWsp2ObQGgDn9R91R&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="step-3-map-the-service-provider-to-an-identity-provider">
<h5>Step 3: Map the Service Provider to an Identity Provider<a class="headerlink" href="#step-3-map-the-service-provider-to-an-identity-provider" title="Permalink to this headline">¶</a></h5>
<p>As the final step in your Stormpath configuration, you will need to map the Service Provider resource that you just created to an existing SAML Identity Provider. Specifically, you want to map it to the SAML Identity Provider resource that you retrieved in Step 1.</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/samlIdentityProviders/7l4yLIJYpzpdfj7gEvDiz7/samlServiceProviderRegistrations</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic NVdY...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json; charset=utf-8</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>

<span class="p">{</span>
  <span class="nt">&quot;serviceProvider&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/registeredSamlServiceProviders/2wXFkagK2s52nJKFtCZoa4&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>On success you will get back the mapping object:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/samlServiceProviderRegistrations/uwpZw2A23ARPvxGSuBYUO&quot;</span><span class="p">,</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2017-02-01T22:38:14.359Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2017-02-01T22:38:14.359Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ENABLED&quot;</span><span class="p">,</span>
  <span class="nt">&quot;defaultRelayState&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;serviceProvider&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/registeredSamlServiceProviders/2wXFkagK2s52nJKFtCZoa4&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;identityProvider&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/samlIdentityProviders/7l4yLIJYpzpdfj7gEvDiz7&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>At this point, all you need to do is visit your Service Provider. You should be directed to the Stormpath ID Site, and upon logging-in, you will arrive back at your Service Provider in an authenticated state.</p>
</div>
</div>
</div>
<div class="section" id="stormpath-as-the-service-provider">
<span id="saml-sp"></span><h3><a class="toc-backref" href="#id52">4.5.2. Stormpath as the Service Provider</a><a class="headerlink" href="#stormpath-as-the-service-provider" title="Permalink to this headline">¶</a></h3>
<p>Stormpath as a Service Provider supports both Service Provider (SP) initiated and Identity Provider (IdP) initiated SAML authentication.  In SAML terminology, the user is the <strong>User Agent</strong>, your application (along with Stormpath) is the <strong>Service Provider</strong>, and the third-party SAML authentication site is the <strong>Identity Provider</strong> or <strong>IdP</strong>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When Stormpath is functioning as the Service Provider, SAML Directories are a kind of mirrored Directory, in that they are used to mirror user information found in an external database. This means that entities like Groups can only exist in a your Stormpath SAML Directory if they are mirrored in from the external SAML IdP. For more information, please see the <a class="reference internal" href="accnt_mgmt.html#about-mirror-dir"><span>Account Management chapter</span></a>.</p>
</div>
<div class="section" id="identity-provider-initiated-saml-authentication">
<h4>Identity Provider Initiated SAML Authentication<a class="headerlink" href="#identity-provider-initiated-saml-authentication" title="Permalink to this headline">¶</a></h4>
<p>With IdP-initiated SAML Authentication, the user authenticates first with the Identity Provider, and then logs into your Stormpath-enabled application from a screen inside the IdP&#8217;s site.</p>
<p>The IdP initiated process looks like this:</p>
<ol class="arabic simple">
<li>User Agent authenticates with the IdP</li>
<li>User Agent requests login to Your Application</li>
<li>IdP redirects the user to Your Application along with SAML assertions</li>
<li>Service Provider receives SAML assertions and either creates or retrieves Account information</li>
</ol>
</div>
<div class="section" id="service-provider-initiated-saml-authentication">
<h4>Service Provider Initiated SAML Authentication<a class="headerlink" href="#service-provider-initiated-saml-authentication" title="Permalink to this headline">¶</a></h4>
<p>In this scenario, a user requests a protected resource (e.g. your application). Your application, with the help of Stormpath, then confirms the user&#8217;s identity in order to determine whether they are able to access the resource.</p>
<p>The broad strokes of the process are as follows:</p>
<ol class="arabic simple">
<li>User Agent requests access from Service Provider</li>
<li>Service Provider responds with redirect to Identity Provider</li>
<li>Identity Provider authenticates the user</li>
<li>Identity provider redirects user back to Service Provider along with SAML assertions.</li>
<li>Service Provider receives SAML assertions and either creates or retrieves Account information</li>
</ol>
<p>In both cases, just like with Mirror and Directories, the user information that is returned from the IdP is used by Stormpath to either identify an existing Account resource, or create a new one. In the case of new Account creation, Stormpath will map the information in the response onto its own resources. In the following section you will walk you through the process of configuring your SAML Directory, as well as giving you an overview of how the SAML Authentication process works.</p>
<p>For a more detailed step-by-step account of SAML login, see <a class="reference internal" href="#saml-flow"><span>below</span></a>.</p>
</div>
<div class="section" id="configuring-stormpath-as-the-service-provider">
<span id="saml-configuration"></span><h4>Configuring Stormpath as the Service Provider<a class="headerlink" href="#configuring-stormpath-as-the-service-provider" title="Permalink to this headline">¶</a></h4>
<p>SAML configuration instructions can be found in the <a class="reference external" href="https://docs.stormpath.com/console/product-guide/latest/appendix-saml.html">SAML Appendix</a> of the Stormpath Admin Console Guide.</p>
<div class="section" id="salesforce">
<span id="id8"></span><h5>Salesforce<a class="headerlink" href="#salesforce" title="Permalink to this headline">¶</a></h5>
<p>Instructions for configuring Salesforce SAML can be found in the <a class="reference external" href="https://docs.stormpath.com/console/product-guide/latest/appendix-saml.html#salesforce">Stormpath Admin Console Guide</a>.</p>
</div>
<div class="section" id="onelogin">
<span id="id9"></span><h5>OneLogin<a class="headerlink" href="#onelogin" title="Permalink to this headline">¶</a></h5>
<p>Instructions for configuring OneLogin SAML can be found in the <a class="reference external" href="https://docs.stormpath.com/console/product-guide/latest/appendix-saml.html#onelogin">Stormpath Admin Console Guide</a>.</p>
</div>
<div class="section" id="okta">
<span id="id10"></span><h5>Okta<a class="headerlink" href="#okta" title="Permalink to this headline">¶</a></h5>
<p>Instructions for configuring Okta SAML can be found in the <a class="reference external" href="https://docs.stormpath.com/console/product-guide/latest/appendix-saml.html#okta">Stormpath Admin Console Guide</a>.</p>
</div>
<div class="section" id="ping">
<span id="id11"></span><h5>Ping<a class="headerlink" href="#ping" title="Permalink to this headline">¶</a></h5>
<p>Instructions for configuring Ping SAML can be found in the <a class="reference external" href="https://docs.stormpath.com/console/product-guide/latest/appendix-saml.html#ping">Stormpath Admin Console Guide</a>.</p>
</div>
<div class="section" id="active-directory-federation-services">
<span id="adfs"></span><h5>Active Directory Federation Services<a class="headerlink" href="#active-directory-federation-services" title="Permalink to this headline">¶</a></h5>
<p>Instructions for configuring ADFS SAML can be found in the <a class="reference external" href="https://docs.stormpath.com/console/product-guide/latest/appendix-saml.html#active-directory-federation-services">Stormpath Admin Console Guide</a>.</p>
</div>
<div class="section" id="azure-active-directory">
<span id="azure"></span><h5>Azure Active Directory<a class="headerlink" href="#azure-active-directory" title="Permalink to this headline">¶</a></h5>
<p>Instructions for configuring ADFS SAML can be found in the <a class="reference external" href="https://docs.stormpath.com/console/product-guide/latest/appendix-saml.html#azure-active-directory">Stormpath Admin Console Guide</a>.</p>
</div>
</div>
<div class="section" id="configuring-stormpath-as-a-service-provider-via-rest">
<span id="saml-sp-configuration-rest"></span><h4>Configuring Stormpath as a Service Provider via REST<a class="headerlink" href="#configuring-stormpath-as-a-service-provider-via-rest" title="Permalink to this headline">¶</a></h4>
<p>Here we will explain to you the steps that are required to configure Stormpath as a SAML Service Provider using only the REST API.</p>
<p>It is recommend that you configure SAML using the Stormpath Admin console, as explained in the <a class="reference external" href="https://docs.stormpath.com/console/product-guide/latest/appendix-saml.html">Client API documentation</a>. However, understanding the REST underpinnings of those instructions will allow you to automate some or all of the configuration process, if that is something that your application requires.</p>
<p>Also, currently the IdP-initiated flow can only be configured via REST, and not yet via the Stormpath Admin Console.</p>
<p>SAML configuration data is stored in the Directory&#8217;s <a class="reference internal" href="reference.html#ref-provider"><span>Provider resource</span></a> as well as in the <a class="reference internal" href="reference.html#ref-application"><span>Application</span></a>. Both of these resources must also be linked with an <a class="reference internal" href="reference.html#ref-asm"><span>Account Store Mapping</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The steps here are nearly identical regardless of whether you are configuring Service Provider initiated or IdP initiated authentication. The only difference is in <a class="reference internal" href="#saml-restconfig-5a"><span>Step 5a</span></a>.</p>
</div>
<div class="section" id="step-1-gather-idp-data">
<h5>Step 1: Gather IDP Data<a class="headerlink" href="#step-1-gather-idp-data" title="Permalink to this headline">¶</a></h5>
<p>You will need the following information from your IdP:</p>
<ul class="simple">
<li><strong>SSO Login URL</strong> - The URL at the IdP to which SAML authentication requests should be sent. This is often called an &#8220;SSO URL&#8221;, &#8220;Login URL&#8221; or &#8220;Sign-in URL&#8221;.</li>
<li><strong>SSO Logout URL</strong> - The URL at the IdP to which SAML logout requests should be sent. This is often called a &#8220;Logout URL&#8221;, &#8220;Global Logout URL&#8221; or &#8220;Single Logout URL&#8221;.</li>
<li><strong>Signing Cert</strong> - The IdP will digitally sign auth assertions and Stormpath will need to validate the signature.  This will usually be in .pem or .crt format, but Stormpath requires the text value.</li>
<li><strong>Signing Algorithm</strong> - You will need the name of the signing algorithm that your IdP uses. It will be either &#8220;RSA-SHA256&#8221; or &#8220;RSA-SHA1&#8221;.</li>
</ul>
</div>
<div class="section" id="step-2-configure-your-saml-directory">
<h5>Step 2: Configure Your SAML Directory<a class="headerlink" href="#step-2-configure-your-saml-directory" title="Permalink to this headline">¶</a></h5>
<p>Input the data you gathered in Step 1 above into your Directory&#8217;s Provider resource, and then pass that along as part of the Directory creation request:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/directories</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;My SAML Directory&quot;</span><span class="p">,</span>
  <span class="nt">&quot;description&quot;</span> <span class="p">:</span> <span class="s2">&quot;A Directory used for SAML Authorization&quot;</span><span class="p">,</span>
  <span class="nt">&quot;provider&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;providerId&quot;</span><span class="p">:</span><span class="s2">&quot;saml&quot;</span><span class="p">,</span>
    <span class="nt">&quot;ssoLoginUrl&quot;</span><span class="p">:</span><span class="s2">&quot;https://yourIdp.com/saml2/sso/login&quot;</span><span class="p">,</span>
    <span class="nt">&quot;ssoLogoutUrl&quot;</span><span class="p">:</span><span class="s2">&quot;https://yourIdp.com/saml2/sso/logout&quot;</span><span class="p">,</span>
    <span class="nt">&quot;encodedX509SigningCert&quot;</span><span class="p">:</span><span class="s2">&quot;-----BEGIN CERTIFICATE-----\n...Certificate goes here...\n-----END CERTIFICATE-----&quot;</span><span class="p">,</span>
    <span class="nt">&quot;requestSignatureAlgorithm&quot;</span><span class="p">:</span><span class="s2">&quot;RSA-SHA256&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notice that new lines in the certificate are separated with a <code class="docutils literal"><span class="pre">\n</span></code> character.</p>
</div>
</div>
<div class="section" id="step-3-retrieve-your-service-provider-metadata">
<span id="configure-sp-in-idp"></span><h5>Step 3: Retrieve Your Service Provider Metadata<a class="headerlink" href="#step-3-retrieve-your-service-provider-metadata" title="Permalink to this headline">¶</a></h5>
<p>Next you will have to configure your Stormpath-powered application as a Service Provider in your Identity Provider. This means that you will need to retrieve the correct metadata from Stormpath.</p>
<p>In order to retrieve the required values, start by sending this request:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/v1/directories/$DIRECTORY_ID/provider</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>
</div>
<p>This will return the Provider:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/v1/directories/1joyMCilyf1xSravQxaHxy/provider&quot;</span><span class="p">,</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span><span class="s2">&quot;2015-12-21T20:27:16.190Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span><span class="s2">&quot;2015-12-21T20:27:16.190Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;providerId&quot;</span><span class="p">:</span><span class="s2">&quot;saml&quot;</span><span class="p">,</span>
  <span class="nt">&quot;ssoLoginUrl&quot;</span><span class="p">:</span><span class="s2">&quot;https://stormpathsaml-dev-ed.my.salesforce.com/idp/endpoint/HttpRedirect&quot;</span><span class="p">,</span>
  <span class="nt">&quot;ssoLogoutUrl&quot;</span><span class="p">:</span><span class="s2">&quot;https://stormpathsaml-dev-ed.my.salesforce.com/idp/endpoint/HttpRedirect&quot;</span><span class="p">,</span>
  <span class="nt">&quot;encodedX509SigningCert&quot;</span><span class="p">:</span><span class="s2">&quot;-----BEGIN CERTIFICATE-----\nexample\n-----END CERTIFICATE-----&quot;</span><span class="p">,</span>
  <span class="nt">&quot;requestSignatureAlgorithm&quot;</span><span class="p">:</span><span class="s2">&quot;RSA-SHA256&quot;</span><span class="p">,</span>
  <span class="nt">&quot;attributeStatementMappingRules&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/v1/attributeStatementMappingRules/1jq5X3PhdEZJ5EL5MORdTG&quot;</span>
  <span class="p">},</span>
<span class="hll">  <span class="nt">&quot;serviceProviderMetadata&quot;</span><span class="p">:{</span>
</span><span class="hll">    <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/v1/samlServiceProviderMetadatas/1l4aLK8aJPNtwslBgXBjGE&quot;</span>
</span>  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now you will need to retrieve your Directory Provider&#8217;s Service Provider Metadata:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/v1/samlServiceProviderMetadatas/$METADATA_ID</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/xml</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This will return XML by default, but you can also specify <code class="docutils literal"><span class="pre">application/json</span></code> if you&#8217;d like to receive JSON instead.</p>
</div>
<p><strong>Example XML</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span>
<span class="nt">&lt;md:EntityDescriptor</span> <span class="na">xmlns:md=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:metadata&quot;</span> <span class="na">entityID=</span><span class="s">&quot;urn:stormpath:directory:5rHYCSu9IjzKz5pkyId5eR:provider:sp&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;md:SPSSODescriptor</span> <span class="na">protocolSupportEnumeration=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:protocol&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;md:KeyDescriptor</span> <span class="na">use=</span><span class="s">&quot;signing&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;ds:KeyInfo</span> <span class="na">xmlns:ds=</span><span class="s">&quot;http://www.w3.org/2000/09/xmldsig#&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;ds:X509Data&gt;</span>
                    <span class="nt">&lt;ds:X509Certificate&gt;</span>MIIC2DCCAcCgAwIBAgIRAMExAMPLE<span class="nt">&lt;/ds:X509Certificate&gt;</span>
                <span class="nt">&lt;/ds:X509Data&gt;</span>
            <span class="nt">&lt;/ds:KeyInfo&gt;</span>
        <span class="nt">&lt;/md:KeyDescriptor&gt;</span>
        <span class="nt">&lt;md:NameIDFormat&gt;</span>urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress<span class="nt">&lt;/md:NameIDFormat&gt;</span>
        <span class="nt">&lt;md:AssertionConsumerService</span> <span class="na">Binding=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST&quot;</span> <span class="na">Location=</span><span class="s">&quot;http://api.stormpath.com/v1/directories/5rHYCSu9IjzKz5pEXample/saml/sso/post&quot;</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/md:SPSSODescriptor&gt;</span>
<span class="nt">&lt;/md:EntityDescriptor&gt;</span>
</pre></div>
</div>
<p><strong>Example JSON</strong></p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;http://api.stormpath.com/v1/samlServiceProviderMetadatas/173pHdbJ96DpPeuExaMPLE&quot;</span><span class="p">,</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span><span class="s2">&quot;2015-12-09T19:22:10.033Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span><span class="s2">&quot;2015-12-09T19:22:10.033Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;entityId&quot;</span><span class="p">:</span><span class="s2">&quot;urn:stormpath:directory:15iM83Y77qIIviKlTzGqjX:provider:sp&quot;</span><span class="p">,</span>
  <span class="nt">&quot;assertionConsumerServicePostEndpoint&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;http://api.stormpath.com/v1/directories/5rHYCSu9IjzKz5pEXample/saml/sso/post&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;x509SigningCert&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;http://api.stormpath.com/v1/x509certificates/1712LVrz0fNSMk2y20EzfL&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>From this metadata, you will need two values:</p>
<ul class="simple">
<li><strong>Assertion Consumer Service Endpoint</strong>: This is the location the IdP will send its response to.</li>
<li><strong>X509 Signing Certificate</strong>: The certificate that is used to sign the requests sent to the IdP. If you retrieve XML, the certificate will be embedded. If you retrieve JSON, you&#8217;ll have to follow a further <code class="docutils literal"><span class="pre">/x509certificates</span></code> link to retrieve it.</li>
</ul>
<p>You will also need two other values, which will always be the same:</p>
<ul class="simple">
<li><strong>SAML Request Binding:</strong> Set to <code class="docutils literal"><span class="pre">HTTP-Redirect</span></code>.</li>
<li><strong>SAML Response Binding:</strong> Set to <code class="docutils literal"><span class="pre">HTTP-Post</span></code>.</li>
</ul>
</div>
<div class="section" id="step-4-configure-your-service-provider-in-your-identity-provider">
<h5>Step 4: Configure Your Service Provider in Your Identity Provider<a class="headerlink" href="#step-4-configure-your-service-provider-in-your-identity-provider" title="Permalink to this headline">¶</a></h5>
<p>Log-in to your Identity Provider (Salesforce, OneLogin, etc) and enter the information you retrieved in the previous step into the relevant application configuration fields. The specific steps to follow here will depend entirely on what Identity Provider you use, and for more information you should consult your Identity Provider&#8217;s SAML documentation.</p>
</div>
<div class="section" id="step-5-configure-your-application">
<h5>Step 5: Configure Your Application<a class="headerlink" href="#step-5-configure-your-application" title="Permalink to this headline">¶</a></h5>
<p>Your Stormpath Application Resource has two parts that are relevant to SAML:</p>
<ol class="arabic simple">
<li>An <code class="docutils literal"><span class="pre">authorizedCallbackUri</span></code> Array that defines the authorized URIs that the IdP can return your user to with the authentication result. These should be URIs that you host yourself.</li>
</ol>
<p>You should create any URIs here that you would like included as authorized callback URIs, to a maximum of 4000 characters in total length.</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/applications/$APPLICATION_ID</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;authorizedCallbackUris&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;https://myapplication.com/whatever/callback&quot;</span><span class="p">,</span>
    <span class="s2">&quot;https://myapplication.com/whatever/callback2&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>There is also an embedded <code class="docutils literal"><span class="pre">samlPolicy</span></code> object that contains information about the SAML flow configuration and endpoints:</li>
</ol>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/v1/samlServiceProviders/61fOguTd49bCKEJbuLnFHO&quot;</span><span class="p">,</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span><span class="s2">&quot;2016-01-18T21:02:24.501Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span><span class="s2">&quot;2016-01-18T21:02:24.501Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;ssoInitiationEndpoint&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/v1/applications/61eykaiWwglwT5mngYyExu/saml/sso/idpRedirect&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;defaultRelayStates&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/v1/samlServiceProviders/61fOguTd49bCKEJbuLnFHO/defaultRelayStates&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="step-5a-generate-defaultrelaystate-idp-initiated-authentication-only">
<span id="saml-restconfig-5a"></span><h6>Step 5a: Generate defaultRelayState (IdP-initiated Authentication Only)<a class="headerlink" href="#step-5a-generate-defaultrelaystate-idp-initiated-authentication-only" title="Permalink to this headline">¶</a></h6>
<p>To configure your IdP for IdP-initiated authentication, you will need to get a <code class="docutils literal"><span class="pre">defaultRelayState</span></code> JWT:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/samlServiceProviders/6voAya1BvrNeFOAeXamPle/defaultRelayStates</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
</pre></div>
</div>
<p>This request will return a response containing a JWT like this:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;defaultRelayState&quot;</span><span class="p">:</span> <span class="s2">&quot;eyJ0aWQiOiIxZ0JUbmNXc3AyT2JRR2dEbjlSOTFSIiwiYWxnIjoiSFMyNTYifQ.eyJzcFVpZCI6IjZ2b0F5YTFCdnJOZUZPQW9neGJ4T2UiLCJqdGkiOiIxdjdjT1l1SE1kQzA0Z2Vucm1wU2lZIn0.WvfWRxTfjRoPxA803HyOR380u2dWpdtQiO0I2kislFY&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This JWT will then need to be entered into your IdP&#8217;s configuration in order for IdP-initiated authentication to function properly.</p>
<p>This <code class="docutils literal"><span class="pre">defaultRelayStates/</span></code> endpoint also accepts a few optional properties. These properties can be encoded in the defaultRelayState JWT that is stored on your IdP by passing them in the body of your POST:</p>
<ul class="simple">
<li><strong>callbackUri</strong>: Specifies the callBackUri to direct users to. Useful if there are multiple callbackUris specified in your Application.</li>
<li><strong>organization</strong>: Allows you to specify an Organization to check users for.</li>
<li><strong>state</strong>: Any state that your application would like to receive. Note that the application developer will need to interpret this state.</li>
</ul>
<p>A request including these optional properties looks like this:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/samlServiceProviders/6voAya1BvrNeFOAeXamPle/defaultRelayStates</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>

{
    &quot;callbackUri&quot;: &quot;https://org1.myapp.com&quot;,
    &quot;organization&quot;: {
        &quot;nameKey&quot;: &quot;org1&quot;,
    }
    &quot;state&quot;: &quot;IAmAState&quot;
}
</pre></div>
</div>
</div>
</div>
<div class="section" id="step-6-add-the-saml-directory-as-an-account-store">
<h5>Step 6: Add the SAML Directory as an Account Store<a class="headerlink" href="#step-6-add-the-saml-directory-as-an-account-store" title="Permalink to this headline">¶</a></h5>
<p>Now the last thing you have to do is map the new Directory to your Application with an Account Store Mapping as described in <a class="reference internal" href="#create-asm"><span>Mapping a new Account Store</span></a>.</p>
</div>
<div class="section" id="step-7-configure-saml-attribute-mapping-optional">
<span id="saml-mapping"></span><h5>Step 7: Configure SAML Attribute Mapping (Optional)<a class="headerlink" href="#step-7-configure-saml-attribute-mapping-optional" title="Permalink to this headline">¶</a></h5>
<p>The Identity Provider&#8217;s SAML response contains assertions about the user&#8217;s identity, which Stormpath can use to create and populate a new Account resource.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;saml:AttributeStatement&gt;</span>
  <span class="nt">&lt;saml:Attribute</span> <span class="na">Name=</span><span class="s">&quot;uid&quot;</span> <span class="na">NameFormat=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:attrname-format:basic&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;saml:AttributeValue</span> <span class="na">xsi:type=</span><span class="s">&quot;xs:string&quot;</span><span class="nt">&gt;</span>test<span class="nt">&lt;/saml:AttributeValue&gt;</span>
  <span class="nt">&lt;/saml:Attribute&gt;</span>
  <span class="nt">&lt;saml:Attribute</span> <span class="na">Name=</span><span class="s">&quot;mail&quot;</span> <span class="na">NameFormat=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:attrname-format:basic&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;saml:AttributeValue</span> <span class="na">xsi:type=</span><span class="s">&quot;xs:string&quot;</span><span class="nt">&gt;</span>jane@example.com<span class="nt">&lt;/saml:AttributeValue&gt;</span>
  <span class="nt">&lt;/saml:Attribute&gt;</span>
    <span class="nt">&lt;saml:Attribute</span> <span class="na">Name=</span><span class="s">&quot;location&quot;</span> <span class="na">NameFormat=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:attrname-format:basic&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;saml:AttributeValue</span> <span class="na">xsi:type=</span><span class="s">&quot;xs:string&quot;</span><span class="nt">&gt;</span>Tampa, FL<span class="nt">&lt;/saml:AttributeValue&gt;</span>
  <span class="nt">&lt;/saml:Attribute&gt;</span>
<span class="nt">&lt;/saml:AttributeStatement&gt;</span>
</pre></div>
</div>
<p>The Attribute Assertions (<code class="docutils literal"><span class="pre">&lt;saml:AttributeStatement&gt;</span></code>) are brought into Stormpath and become Account and customData attributes.</p>
<p>SAML Attribute mapping is defined in an <strong>attributeStatementMappingRules</strong> object found inside the Directory&#8217;s Provider object, or directly: <code class="docutils literal"><span class="pre">/v1/attributeStatementMappingRules/$RULES_ID</span></code>.</p>
<div class="section" id="mapping-rules">
<h6>Mapping Rules<a class="headerlink" href="#mapping-rules" title="Permalink to this headline">¶</a></h6>
<p>The rules have three different components:</p>
<ul class="simple">
<li><strong>name</strong>: The SAML Attribute name</li>
<li><strong>nameFormat</strong>: The name format for this SAML Attribute, expressed as a Uniform Resource Name (URN).</li>
<li><strong>accountAttributes</strong>: This is an array of Stormpath Account or customData (<code class="docutils literal"><span class="pre">customData.$KEY_NAME</span></code>) attributes that will map to this SAML Attribute.</li>
</ul>
<p><strong>Example Rule</strong></p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;uid&quot;</span><span class="p">,</span>
  <span class="nt">&quot;nameFormat&quot;</span><span class="p">:</span> <span class="s2">&quot;urn:oasis:names:tc:SAML:2.0:attrname-format:basic&quot;</span><span class="p">,</span>
  <span class="nt">&quot;accountAttributes&quot;</span><span class="p">:[</span>
    <span class="s2">&quot;username&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The rule expressed here is as follows:</p>
<ul class="simple">
<li>A SAML Assertion with the name <code class="docutils literal"><span class="pre">uid</span></code> AND</li>
<li>the name format <code class="docutils literal"><span class="pre">urn:oasis:names:tc:SAML:2.0:attrname-format:basic</span></code></li>
<li>maps to the Account Attribute <code class="docutils literal"><span class="pre">username</span></code>.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is possible to specify only a <code class="docutils literal"><span class="pre">name</span></code> or <code class="docutils literal"><span class="pre">nameFormat</span></code> in your rule, instead of both.</p>
</div>
<p>In order to create the mapping rules, you send the following request:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/attributeStatementMappingRules/$MAPPING_RULES_ID&quot;,</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;items&quot;</span><span class="p">:[</span>
    <span class="p">{</span>
      <span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span>
      <span class="nt">&quot;accountAttributes&quot;</span><span class="p">:[</span>
        <span class="s2">&quot;username&quot;</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;mail&quot;</span><span class="p">,</span>
      <span class="nt">&quot;accountAttributes&quot;</span><span class="p">:[</span>
        <span class="s2">&quot;email&quot;</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;location&quot;</span><span class="p">,</span>
      <span class="nt">&quot;accountAttributes&quot;</span><span class="p">:[</span>
        <span class="s2">&quot;customData.location&quot;</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="the-stormpath-saml-flow">
<span id="saml-flow"></span><h3><a class="toc-backref" href="#id53">4.5.4. The Stormpath SAML Flow</a><a class="headerlink" href="#the-stormpath-saml-flow" title="Permalink to this headline">¶</a></h3>
<p>There are three kinds of SAML flows that are possible:</p>
<ol class="arabic simple">
<li>Service Provider-initiated, with Stormpath as the Identity Provider</li>
<li>Service Provider-initiated, with Stormpath as the Service Provider</li>
<li>Identity Provider-initiated, with Stormpath as the Service Provider</li>
</ol>
<div class="section" id="with-stormpath-as-the-identity-provider">
<h4>With Stormpath as the Identity Provider<a class="headerlink" href="#with-stormpath-as-the-identity-provider" title="Permalink to this headline">¶</a></h4>
<p>The flow that has Stormpath as your Identity Provider is more simplified than the other two because it makes use of the new Client API endpoints.</p>
<div class="figure align-center" id="id19">
<a class="reference internal image-reference" href="_images/SamlFlow_SaSIdP.png"><img alt="IdP Initiated SAML Flow" src="_images/SamlFlow_SaSIdP.png" /></a>
<p class="caption"><span class="caption-text"><em>Stormpath as the SAML IdP</em></span></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Depending on the Service Provider, the redirect may not happen automatically. The user may need to click on a &#8220;Login with x&#8221; link before they are redirected to the Stormpath Client API.</p>
</div>
<p>Since Stormpath handles the majority of these steps automatically, no further information is required to get this process working.</p>
</div>
<div class="section" id="with-stormpath-as-the-service-provider">
<h4>With Stormpath as the Service Provider<a class="headerlink" href="#with-stormpath-as-the-service-provider" title="Permalink to this headline">¶</a></h4>
<p>The two SAML authentication flows that Stormpath supports differ primarily in their starting points, and so <a class="reference internal" href="#saml-sp-init-flow"><span>the Service Provider (SP) initiated flow</span></a> is really just the Identity Provider (IdP) initiated flow with a different starting point.</p>
<div class="section" id="the-identity-provider-initiated-flow">
<span id="saml-idp-init-flow"></span><h5>The Identity Provider Initiated Flow<a class="headerlink" href="#the-identity-provider-initiated-flow" title="Permalink to this headline">¶</a></h5>
<p>In the Identity Provider Initiated flow, the user starts at the Identity Provider (IdP). After logging-in to the IdP, the user selects the Stormpath-enabled web application from within the IdP&#8217;s site, and is redirected to the application in an authenticated state.</p>
<div class="figure align-center" id="id20">
<a class="reference internal image-reference" href="_images/SamlFlow_IdpInit.png"><img alt="IdP Initiated SAML Flow" src="_images/SamlFlow_IdpInit.png" /></a>
<p class="caption"><span class="caption-text"><em>The IdP Initiated SAML Flow</em></span></p>
</div>
<div class="section" id="step-1-identity-provider-login">
<h6>Step 1: Identity Provider Login<a class="headerlink" href="#step-1-identity-provider-login" title="Permalink to this headline">¶</a></h6>
<p>First the user will have to authenticate with the Identity Provider. They will then be provided with a list of configured applications that they are able to log in to. If they choose to log in to your Stormpath-enabled application, this will result in the IdP redirecting them to Stormpath.</p>
</div>
<div class="section" id="step-2-redirect-to-assertion-consumer-service-url">
<h6>Step 2: Redirect to Assertion Consumer Service URL<a class="headerlink" href="#step-2-redirect-to-assertion-consumer-service-url" title="Permalink to this headline">¶</a></h6>
<p>The user is redirected to the Assertion Consumer Service URL (<code class="docutils literal"><span class="pre">/saml/sso/post</span></code>) that is found in the Service Provider Metadata. At this point, an Account will either be retrieved (if it already exists) or created (if it doesn&#8217;t exist already).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Account matching is done on the basis of the returned email address.</p>
</div>
</div>
<div class="section" id="step-3-stormpath-response-with-jwt">
<h6>Step 3: Stormpath Response with JWT<a class="headerlink" href="#step-3-stormpath-response-with-jwt" title="Permalink to this headline">¶</a></h6>
<p>The user will now be redirected by Stormpath back to your Application along with a JSON Web Token.</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Redirect</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://myapplication.com/whatever/callback?jwtResponse=$RESPONSE_JWT</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="saml-account-assertion-jwt">
<span id="saml-response-jwt"></span><h5>SAML Account Assertion JWT<a class="headerlink" href="#saml-account-assertion-jwt" title="Permalink to this headline">¶</a></h5>
<p>This JWT again contains both Headers and a Body with Claims.</p>
<p><strong>Header</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="12%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Claim Name</th>
<th class="head">Required?</th>
<th class="head">Valid Value(s)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">typ</span></code></td>
<td>Yes</td>
<td>The type of token, which will be <code class="docutils literal"><span class="pre">JWT</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">alg</span></code></td>
<td>Yes</td>
<td>The algorithm that was used to sign this key. The only possible value is <code class="docutils literal"><span class="pre">HS256</span></code>.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">stt</span></code></td>
<td>Yes</td>
<td>The Stormpath Token Type. In this case it will always be <code class="docutils literal"><span class="pre">assertion</span></code>.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">kid</span></code></td>
<td>Yes</td>
<td>The ID of the Stormpath API Key that signed this JWT.</td>
</tr>
</tbody>
</table>
<p><strong>Body</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Claim Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">iss</span></code></td>
<td>The issuer of this token, which will contain your Application <code class="docutils literal"><span class="pre">href</span></code>.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">sub</span></code></td>
<td>The subject of the JWT. This will be an <code class="docutils literal"><span class="pre">href</span></code> for the Stormpath Account that signed up or logged into the SAML IdP. This <code class="docutils literal"><span class="pre">href</span></code> can be queried by using the REST API to get more information about the Account.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">aud</span></code></td>
<td>The audience of the JWT. This will match your API Key ID from Stormpath.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">exp</span></code></td>
<td>The expiration time for the JWT in Unix time.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">iat</span></code></td>
<td>The time at which the JWT was created, in Unix time.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">jti</span></code></td>
<td>A one-time-use-token for the JWT. If you require additional security around the validation of the token, you can store the <code class="docutils literal"><span class="pre">jti</span></code> in your application to validate that a particular JWT has only been used once.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">state</span></code></td>
<td>The state of your application, if you have chosen to have this passed back.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">status</span></code></td>
<td>For a SAML IdP the only possible <code class="docutils literal"><span class="pre">status</span></code> is <code class="docutils literal"><span class="pre">AUTHENTICATED</span></code>.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">irt</span></code></td>
<td>The UUID of the SAML Assertion response. This could be cached as a nonce in order to prevent replay attacks.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">isNewSub</span></code></td>
<td>Indicates whether this is a new Account in Stormpath.</td>
</tr>
</tbody>
</table>
<p>At this point your user is authenticated and able to use your app.</p>
</div>
<div class="section" id="the-service-provider-initiated-flow">
<span id="saml-sp-init-flow"></span><h5>The Service Provider Initiated Flow<a class="headerlink" href="#the-service-provider-initiated-flow" title="Permalink to this headline">¶</a></h5>
<p>In the Service Provider Initiated flow, the user starts at a login page (either ID Site or one inside a Stormpath-powered application), then is redirected to the Identity Provider. After authenticating with the Identity Provider, the user is returned to the application in an authenticate state.</p>
<div class="figure align-center" id="id21">
<a class="reference internal image-reference" href="_images/SamlFlow_SpInit.png"><img alt="Service Provider Initiated SAML Flow" src="_images/SamlFlow_SpInit.png" /></a>
<p class="caption"><span class="caption-text"><em>The Service Provider Initiated SAML Flow</em></span></p>
</div>
</div>
<div class="section" id="step-1-generate-a-jwt">
<h5>Step 1: Generate a JWT<a class="headerlink" href="#step-1-generate-a-jwt" title="Permalink to this headline">¶</a></h5>
<p>The user agent will request to login with SAML. You will need to generate a JWT using an approved JWT library.</p>
<p>Below are language specific JWT libraries that Stormpath has sanity tested with ID Site.</p>
<ul class="simple">
<li>.NET JWT - <a class="reference external" href="https://github.com/jwt-dotnet/jwt">https://github.com/jwt-dotnet/jwt</a></li>
<li>Ruby JWT - <a class="reference external" href="https://github.com/jwt/ruby-jwt">https://github.com/jwt/ruby-jwt</a></li>
<li>Go JWT - <a class="reference external" href="https://github.com/dgrijalva/jwt-go">https://github.com/dgrijalva/jwt-go</a></li>
<li>PHP JWT - <a class="reference external" href="https://github.com/firebase/php-jwt">https://github.com/firebase/php-jwt</a></li>
<li>Python JWT - <a class="reference external" href="https://github.com/jpadilla/pyjwt">https://github.com/jpadilla/pyjwt</a></li>
<li>Java JWT - <a class="reference external" href="https://github.com/jwtk/jjwt">https://github.com/jwtk/jjwt</a></li>
<li>Node JWT - <a class="reference external" href="https://github.com/jwtk/njwt">https://github.com/jwtk/njwt</a></li>
</ul>
<div class="section" id="saml-authentication-jwt">
<h6>SAML Authentication JWT<a class="headerlink" href="#saml-authentication-jwt" title="Permalink to this headline">¶</a></h6>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This key must be signed with your API Key Secret.</p>
</div>
<p>The token itself will contain two parts, a Header and a Body that itself contains claims.</p>
<p><strong>Header</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="12%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Header Name</th>
<th class="head">Required?</th>
<th class="head">Valid Value(s)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">kid</span></code></td>
<td>Yes</td>
<td>Your Stormpath API Key ID.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">alg</span></code></td>
<td>Yes</td>
<td>The algorithm that was used to sign this key. The only valid value is <code class="docutils literal"><span class="pre">HS256</span></code>.</td>
</tr>
</tbody>
</table>
<p><strong>Body</strong></p>
<p>The <a class="reference external" href="https://tools.ietf.org/html/rfc7519#section-4.1">claims</a> for the JWT body are as follows:</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="12%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Claim Name</th>
<th class="head">Required?</th>
<th class="head">Valid Value(s)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">iat</span></code></td>
<td>Yes</td>
<td>The &#8220;Issued At Time&#8221;, which is the time the token was issued, expressed in Unix time.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">iss</span></code></td>
<td>Yes</td>
<td>The issuer of the token. This is your Application <code class="docutils literal"><span class="pre">href</span></code>.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">cb_uri</span></code></td>
<td>No</td>
<td>The callback URI to use once the user takes an action on the ID Site or Identity provider. This URI will be passed a secure JWT as a URL parameter, and it&#8217;s job will be to validate that JWT and return the Stormpath Account. This URI must match a Authorized Callback URI on an Application resource, otherwise the flow will default to the first Callback URI that does not contain a wildcard.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">jti</span></code></td>
<td>Yes</td>
<td>A universally unique identifier for the token. This can be generated using a GUID or UUID function of your choice.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">state</span></code></td>
<td>No</td>
<td>The state of the application that you need to pass through ID Site or the IdP back to your application through the callback. It is up to the developer to serialize/deserialize this value</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ash</span></code></td>
<td>No</td>
<td>Specifies a link to an Account Store to attempt to authenticate against.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">onk</span></code></td>
<td>No</td>
<td>The string representing the <code class="docutils literal"><span class="pre">nameKey</span></code> for an Organization that is an Account Store for your application. This is used for multitenant applications that use SAML.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="step-2-initiate-the-flow">
<h5>Step 2: Initiate the flow<a class="headerlink" href="#step-2-initiate-the-flow" title="Permalink to this headline">¶</a></h5>
<p>Once the JWT is generated by your server, you initiate the SAML flow by sending a GET to the value found in the <code class="docutils literal"><span class="pre">ssoInitiationEndpoint</span></code>, which is <code class="docutils literal"><span class="pre">/v1/applications/$APPLICATION_ID/saml/sso/idpRedirect</span></code> along with the JWT you just generated:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/v1/applications/$APPLICATION_ID/saml/sso/idpRedirect?accessToken=$GENERATED_JWT</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>
</pre></div>
</div>
</div>
<div class="section" id="step-3-redirection">
<h5>Step 3: Redirection<a class="headerlink" href="#step-3-redirection" title="Permalink to this headline">¶</a></h5>
<p>This GET will result in a redirection to the IdP Login URL that you specified during configuration:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Redirect</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://idp.whatever.com/saml2/sso/login?SAMLRequest=fZFfa8IwFMXfBb9DyXvaJtZ1BqsURRC2Mabbw95ivc5Am3TJrXPffmmLY3%2F...</span>
</pre></div>
</div>
</div>
<div class="section" id="step-4-identity-provider-login">
<h5>Step 4: Identity Provider Login<a class="headerlink" href="#step-4-identity-provider-login" title="Permalink to this headline">¶</a></h5>
<p>At this point the IdP will render their login page, and the user will authenticate.</p>
</div>
<div class="section" id="step-5-redirect-to-assertion-consumer-service-url">
<h5>Step 5: Redirect to Assertion Consumer Service URL<a class="headerlink" href="#step-5-redirect-to-assertion-consumer-service-url" title="Permalink to this headline">¶</a></h5>
<p>After authentication the user is redirected back to the Assertion Consumer Service URL that is found in the Service Provider Metadata. At this point, an Account will either be retrieved (if it already exists) or created (if it doesn&#8217;t exist already).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Account matching is done on the basis of the returned email address.</p>
</div>
</div>
<div class="section" id="step-6-stormpath-response-with-jwt">
<h5>Step 6: Stormpath Response with JWT<a class="headerlink" href="#step-6-stormpath-response-with-jwt" title="Permalink to this headline">¶</a></h5>
<p>The user will now be redirected by Stormpath back to your Application along with a JSON Web Token.</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Redirect</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://myapplication.com/whatever/callback?jwtResponse=$RESPONSE_JWT</span>
</pre></div>
</div>
<p>For more information about what is contained in this token, please see <a class="reference internal" href="#saml-response-jwt"><span>above</span></a>.</p>
<p>At this point your user is authenticated and able to use your app.</p>
</div>
</div>
</div>
</div>
<div class="section" id="using-multi-factor-authentication-mfa">
<span id="mfa"></span><h2>4.6. Using Multi-Factor Authentication (MFA)<a class="headerlink" href="#using-multi-factor-authentication-mfa" title="Permalink to this headline">¶</a></h2>
<p>At a minimum, an Account in Stormpath requires at least one authentication factor, which is the password. However, if you would like to include additional security then Stormpath supports the creation of additional authentication factors on an Account. Currently, the additional factors are:</p>
<ul class="simple">
<li>SMS message to a phone</li>
<li>Google Authenticator</li>
</ul>
<p>The multi-factor authentication process works as follows with text messages:</p>
<ol class="arabic simple">
<li>An additional <strong>Factor</strong> of type <code class="docutils literal"><span class="pre">SMS</span></code> is added to an Account.</li>
<li>A <strong>Challenge</strong> is created which includes a message.</li>
<li>The message is sent to the phone number found in the Factor with a one-time numerical <strong>code</strong>.</li>
<li>If that <strong>code</strong> is then passed back to the appropriate Challenge within a sufficient time window, you will get back either a <code class="docutils literal"><span class="pre">SUCCESS</span></code> or <code class="docutils literal"><span class="pre">FAILED</span></code> response.</li>
</ol>
<p>With Google Authenticator, the flow is only slightly different:</p>
<ol class="arabic simple">
<li>An additional <strong>Factor</strong> of type <code class="docutils literal"><span class="pre">google-authenticator</span></code> is added to an Account.</li>
<li>The new <strong>Factor</strong> has a <strong>secret</strong> and a Base64-encoded <strong>QR code</strong>, both of which can be used to add it to the Google Authenticator (or <a class="reference external" href="https://www.authy.com/tutorials/how-use-authy-google-authenticator/">similar</a>) app.</li>
<li>At any time, you can send the <strong>code</strong> from the Authenticator app to Stormpath&#8217;s <code class="docutils literal"><span class="pre">/challenges</span></code> endpoint, at which point you will get back either a <code class="docutils literal"><span class="pre">SUCCESS</span></code> or <code class="docutils literal"><span class="pre">FAILED</span></code> response.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Multi-Factor Authentication is only available with paid Stormpath plans. For more information please see <a class="reference external" href="https://stormpath.com/pricing">Stormpath&#8217;s Pricing Page</a>.</p>
</div>
<div class="section" id="enrolling-an-additional-factor">
<span id="mfa-adding-factor"></span><h3>4.6.1. Enrolling an Additional Factor<a class="headerlink" href="#enrolling-an-additional-factor" title="Permalink to this headline">¶</a></h3>
<p>Enrolling an additional authentication factor always happens separate from Account creation, so the process is the same regardless of whether you are creating a factor for an existing Account or one that was just created. For this example, we will create a new Account in Stormpath, then add an additional Factor resource to it.</p>
<p>First, you create the Account:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/applications/1gk4Dxzi6o4PbdleXaMPLE/accounts</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Cache-Control</span><span class="o">:</span> <span class="l">no-cache</span>

<span class="p">{</span>
    <span class="nt">&quot;givenName&quot;</span><span class="p">:</span> <span class="s2">&quot;Joe&quot;</span><span class="p">,</span>
    <span class="nt">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Factorman&quot;</span><span class="p">,</span>
    <span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;factorman&quot;</span><span class="p">,</span>
    <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;joe.factorman@stormpath.com&quot;</span><span class="p">,</span>
    <span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="s2">&quot;Changeme1&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="adding-an-sms-factor">
<span id="mfa-adding-factor-sms"></span><h4>Adding an SMS Factor<a class="headerlink" href="#adding-an-sms-factor" title="Permalink to this headline">¶</a></h4>
<p>To add an additional SMS Factor to this Account, you send the following request:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/accounts/5IvkjoqcYNe3TYMExample/factors</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
  <span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;SMS&quot;</span><span class="p">,</span>
  <span class="nt">&quot;phone&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;number&quot;</span><span class="p">:</span> <span class="s2">&quot;2675555555&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You will then get back the response:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/factors/29b9PiAaWqr9Hanexample&quot;</span><span class="p">,</span>
  <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;SMS&quot;</span><span class="p">,</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-09-22T21:34:00.881Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-09-22T21:34:00.881Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ENABLED&quot;</span><span class="p">,</span>
  <span class="nt">&quot;verificationStatus&quot;</span><span class="p">:</span> <span class="s2">&quot;UNVERIFIED&quot;</span><span class="p">,</span>
  <span class="nt">&quot;account&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/5IvkjoqcYNe3TYMExample&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;challenges&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/factors/29b9PiAaWqr9Hanexample/challenges&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;phone&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/phones/29b9PeqVcGYAelhExample&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;mostRecentChallenge&quot;</span><span class="p">:</span> <span class="kc">null</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For now the <code class="docutils literal"><span class="pre">verificationStatus</span></code> is <code class="docutils literal"><span class="pre">UNVERIFIED</span></code> and the link to the <code class="docutils literal"><span class="pre">mostRecentChallenge</span></code> is <code class="docutils literal"><span class="pre">null</span></code>. If you were to send a challenge to this Factor, the <code class="docutils literal"><span class="pre">mostRecentChallenge</span></code> link would be populated. If that challenge was successful, the <code class="docutils literal"><span class="pre">verificationStatus</span></code> would change to <code class="docutils literal"><span class="pre">VERIFIED</span></code>.</p>
<p>For more information about the Factor resource, see <a class="reference internal" href="reference.html#ref-factor"><span>the Reference chapter</span></a>.</p>
</div>
<div class="section" id="adding-a-google-authenticator-factor">
<span id="mfa-adding-factor-google"></span><h4>Adding a Google Authenticator Factor<a class="headerlink" href="#adding-a-google-authenticator-factor" title="Permalink to this headline">¶</a></h4>
<p>To add an additional Google Authenticator Factor to this Account, you must send the following request:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/accounts/5IvkjoqcYNe3TYMYExample/factors</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>

<span class="p">{</span>
  <span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;google-authenticator&quot;</span><span class="p">,</span>
  <span class="nt">&quot;accountName&quot;</span><span class="p">:</span> <span class="s2">&quot;jakub@stormpath.com&quot;</span><span class="p">,</span>
  <span class="nt">&quot;issuer&quot;</span><span class="p">:</span> <span class="s2">&quot;Example App&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Although the <code class="docutils literal"><span class="pre">issuer</span></code> field is not required, it is recommended because it will make a name show up under the code in the Google Authenticator (or <a class="reference external" href="https://www.authy.com/tutorials/how-use-authy-google-authenticator/">similar</a>) app.</p>
</div>
<p>You will then get back the response:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/factors/46EZpOuefEEooFlexample&quot;</span><span class="p">,</span>
  <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;google-authenticator&quot;</span><span class="p">,</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-09-22T21:42:57.636Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-09-22T21:42:57.636Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ENABLED&quot;</span><span class="p">,</span>
  <span class="nt">&quot;accountName&quot;</span><span class="p">:</span> <span class="s2">&quot;jakub@stormpath.com&quot;</span><span class="p">,</span>
  <span class="nt">&quot;issuer&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;secret&quot;</span><span class="p">:</span> <span class="s2">&quot;OP7JZ[...]LAV&quot;</span><span class="p">,</span>
  <span class="nt">&quot;keyUri&quot;</span><span class="p">:</span> <span class="s2">&quot;otpauth://totp/jakub%40stormpath.com?secret=OP7JZ[...]LAV&quot;</span><span class="p">,</span>
  <span class="nt">&quot;base64QRImage&quot;</span><span class="p">:</span> <span class="s2">&quot;iVBOR[...]SuQmCC&quot;</span><span class="p">,</span>
  <span class="nt">&quot;verificationStatus&quot;</span><span class="p">:</span> <span class="s2">&quot;UNVERIFIED&quot;</span><span class="p">,</span>
  <span class="nt">&quot;account&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/5IvkjoqcYNe3TYMYExample&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;mostRecentChallenge&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;challenges&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/factors/46EZpOuefEEooFlexample/challenges&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For more information about the Factor resource, see <a class="reference internal" href="reference.html#ref-factor"><span>the Reference chapter</span></a>.</p>
<p>The user now needs to get this information into their Google Authenticator (or <a class="reference external" href="https://www.authy.com/tutorials/how-use-authy-google-authenticator/">similar</a>) application. The easiest way to do that is to use their app to scan a QR code.</p>
<p>Stormpath makes this easy by giving you the QR Code in the <code class="docutils literal"><span class="pre">base64_q_r_image</span></code> field of the Google Authenticator Factor.</p>
<p>You can now take this string and turn it into a QR Code image:</p>
<ul class="simple">
<li>You could use a QR Code Library, such as <a class="reference external" href="https://davidshimjs.github.io/qrcodejs/">QRCode.js</a></li>
<li>Or you could generate the image yourself, using an <code class="docutils literal"><span class="pre">&lt;img&gt;</span></code> tag or CSS. For examples of both, see <a class="reference external" href="https://css-tricks.com/examples/DataURIs/">here</a>.</li>
</ul>
<p>Once the image is generated, the user will scan it into their Authenticator app. If you ask them for a code, they will go into the app and find the code for your application. For information about what happens with this code, see <a class="reference internal" href="#mfa-challenge-after-google"><span>below</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Many authenticator apps are compatible with Google Authenticator QR codes. Apps we like include <a class="reference external" href="https://www.authy.com/app/">Authy</a> and <a class="reference external" href="https://duo.com/product/trusted-users/two-factor-authentication/duo-mobile">Duo Mobile</a>.</p>
</div>
</div>
</div>
<div class="section" id="challenging-a-factor">
<span id="mfa-challenge"></span><h3>4.6.2. Challenging a Factor<a class="headerlink" href="#challenging-a-factor" title="Permalink to this headline">¶</a></h3>
<p>At this point in the example you have a brand new Account with two additional Factors.</p>
<p>If you were to send a GET to the Account&#8217;s <code class="docutils literal"><span class="pre">/factors</span></code> endpoint, you will see them:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/5IvkjoqcYNe3TYMYiX98vc/factors&quot;</span><span class="p">,</span>
  <span class="nt">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
  <span class="nt">&quot;size&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="nt">&quot;items&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/factors/29b9PiAaWqr9Hanexample&quot;</span><span class="p">,</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;SMS&quot;</span><span class="p">,</span>
      <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-09-22T21:34:00.881Z&quot;</span><span class="p">,</span>
      <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-09-22T21:34:00.881Z&quot;</span><span class="p">,</span>
      <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ENABLED&quot;</span><span class="p">,</span>
      <span class="nt">&quot;verificationStatus&quot;</span><span class="p">:</span> <span class="s2">&quot;UNVERIFIED&quot;</span><span class="p">,</span>
      <span class="nt">&quot;account&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/5IvkjoqcYNe3TYMExample&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;challenges&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/factors/29b9PiAaWqr9Hanexample/challenges&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;phone&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/phones/29b9PeqVcGYAelhExample&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;mostRecentChallenge&quot;</span><span class="p">:</span> <span class="kc">null</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/factors/46EZpOuefEEooFlexample&quot;</span><span class="p">,</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;google-authenticator&quot;</span><span class="p">,</span>
      <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-09-22T21:42:57.636Z&quot;</span><span class="p">,</span>
      <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-09-22T21:42:57.636Z&quot;</span><span class="p">,</span>
      <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ENABLED&quot;</span><span class="p">,</span>
      <span class="nt">&quot;accountName&quot;</span><span class="p">:</span> <span class="s2">&quot;jakub@stormpath.com&quot;</span><span class="p">,</span>
      <span class="nt">&quot;issuer&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nt">&quot;secret&quot;</span><span class="p">:</span> <span class="s2">&quot;OP7JZ[...]LAV&quot;</span><span class="p">,</span>
      <span class="nt">&quot;keyUri&quot;</span><span class="p">:</span> <span class="s2">&quot;otpauth://totp/jakub%40stormpath.com?secret=OP7JZ[...]LAV&quot;</span><span class="p">,</span>
      <span class="nt">&quot;base64QRImage&quot;</span><span class="p">:</span> <span class="s2">&quot;iVBOR[...]SuQmCC&quot;</span><span class="p">,</span>
      <span class="nt">&quot;verificationStatus&quot;</span><span class="p">:</span> <span class="s2">&quot;UNVERIFIED&quot;</span><span class="p">,</span>
      <span class="nt">&quot;account&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/5IvkjoqcYNe3TYMYExample&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;mostRecentChallenge&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nt">&quot;challenges&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/factors/46EZpOuefEEooFlexample/challenges&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can now challenge each of these factors.</p>
<div class="section" id="challenging-after-factor-creation">
<span id="mfa-challenge-after"></span><h4>Challenging After Factor Creation<a class="headerlink" href="#challenging-after-factor-creation" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This example covers challenging Factors that have already been created. To see an example of how to challenge a Factor at the same time as you are creating it, please see <a class="reference internal" href="#mfa-challenge-after"><span>below</span></a>.</p>
</div>
<div class="section" id="challenging-an-sms-factor">
<span id="mfa-challenge-after-sms"></span><h5>Challenging an SMS Factor<a class="headerlink" href="#challenging-an-sms-factor" title="Permalink to this headline">¶</a></h5>
<p>To challenge an SMS Factor, you send a request like this, with or without specifying a message.</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/factors/3WPF5Djir0Wg5FtPoJCPbo/challenges</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Cache-Control</span><span class="o">:</span> <span class="l">no-cache</span>

<span class="p">{</span>
  <span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="s2">&quot;For the sake of example, your code is ${code}.&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This operation will automatically cause the factor to be challenged, meaning that the user will receive a code as soon as this operation is executed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you do not specify a message, then Stormpath will just send the default message: <code class="docutils literal"><span class="pre">&quot;Your</span> <span class="pre">verification</span> <span class="pre">code</span> <span class="pre">is</span> <span class="pre">${code}&quot;</span></code>.</p>
</div>
<p>In response to this request you would get back a Challenge:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/challenges/70xfDsguePApNdnExample&quot;</span><span class="p">,</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-09-22T22:35:44.799Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-09-22T22:35:44.800Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;CREATED&quot;</span><span class="p">,</span>
  <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;For the sake of example, your code is ${code}.&quot;</span><span class="p">,</span>
  <span class="nt">&quot;account&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/5IvkjoqcYNe3TYMExample&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;factor&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/factors/3WPF5Djir0Wg5FtPoJCPbo&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For more information about this Challenge resource, see <a class="reference internal" href="reference.html#ref-challenge"><span>the Reference chapter</span></a>.</p>
<p>The resulting SMS would look like this:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/challenge_message.png"><img alt="SMS Challenge Message" src="_images/challenge_message.png" /></a>
</div>
<p>This code will remain valid for 300 seconds (5 minutes).</p>
<p>Next, you must collect this code from the user.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The code has to be sent to the correct Challenge <code class="docutils literal"><span class="pre">href</span></code>. If your application is stateless, you could include the Challenge <code class="docutils literal"><span class="pre">href</span></code> in a hidden field on your form. If your application has a session, then you will want to attach the Challenge <code class="docutils literal"><span class="pre">href</span></code> to that session.</p>
</div>
<p>Once you have the code, you submit it to the same Challenge you created above:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/challenges/70xfDsguePApNdnExample</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
  <span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="s2">&quot;633559&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>And then you would get back the response:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-09-22T22:35:44.799Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-09-22T22:39:06.822Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/challenges/70xfDsguePApNdnExample&quot;</span><span class="p">,</span>
  <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;For the sake of example, your code is ${code}.&quot;</span><span class="p">,</span>
  <span class="nt">&quot;factor&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/factors/3WPF5Djir0Wg5FtPoJCPbo&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;account&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/5IvkjoqcYNe3TYMYiX98vc&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;SUCCESS&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you had sent the wrong code, the <code class="docutils literal"><span class="pre">status</span></code> would instead be <code class="docutils literal"><span class="pre">FAILED</span></code>.</p>
<p>For a full list of Challenge statuses, please see <a class="reference internal" href="reference.html#challenge-status-values"><span>the Reference chapter</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You could also pass the Challenge <code class="docutils literal"><span class="pre">href</span></code> and the <code class="docutils literal"><span class="pre">code</span></code> to Stormpath and get back an OAuth 2.0 Access Token. For more information about this see <a class="reference internal" href="#generate-oauth-token"><span>Generating an OAuth 2.0 Access Token</span></a>.</p>
</div>
</div>
<div class="section" id="challenging-a-google-authenticator-factor">
<span id="mfa-challenge-after-google"></span><h5>Challenging a Google Authenticator Factor<a class="headerlink" href="#challenging-a-google-authenticator-factor" title="Permalink to this headline">¶</a></h5>
<p>When you created the Google Authenticator Factor, you also generated a QR Code image for your user to scan into their app. Challenging this factor now only requires you to prompt the user to enter in the code from their Authenticator app.</p>
<p>Unlike the SMS challenge process, the Google Authenticator challenge process does not require you to create a Challenge resource. Instead, the Challenge is created and verified in one step. For more information about the Challenge resource, see <a class="reference internal" href="reference.html#ref-challenge"><span>the Reference chapter</span></a>.</p>
<p>Once you have collected the code from the user, submit it:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/factors/4KOeu7ypRQI8Bpk2org7tk/challenges</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
  <span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="s2">&quot;786393&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If the code is correct, Stormpath will now simultaneously create the Challenge resource and set its status to <code class="docutils literal"><span class="pre">SUCCESS</span></code>, then return it back to you.</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/challenges/EGDIpcgffklwo6HywNzTw&quot;</span><span class="p">,</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-09-22T22:50:59.241Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-09-22T22:50:59.241Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span>
  <span class="nt">&quot;account&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/5IvkjoqcYNe3TYMYExample&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;factor&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/factors/4KOeu7ypRQI8Bpk2org7tk&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="challenging-during-factor-creation">
<span id="mfa-challenge-during"></span><h4>Challenging During Factor Creation<a class="headerlink" href="#challenging-during-factor-creation" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For this example, we will use an SMS challenge. Challenging a Google Authenticator Factor during creation is not feasible because the user has to add the factor to their application before they can get a code.</p>
</div>
<p>To send a challenge at the same time as you create the SMS Factor, you need to POST to the Account&#8217;s <code class="docutils literal"><span class="pre">/factors</span></code> endpoint with the additional <code class="docutils literal"><span class="pre">?challenge=true</span></code> parameter included. Then you must also add the <code class="docutils literal"><span class="pre">challenge</span></code> into the body of the JSON.</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/accounts/5IvkjoqcYNe3TYMExample/factors?challenge=true</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
  <span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;sms&quot;</span><span class="p">,</span>
  <span class="nt">&quot;phone&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;number&quot;</span><span class="p">:</span> <span class="s2">&quot;2675555555&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;challenge&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Welcome to the Example! Your authorization code is ${code}&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You are telling Stormpath to send an SMS to the phone number <code class="docutils literal"><span class="pre">267-555-5555</span></code> along with the message <code class="docutils literal"><span class="pre">&quot;Welcome</span> <span class="pre">to</span> <span class="pre">the</span> <span class="pre">Example!</span> <span class="pre">Your</span> <span class="pre">authorization</span> <span class="pre">code</span> <span class="pre">is</span> <span class="pre">${code}&quot;</span></code>. The placeholder <code class="docutils literal"><span class="pre">${code}</span></code> will be replaced with a one-time password generated using the HOTP algorithm.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you wanted Stormpath to send the default message, then you could just not include the <code class="docutils literal"><span class="pre">challenge</span></code> object or its <code class="docutils literal"><span class="pre">message</span></code> at all.</p>
</div>
</div>
<div class="section" id="challenging-a-factor-after-login">
<h4>Challenging a Factor After Login<a class="headerlink" href="#challenging-a-factor-after-login" title="Permalink to this headline">¶</a></h4>
<p>The first step is to authenticate the user.</p>
<p>In the case of REST, this means a <code class="docutils literal"><span class="pre">POST</span></code> to your Application resource&#8217;s <code class="docutils literal"><span class="pre">/loginAttempts</span></code> endpoint. In this case it will be very helpful to also include <code class="docutils literal"><span class="pre">expand=account</span></code>.</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/applications/1gk4Dxzi6o4PbdleXaMPLE/loginAttempts?expand=account</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>

{
  &quot;type&quot;: &quot;basic&quot;,
  &quot;value&quot;: &quot;amFrdWIrbWZhdGVzdExamplebXBhdGguY29tOkNoYW5nZW1lMQ==&quot;
}
</pre></div>
</div>
<p>If authentication is successful, you will get back the Account:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/5IvkjoqcYNe3TYMExample&quot;</span><span class="p">,</span>
  <span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;factorman&quot;</span><span class="p">,</span>
  <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;jakub+factorman@stormpath.com&quot;</span><span class="p">,</span>
  <span class="nt">&quot;givenName&quot;</span><span class="p">:</span> <span class="s2">&quot;Joe&quot;</span><span class="p">,</span>
  <span class="nt">&quot;middleName&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Factorman&quot;</span><span class="p">,</span>
  <span class="nt">&quot;fullName&quot;</span><span class="p">:</span> <span class="s2">&quot;Joe Factorman&quot;</span><span class="p">,</span>
  <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ENABLED&quot;</span><span class="p">,</span>
  <span class="nt">&quot;...&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;factors&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/5IvkjoqcYNe3TYMExample/factors&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Next, you will need to retrieve the Account&#8217;s <code class="docutils literal"><span class="pre">factors</span></code> collection:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/v1/accounts/5IvkjoqcYNe3TYMExample/factors</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Basic MlpG...</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
</pre></div>
</div>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/5IvkjoqcYNe3TYMYiX98vc/factors&quot;</span><span class="p">,</span>
  <span class="nt">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
  <span class="nt">&quot;size&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&quot;items&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/factors/3WPF5Djir0Wg5FtPoJCPbo&quot;</span><span class="p">,</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;SMS&quot;</span><span class="p">,</span>
      <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-09-22T22:11:03.768Z&quot;</span><span class="p">,</span>
      <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-09-22T22:42:39.822Z&quot;</span><span class="p">,</span>
      <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ENABLED&quot;</span><span class="p">,</span>
      <span class="nt">&quot;verificationStatus&quot;</span><span class="p">:</span> <span class="s2">&quot;VERIFIED&quot;</span><span class="p">,</span>
      <span class="nt">&quot;account&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/5IvkjoqcYNe3TYMYiX98vc&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;challenges&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/factors/3WPF5Djir0Wg5FtPoJCPbo/challenges&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;phone&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/phones/3WManCalQOcizNsHjeeiHk&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;mostRecentChallenge&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/challenges/6kgEJR5Cr3pNh131i7b6wm&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You would then send a POST to the <code class="docutils literal"><span class="pre">challenges</span></code> collection which would generate a new Challenge and send an SMS message to the number specified in the Factor&#8217;s Phone resource.</p>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="auth_z.html" class="btn btn-neutral float-right" title="5. Authorization With Stormpath" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="accnt_mgmt.html" class="btn btn-neutral" title="3. Account Management" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Stormpath, Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/javascript_for_java.js"></script>
      <script type="text/javascript" src="_static/langpicker.js"></script>
      <script type="text/javascript" src="_static/scrollspy.js"></script>
      <script type="text/javascript" src="_static/gumshoe.min.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

  

</body>
</html>