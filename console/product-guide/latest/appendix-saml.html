

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Appendix: SAML &mdash; Stormpath Admin Console Guide  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Stormpath Admin Console Guide  documentation" href="index.html"/>
        <link rel="prev" title="ID Site" href="idsite.html"/>
<!-- Facebook Pixel Code -->
<script>
  !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
  n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
  document,'script','https://connect.facebook.net/en_US/fbevents.js');

  fbq('init', '986262161469311');
  fbq('track', "PageView");
</script>
<noscript>
  <img height="1" width="1" style="display:none"
  src="https://www.facebook.com/tr?id=986262161469311&ev=PageView&noscript=1"
  />
</noscript>
<!-- End Facebook Pixel Code -->



  
  <script src="_static/js/modernizr.min.js"></script>

  
  <script src="https://cdn.optimizely.com/js/225847041.js"></script>

  
  <script>
  !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
  n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
  document,'script','https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '986262161469311');
  fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none"
  src="https://www.facebook.com/tr?id=986262161469311&ev=PageView&noscript=1"
  /></noscript>
</head>

<body class="wy-body-for-nav" role="document">

  
  <noscript><iframe src=".//www.googletagmanager.com/ns.html?id=GTM-NQZZFW"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NQZZFW');</script>

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Stormpath Admin Console Guide
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#create-an-application">Create An Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#create-an-account">Create an Account</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#add-a-group">Add a Group</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#add-an-account-to-the-group">Add an Account to the Group</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#add-some-custom-data-to-the-group">Add Some Custom Data to the Group</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="home.html">The Home Page</a><ul>
<li class="toctree-l2"><a class="reference internal" href="home.html#logging-in-to-the-admin-console">Logging in to the Admin Console</a><ul>
<li class="toctree-l3"><a class="reference internal" href="home.html#session-timeout">Session Timeout</a></li>
<li class="toctree-l3"><a class="reference internal" href="home.html#logging-out">Logging Out</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="home.html#navigation-pane">Navigation Pane</a><ul>
<li class="toctree-l3"><a class="reference internal" href="home.html#support">Support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="home.html#home-about">The Home Page</a><ul>
<li class="toctree-l3"><a class="reference internal" href="home.html#quickstarts">Quickstarts</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="administration.html">Administering Stormpath</a><ul>
<li class="toctree-l2"><a class="reference internal" href="administration.html#subscription-levels">Subscription Levels</a><ul>
<li class="toctree-l3"><a class="reference internal" href="administration.html#changing-your-subscription-tier">Changing Your Subscription Tier</a></li>
<li class="toctree-l3"><a class="reference internal" href="administration.html#increasing-your-applications">Increasing Your Applications</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="administration.html#billing">Billing</a></li>
<li class="toctree-l2"><a class="reference internal" href="administration.html#my-api-keys">My API Keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="administration.html#managing-tenant-administrators">Managing Tenant Administrators</a><ul>
<li class="toctree-l3"><a class="reference internal" href="administration.html#adding-administrators">Adding Administrators</a></li>
<li class="toctree-l3"><a class="reference internal" href="administration.html#changing-tenant-ownership">Changing Tenant Ownership</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="applications.html">Applications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="applications.html#finding-an-application-s-url">Finding an Application&#8217;s URL</a></li>
<li class="toctree-l2"><a class="reference internal" href="applications.html#creating-applications">Creating Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="applications.html#editing-applications">Editing Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="applications.html#adding-custom-data-to-an-application">Adding Custom Data to an Application</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="applications.html#enabling-disabling-applications">Enabling &amp; Disabling Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="applications.html#bulk-status-changes">Bulk Status Changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="applications.html#deleting-applications">Deleting Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="applications.html#bulk-application-deletion">Bulk Application Deletion</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="applications.html#finding-related-resources">Finding Related Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="applications.html#other-tasks">Other Tasks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="applications.html#managing-an-application-s-accounts">Managing an Application&#8217;s Accounts</a></li>
<li class="toctree-l3"><a class="reference internal" href="applications.html#managing-an-application-s-account-stores">Managing an Application&#8217;s Account Stores</a><ul>
<li class="toctree-l4"><a class="reference internal" href="applications.html#sorting-account-stores">Sorting Account Stores</a></li>
<li class="toctree-l4"><a class="reference internal" href="applications.html#setting-default-account-and-groups-locations">Setting Default Account and Groups Locations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="applications.html#managing-an-application-s-groups">Managing an Application&#8217;s Groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="applications.html#managing-an-application-s-account-linking-policy">Managing an Application&#8217;s Account Linking Policy</a></li>
<li class="toctree-l3"><a class="reference internal" href="applications.html#managing-an-application-s-oauth-policy">Managing an Application&#8217;s OAuth Policy</a></li>
<li class="toctree-l3"><a class="reference internal" href="applications.html#managing-an-application-s-saml-policy">Managing an Application&#8217;s SAML Policy</a></li>
<li class="toctree-l3"><a class="reference internal" href="applications.html#managing-an-application-s-client-api-configuration">Managing an Application&#8217;s Client API Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="applications.html#client-api">Client API</a></li>
<li class="toctree-l4"><a class="reference internal" href="applications.html#endpoints">Endpoints</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="organizations.html">Organizations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="organizations.html#find-an-organization-s-url">Find an Organization&#8217;s URL</a></li>
<li class="toctree-l2"><a class="reference internal" href="organizations.html#create-organizations">Create Organizations</a></li>
<li class="toctree-l2"><a class="reference internal" href="organizations.html#edit-organizations">Edit Organizations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="organizations.html#add-custom-data-to-an-organization">Add Custom Data to an Organization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="organizations.html#enable-disable-organizations">Enable &amp; Disable Organizations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="organizations.html#bulk-status-changes">Bulk Status Changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="organizations.html#delete-organizations">Delete Organizations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="organizations.html#bulk-organization-deletion">Bulk Organization Deletion</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="organizations.html#manage-an-organization-s-account-stores">Manage an Organization&#8217;s Account Stores</a><ul>
<li class="toctree-l3"><a class="reference internal" href="organizations.html#sort-account-stores">Sort Account Stores</a></li>
<li class="toctree-l3"><a class="reference internal" href="organizations.html#set-default-account-and-groups-locations">Set Default Account and Groups Locations</a></li>
<li class="toctree-l3"><a class="reference internal" href="organizations.html#managing-an-organization-s-account-linking-policy">Managing an Organization&#8217;s Account Linking Policy</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="directories.html">Directories</a><ul>
<li class="toctree-l2"><a class="reference internal" href="directories.html#find-a-directory-s-url">Find a Directory&#8217;s URL</a></li>
<li class="toctree-l2"><a class="reference internal" href="directories.html#create-a-directory">Create a Directory</a><ul>
<li class="toctree-l3"><a class="reference internal" href="directories.html#create-a-cloud-directory">Create a Cloud Directory</a></li>
<li class="toctree-l3"><a class="reference internal" href="directories.html#create-a-social-directory">Create a Social Directory</a><ul>
<li class="toctree-l4"><a class="reference internal" href="directories.html#google">Google</a></li>
<li class="toctree-l4"><a class="reference internal" href="directories.html#facebook">Facebook</a></li>
<li class="toctree-l4"><a class="reference internal" href="directories.html#github">GitHub</a></li>
<li class="toctree-l4"><a class="reference internal" href="directories.html#linkedin">LinkedIn</a></li>
<li class="toctree-l4"><a class="reference internal" href="directories.html#twitter">Twitter</a></li>
<li class="toctree-l4"><a class="reference internal" href="directories.html#generic-oauth">Generic OAuth</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="directories.html#create-an-ad-ldap-directory">Create an AD/LDAP Directory</a></li>
<li class="toctree-l3"><a class="reference internal" href="directories.html#creating-your-agent">Creating your Agent</a><ul>
<li class="toctree-l4"><a class="reference internal" href="directories.html#directory">1. Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="directories.html#connection">2. Connection</a></li>
<li class="toctree-l4"><a class="reference internal" href="directories.html#accounts">3. Accounts</a></li>
<li class="toctree-l4"><a class="reference internal" href="directories.html#groups">4. Groups</a></li>
<li class="toctree-l4"><a class="reference internal" href="directories.html#review">5. Review</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="directories.html#installing-your-ldap-agent">Installing Your LDAP Agent</a></li>
<li class="toctree-l3"><a class="reference internal" href="directories.html#viewing-the-agent-s-status">Viewing the Agent&#8217;s Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="directories.html#create-a-saml-directory">Create a SAML Directory</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="directories.html#edit-a-directory">Edit a Directory</a><ul>
<li class="toctree-l3"><a class="reference internal" href="directories.html#add-custom-data-to-a-directory">Add Custom Data to a Directory</a></li>
<li class="toctree-l3"><a class="reference internal" href="directories.html#modify-your-directory-s-password-policy">Modify Your Directory&#8217;s Password Policy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="directories.html#enable-disable-directories">Enable &amp; Disable Directories</a><ul>
<li class="toctree-l3"><a class="reference internal" href="directories.html#bulk-status-changes">Bulk Status Changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="directories.html#delete-directories">Delete Directories</a><ul>
<li class="toctree-l3"><a class="reference internal" href="directories.html#bulk-directory-deletion">Bulk Directory Deletion</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="directories.html#other-tasks">Other Tasks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="directories.html#manage-an-directory-s-groups">Manage an Directory&#8217;s Groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="directories.html#manage-an-directory-s-accounts">Manage an Directory&#8217;s Accounts</a></li>
<li class="toctree-l3"><a class="reference internal" href="directories.html#set-up-workflows">Set-up Workflows</a><ul>
<li class="toctree-l4"><a class="reference internal" href="directories.html#account-registration-verification">Account Registration &amp; Verification</a></li>
<li class="toctree-l4"><a class="reference internal" href="directories.html#password-reset">Password Reset</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="groups.html">Groups</a><ul>
<li class="toctree-l2"><a class="reference internal" href="groups.html#find-a-group-s-url">Find a Group&#8217;s URL</a></li>
<li class="toctree-l2"><a class="reference internal" href="groups.html#create-groups">Create Groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="groups.html#edit-groups">Edit Groups</a><ul>
<li class="toctree-l3"><a class="reference internal" href="groups.html#adding-custom-data-to-a-group">Adding Custom Data to a Group</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="groups.html#enable-disable-groups">Enable &amp; Disable Groups</a><ul>
<li class="toctree-l3"><a class="reference internal" href="groups.html#bulk-status-changes">Bulk Status Changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="groups.html#delete-groups">Delete Groups</a><ul>
<li class="toctree-l3"><a class="reference internal" href="groups.html#bulk-group-deletion">Bulk Group Deletion</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="groups.html#find-related-resources">Find Related Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="groups.html#other-tasks">Other Tasks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="groups.html#manage-a-group-s-accounts">Manage a Group&#8217;s Accounts</a></li>
<li class="toctree-l3"><a class="reference internal" href="groups.html#manage-an-group-s-applications">Manage an Group&#8217;s Applications</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="accounts.html">Accounts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="accounts.html#find-an-account-s-url">Find an Account&#8217;s URL</a></li>
<li class="toctree-l2"><a class="reference internal" href="accounts.html#create-accounts">Create Accounts</a></li>
<li class="toctree-l2"><a class="reference internal" href="accounts.html#edit-accounts">Edit Accounts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="accounts.html#add-custom-data-to-an-account">Add Custom Data to an Account</a></li>
<li class="toctree-l3"><a class="reference internal" href="accounts.html#change-or-reset-an-account-s-password">Change or Reset an Account&#8217;s Password</a></li>
<li class="toctree-l3"><a class="reference internal" href="accounts.html#manage-account-api-keys">Manage Account API Keys</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="accounts.html#enable-disable-accounts">Enable &amp; Disable Accounts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="accounts.html#bulk-status-changes">Bulk Status Changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="accounts.html#delete-accounts">Delete Accounts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="accounts.html#bulk-account-deletion">Bulk Account Deletion</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="accounts.html#find-related-resources">Find Related Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="accounts.html#other-tasks">Other Tasks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="accounts.html#managing-an-account-s-groups">Managing an Account&#8217;s Groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="accounts.html#managing-an-account-s-oauth-tokens">Managing an Account&#8217;s OAuth Tokens</a></li>
<li class="toctree-l3"><a class="reference internal" href="accounts.html#managing-an-account-s-linked-accounts">Managing an Account&#8217;s Linked Accounts</a></li>
<li class="toctree-l3"><a class="reference internal" href="accounts.html#managing-an-account-s-factors">Managing an Account&#8217;s Factors</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="idsite.html">ID Site</a><ul>
<li class="toctree-l2"><a class="reference internal" href="idsite.html#id-site-set-up">ID Site Set Up</a><ul>
<li class="toctree-l3"><a class="reference internal" href="idsite.html#setting-your-own-custom-domain-name-and-ssl-certificate">Setting Your Own Custom Domain Name and SSL Certificate</a><ul>
<li class="toctree-l4"><a class="reference internal" href="idsite.html#get-a-domain-name-and-a-subdomain">1. Get a Domain Name and a Subdomain</a></li>
<li class="toctree-l4"><a class="reference internal" href="idsite.html#make-the-subdomain-an-alias-of-your-id-site-on-stormpath">2. Make the Subdomain an Alias of your ID Site on Stormpath</a></li>
<li class="toctree-l4"><a class="reference internal" href="idsite.html#enable-the-custom-domain-in-stormpath-s-id-site-configuration">3. Enable the Custom Domain in Stormpath&#8217;s ID Site Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="idsite.html#set-up-ssl-on-your-id-site">4. Set up SSL on your ID Site</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="idsite.html#setting-up-your-application-to-use-id-site">Setting up your Application to use ID Site</a></li>
<li class="toctree-l2"><a class="reference internal" href="idsite.html#hosting-id-site-yourself">Hosting ID Site Yourself</a><ul>
<li class="toctree-l3"><a class="reference internal" href="idsite.html#step-1-build-id-site">Step 1: Build ID Site</a></li>
<li class="toctree-l3"><a class="reference internal" href="idsite.html#step-2-host-id-site-on-s3">Step 2: Host ID Site on S3</a></li>
<li class="toctree-l3"><a class="reference internal" href="idsite.html#step-3-set-up-cloudfront">Step 3: Set up Cloudfront</a></li>
<li class="toctree-l3"><a class="reference internal" href="idsite.html#step-4-setup-dns-to-point-to-cloudfront">Step 4: Setup DNS to point to Cloudfront</a></li>
<li class="toctree-l3"><a class="reference internal" href="idsite.html#step-5-install-ssl-cert-with-let-s-encrypt">Step 5: Install SSL Cert with Let&#8217;s Encrypt</a></li>
<li class="toctree-l3"><a class="reference internal" href="idsite.html#step-6-configure-stormpath-to-use-your-id-site">Step 6: Configure Stormpath to use your ID Site</a></li>
<li class="toctree-l3"><a class="reference internal" href="idsite.html#step-7-make-a-test-change">Step 7: Make a test change</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Appendix: SAML</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#test-it-out">Test it out!</a></li>
<li class="toctree-l2"><a class="reference internal" href="#salesforce">Salesforce</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-set-up-salesforce">Step 1: Set-up Salesforce</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#set-up-salesforce">1.1. Set-up Salesforce</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-up-single-sign-on">1.2. Set-up Single Sign On</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-a-connected-app">1.3. Create a Connected App</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-your-sso-urls">1.4. Get your SSO URLs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-create-your-saml-directory-in-stormpath">Step 2: Create Your SAML Directory in Stormpath</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#create-your-saml-directory">2.1. Create Your SAML Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gather-your-saml-directory-information">2.2. Gather Your SAML Directory Information</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-configure-your-service-provider-in-salesforce">Step 3: Configure Your Service Provider in Salesforce</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-4-configure-your-application-in-stormpath">Step 4: Configure Your Application in Stormpath</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-5-optional-configure-your-attribute-mappings">Step 5: (Optional) Configure Your Attribute Mappings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#find-the-existing-saml-attributes">5.1. Find the Existing SAML Attributes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-any-additional-attributes-you-want">5.2. Add Any Additional Attributes You Want</a></li>
<li class="toctree-l4"><a class="reference internal" href="#specify-your-mapping">5.3. Specify Your Mapping</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#onelogin">OneLogin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-set-up-onelogin">Step 1: Set-up OneLogin</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-gather-your-onelogin-information">Step 2: Gather Your OneLogin Information</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#idp-signing-certificate">2.1 IdP Signing Certificate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-sso-login-logout-urls">2.2. The SSO Login / Logout URLs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-create-your-saml-directory-in-stormpath">Step 3: Create Your SAML Directory in Stormpath</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">3.1. Create Your SAML Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">3.2. Gather Your SAML Directory Information</a></li>
<li class="toctree-l4"><a class="reference internal" href="#idp-initiated-flow-only-generate-a-relaystate">3.3. (IdP-initiated Flow Only) Generate a RelayState</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#step-4-configure-your-service-provider-in-onelogin">Step 4: Configure Your Service Provider in OneLogin</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-5-configure-your-application-in-stormpath">Step 5: Configure Your Application in Stormpath</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-6-optional-configure-your-attribute-mappings">Step 6: (Optional) Configure Your Attribute Mappings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id4">6.1. Find the Existing SAML Attributes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">6.2. Add Any Additional Attributes You Want</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">6.3. Specify Your Mapping</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#okta">Okta</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-set-up-okta">Step 1: Set-up Okta</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-gather-information-from-okta">Step 2: Gather Information From Okta</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">Step 3: Create Your SAML Directory in Stormpath</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id9">3.1. Create Your SAML Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id10">3.2. Gather Your SAML Directory Information</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id11">3.3. (IdP-initiated Flow Only) Generate a RelayState</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#step-4-configure-your-service-provider-in-okta">Step 4: Configure Your Service Provider in Okta</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">Step 5: Configure Your Application in Stormpath</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13">Step 6: (Optional) Configure Your Attribute Mappings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id14">6.1. Find the Existing SAML Attributes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id15">6.2. Add Any Additional Attributes You Want</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id16">6.3. Specify Your Mapping</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ping">Ping</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-set-up-ping">Step 1: Set-up Ping</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-gather-your-ping-information">Step 2: Gather Your Ping Information</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id18">2.1 IdP Signing Certificate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id19">2.2. The SSO Login / Logout URLs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id20">Step 3: Create Your SAML Directory in Stormpath</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id21">2.1. Create Your SAML Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id22">2.2. Gather Your SAML Directory Information</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-configure-your-service-provider-in-ping">Step 3: Configure Your Service Provider in Ping</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id23">Step 4: Configure Your Application in Stormpath</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id24">Step 5: (Optional) Configure Your Attribute Mappings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id25">4.1. Find the Existing SAML Attributes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id26">4.2. Add Any Additional Attributes You Want</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id27">4.3. Specify Your Mapping</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#g-suite">G-Suite</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-set-up-g-suite">Step 1: Set-up G-Suite</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-gather-the-google-idp-information">Step 2: Gather the Google IdP Information</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id29">Step 3: Create Your SAML Directory in Stormpath</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id30">3.1. Create Your SAML Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id31">3.2. Gather Your SAML Directory Information</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#step-4-configure-your-service-provider-in-g-suite">Step 4: Configure Your Service Provider in G-Suite</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id32">Step 5: Configure Your Application in Stormpath</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id33">Step 6: (Optional) Configure Your Attribute Mappings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id34">6.1. Find the Existing SAML Attributes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id35">6.2. Add Any Additional Attributes You Want</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id36">6.3. Specify Your Mapping</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#step-7-idp-initiated-flow-only-generate-a-relaystate">Step 7: (IdP-initiated Flow Only) Generate a RelayState</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#active-directory-federation-services">Active Directory Federation Services</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-download-your-signing-certificate">Step 1: Download Your Signing Certificate</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-create-your-adfs-directory-in-stormpath">Step 2: Create your ADFS Directory in Stormpath</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-configure-your-relying-party-trust-in-adfs">Step 3: Configure Your Relying Party Trust in ADFS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#add-a-relying-party-trust">3.1. Add a Relying Party Trust</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-a-claim-rule">3.2. Add a Claim Rule</a></li>
<li class="toctree-l4"><a class="reference internal" href="#finish-configuring-the-relying-third-party">3.4. Finish Configuring the Relying Third Party</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id37">Step 4: Configure Your Application in Stormpath</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id38">Step 5: (Optional) Configure Your Attribute Mappings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#add-the-claim-rule">5.1. Add the Claim Rule</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-the-attribute-mapping">5.2. Create the Attribute Mapping</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-6-idp-initiated-flow-only-generate-a-relaystate">Step 6: (IdP-initiated Flow Only) Generate a RelayState</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#azure-active-directory">Azure Active Directory</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-add-your-application-in-azure">Step 1: Add Your Application in Azure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-create-your-azure-directory-in-stormpath">Step 2: Create your Azure Directory in Stormpath</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#add-the-sso-login-logout-urls">2.1 Add the SSO Login/Logout URLs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-the-x509-certificate">2.2 Add the x509 Certificate</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-configure-sso-in-azure">Step 3: Configure SSO in Azure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id39">Step 4: Configure Your Application in Stormpath</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Stormpath Admin Console Guide</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 







<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Appendix: SAML</li>
    <li class="wy-breadcrumbs-aside">
      
          
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="appendix-saml">
<span id="directories-saml-sp"></span><h1>Appendix: SAML<a class="headerlink" href="#appendix-saml" title="Permalink to this headline">¶</a></h1>
<p>This section will show you how to set-up Stormpath to allow your users to log in with a SAML-enabled Identity Provider via either the Service Provider (SP) or Identity Provider (IdP) Initiated flows. Examples of Identity Providers that you can integrate with include Salesforce and OneLogin.</p>
<p><strong>What are the Service Provider and Identity Provider Initiated flows?</strong></p>
<p>In the Service Provider (SP)-initiated flow, the user starts at your application. From a login page (either ID Site or one inside your Stormpath-powered application), the user is redirected to the Identity Provider. After authenticating with the Identity Provider, the user is returned to the application in an authenticate state.</p>
<p>In the Identity Provider (IdP)-initiated flow, the user starts at the Identity Provider. After logging-in to the IdP, the user selects the Stormpath-enabled web application from within the IdP’s site, and is redirected to the application in an authenticated state.</p>
<p>For more, see the <a class="reference external" href="https://docs.stormpath.com/rest/product-guide/latest/auth_n.html#the-stormpath-saml-flow">Product Guide</a>. Feel free to toggle to the language of your choice by clicking on &#8220;Switch Language&#8221; in the upper left-hand corner of the page.</p>
<p><strong>Configuring Service Provider vs Identity Provider Initiated</strong></p>
<p>The only difference in configuration steps between the two kinds of flows is that the Identity Provider-initiated flow requires you to generate a Default Relay State. For more information, see the configuration steps for your particular Identity Provider below.</p>
<p><strong>Requirements</strong></p>
<p>These instructions assume that you have two things:</p>
<ul>
<li><p class="first">A Stormpath account with <a class="reference external" href="https://stormpath.com/pricing">a plan that supports SAML</a></p>
</li>
<li><p class="first">A developer Account with one of the following Identity Providers who support SAML:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#create-salesforce"><span class="std std-ref">Salesforce</span></a></li>
<li><a class="reference internal" href="#create-onelogin"><span class="std std-ref">OneLogin</span></a></li>
<li><a class="reference internal" href="#create-okta"><span class="std std-ref">Okta</span></a></li>
<li><a class="reference internal" href="#create-ping"><span class="std std-ref">Ping Identity</span></a></li>
<li><a class="reference internal" href="#create-gsuite"><span class="std std-ref">G-Suite</span></a></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>We also provide authentication against an <strong>Active Directory</strong> via <a class="reference internal" href="#create-adfs"><span class="std std-ref">ADFS SAML</span></a> and <a class="reference internal" href="#create-azure"><span class="std std-ref">Azure AD</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>These are not the only SAML-enabled Identity Providers that Stormpath can integrate with, but they are the ones that have been tested and verified as working.</p>
<p>Currently, IdP-initiated SAML configuration instructions are only available for:</p>
<ul class="last simple">
<li>OneLogin</li>
<li>Okta</li>
<li>Ping Identity</li>
<li>G-Suite</li>
<li>Active Directory via ADFS</li>
</ul>
</div>
<div class="section" id="test-it-out">
<h2>Test it out!<a class="headerlink" href="#test-it-out" title="Permalink to this headline">¶</a></h2>
<p>Once you finish the below steps to get either SP-initiated or IdP-initiated SAML working with your Identity Provider, you can test out both workflows.</p>
<p>To test out the SP-initiated flow, click on your newly created Stormpath SAML Directory and navigate to the &#8220;Configuration Test&#8221; tab. Select the Stormpath Application that you mapped your SAML Directory to, and select the API key that you used to start your Application. Next, click on &#8220;Start Test&#8221; and follow the prompt.</p>
<p>If you run into any errors, click on the question mark by the step you&#8217;re having trouble with. This will redirect you to the documentation that explains the process and provides helpful debugging hints.</p>
<p>To test out the IdP-initiated flow, navigate to your Identity Provider and log in. Next, launch your SAML Application. If everything has been set up correctly, you will be immediately redirected to the callback URI you configured with a secure JWT passed as a URL parameter. This callback URI will validate the JWT, exchange it for an access and refresh token, and redirect you to the nextUri that you configured.</p>
</div>
<div class="section" id="salesforce">
<span id="create-salesforce"></span><h2>Salesforce<a class="headerlink" href="#salesforce" title="Permalink to this headline">¶</a></h2>
<p>Stormpath&#8217;s Salesforce integration is only compatible with the Service Provider-initiated flow.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#step-1-set-up-salesforce" id="id40">Step 1: Set-up Salesforce</a></li>
<li><a class="reference internal" href="#step-2-create-your-saml-directory-in-stormpath" id="id41">Step 2: Create Your SAML Directory in Stormpath</a></li>
<li><a class="reference internal" href="#step-3-configure-your-service-provider-in-salesforce" id="id42">Step 3: Configure Your Service Provider in Salesforce</a></li>
<li><a class="reference internal" href="#step-4-configure-your-application-in-stormpath" id="id43">Step 4: Configure Your Application in Stormpath</a></li>
<li><a class="reference internal" href="#step-5-optional-configure-your-attribute-mappings" id="id44">Step 5: (Optional) Configure Your Attribute Mappings</a></li>
</ul>
</div>
<div class="section" id="step-1-set-up-salesforce">
<h3><a class="toc-backref" href="#id40">Step 1: Set-up Salesforce</a><a class="headerlink" href="#step-1-set-up-salesforce" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Before you start, make sure that you have set-up a Salesforce subdomain for your organization. You can do this under <strong>Administer</strong> &gt; <strong>Domain Management</strong> &gt; <strong>My Domain</strong>.</p>
</div>
<div class="section" id="set-up-salesforce">
<h4>1.1. Set-up Salesforce<a class="headerlink" href="#set-up-salesforce" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Under <strong>Administer</strong>, click on <strong>Security Controls</strong> &gt; <strong>Identity Provider</strong></li>
<li>Click on <strong>Enable Identity Provider</strong>.</li>
<li>You should now be on the &#8220;Identity Provider Setup&#8221; page, with a single security certificate in the drop down menu. Click on <strong>Save</strong>.</li>
<li>You will now be back on the &#8220;Identity Provider&#8221; page. Click <strong>Download Certificate</strong>, which will download a .crt file with a name starting with <code class="docutils literal"><span class="pre">SelfSignedCert</span></code>.</li>
<li>Open this file in your text editor of choice. The contents will be an x509 certificate starting with the line <code class="docutils literal"><span class="pre">-----BEGIN</span> <span class="pre">CERTIFICATE-----</span></code> and ending with <code class="docutils literal"><span class="pre">-----END</span> <span class="pre">CERTIFICATE-----</span></code>. The contents of this file are your &#8220;SAML X.509 Signing Cert&#8221;.</li>
<li>Also click on <strong>Download Metadata</strong>, which will download an XML file which you will use in step 2.</li>
</ol>
</div>
<div class="section" id="set-up-single-sign-on">
<h4>1.2. Set-up Single Sign On<a class="headerlink" href="#set-up-single-sign-on" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>From <strong>Administer</strong>, click on <strong>Security Controls</strong> then <strong>Single Sign-On Settings</strong>.</li>
<li>Click <strong>Edit</strong>, and on the next page check &#8220;SAML Enabled&#8221; and then click <strong>Save</strong>.</li>
<li>Under &#8220;SAML Single Sign-On Settings&#8221; click on <strong>New from Metadata File</strong>.</li>
<li>Select the metadata XML file that you downloaded in step 1.1 above, then click <strong>Create</strong>.</li>
</ol>
</div>
<div class="section" id="create-a-connected-app">
<h4>1.3. Create a Connected App<a class="headerlink" href="#create-a-connected-app" title="Permalink to this headline">¶</a></h4>
<p>Every Salesforce app will need its own Stormpath Directory. The users for that Salesforce app will only be able to log in if that application&#8217;s information is properly entered into a corresponding Stormpath Directory.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you already have a Salesforce application with SAML enabled, you can skip to Step 4 here.</p>
</div>
<ol class="arabic simple">
<li>In the navigation pane on the left, under <strong>Build</strong>, find the <strong>Create</strong> section, then click on <strong>Apps</strong>.</li>
<li>From the &#8220;Apps&#8221; page, find the &#8220;Connected Apps&#8221; section and click the <strong>New</strong> button.</li>
<li>Enter in your information.</li>
<li>Click on <strong>Enable SAML</strong></li>
<li>For the &#8220;Entity ID&#8221; field enter in <code class="docutils literal"><span class="pre">changeme</span></code> as a temporary value</li>
<li>For the &#8220;ACS URL&#8221; you will also enter in a temporary value: <code class="docutils literal"><span class="pre">http://example.com</span></code></li>
<li>For &#8220;Name ID Format&#8221; select the &#8220;emailAddress&#8221; format. Unlike the other two, this value is not temporary.</li>
<li>Click <strong>Save</strong>.</li>
</ol>
</div>
<div class="section" id="get-your-sso-urls">
<h4>1.4. Get your SSO URLs<a class="headerlink" href="#get-your-sso-urls" title="Permalink to this headline">¶</a></h4>
<p>You will now be on your Connected App&#8217;s page.</p>
<ol class="arabic simple">
<li>Click <strong>Manage</strong></li>
<li>Under &#8220;SAML Login Information&#8221;, copy the &#8220;SP-Initiated Redirect Endpoint&#8221;. It will be a URL ending in <code class="docutils literal"><span class="pre">idp/endpoint/HttpRedirect</span></code>. This value will be used for both your &#8220;SSO Login URL&#8221; and &#8220;SSO Logout URL&#8221; when you are setting up your Stormpath SAML Directory.</li>
</ol>
</div>
</div>
<div class="section" id="step-2-create-your-saml-directory-in-stormpath">
<h3><a class="toc-backref" href="#id41">Step 2: Create Your SAML Directory in Stormpath</a><a class="headerlink" href="#step-2-create-your-saml-directory-in-stormpath" title="Permalink to this headline">¶</a></h3>
<p>You will now create your SAML Directory in Stormpath, using the values you gathered in the previous step. Then you will use information from this newly-created Directory to configure Stormpath as a Service Provider in Salesforce in the next step.</p>
<div class="section" id="create-your-saml-directory">
<h4>2.1. Create Your SAML Directory<a class="headerlink" href="#create-your-saml-directory" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Log in to the Stormpath Admin Console: <a class="reference external" href="https://api.stormpath.com">https://api.stormpath.com</a></li>
<li>Click on the <strong>Directories</strong> tab.</li>
<li>Click on <strong>Create Directory</strong>.</li>
<li>From the &#8220;Directory Type&#8221; drop-down menu, select &#8220;SAML&#8221;, which will bring up a Directory creation dialog.</li>
<li>Next, enter in a name and (optionally) a description, then set the Directory&#8217;s status to &#8220;Enabled&#8221;.</li>
<li>For both the &#8220;SAML SSO Login Url&#8221; and &#8220;SAML SSO Logout Url&#8221; fields, you will enter in the URL gathered in step 1.4 above.</li>
<li>For the &#8220;SAML X.509 Signing Cert&#8221; field, paste in the text content from the IdP certificate you downloaded in step 1.1.</li>
<li>Finally, select &#8220;RSA-SHA256&#8221; as the &#8220;SAML Request Signature Algorithm&#8221;.</li>
<li>Once all this information is entered, click on <strong>Create Directory</strong>. At this point, you will arrive back on the main Directories page.</li>
</ol>
</div>
<div class="section" id="gather-your-saml-directory-information">
<h4>2.2. Gather Your SAML Directory Information<a class="headerlink" href="#gather-your-saml-directory-information" title="Permalink to this headline">¶</a></h4>
<p>Find and click on your new SAML Directory.</p>
<p>On this page, you will need the follow information:</p>
<ul class="simple">
<li>The Directory&#8217;s &#8220;HREF&#8221; found at the very top.</li>
<li>The &#8220;Assertion Consumer Service URL&#8221; found in the &#8220;SAML Identity Provider Configuration&#8221; section:</li>
</ul>
<p>We will now input these values into the Identity Provider.</p>
</div>
</div>
<div class="section" id="step-3-configure-your-service-provider-in-salesforce">
<h3><a class="toc-backref" href="#id42">Step 3: Configure Your Service Provider in Salesforce</a><a class="headerlink" href="#step-3-configure-your-service-provider-in-salesforce" title="Permalink to this headline">¶</a></h3>
<p>Back on your Connected App&#8217;s page (found under <strong>Administer</strong> &gt; <strong>Connected Apps</strong>), click <strong>Edit</strong>.</p>
<p>You will now enter in your Directory information:</p>
<ol class="arabic simple">
<li>For the &#8220;Entity ID&#8221;, you will need to enter in the Directory &#8220;HREF&#8221; for your SAML Directory.</li>
<li>The &#8220;ACS URL&#8221; is the &#8220;Assertion Consumer Service URL&#8221; from the previous step.</li>
<li>Click <strong>Save</strong></li>
<li>Under the &#8220;Profiles&#8221; section, you will need to click on <strong>Manage Profiles</strong> and select profiles appropriate to the users that will be logging in to your app. For more information about profiles, see the <a class="reference external" href="https://help.salesforce.com/apex/HTViewHelpDoc?id=admin_userprofiles.htm&amp;language=en">Salesforce documentation</a>.</li>
</ol>
</div>
<div class="section" id="step-4-configure-your-application-in-stormpath">
<h3><a class="toc-backref" href="#id43">Step 4: Configure Your Application in Stormpath</a><a class="headerlink" href="#step-4-configure-your-application-in-stormpath" title="Permalink to this headline">¶</a></h3>
<p>We will now complete the final steps in the Stormpath Admin Console: adding one or more Callback URIs to the Stormpath Application, and mapping your SAML Directory to your Application.</p>
<ol class="arabic simple">
<li>Switch back to the <a class="reference external" href="https://api.stormpath.com">Stormpath Admin Console</a> and go to the <strong>Applications</strong> tab.</li>
<li>Select the Application that will be using the SAML Directory.</li>
<li>On the main &#8220;Details&#8221; page, you will see &#8220;Authorized Callback URIs&#8221;. You should include here a list of the URLs that your users will be redirected to at the end of the SAML authentication flow. Note that the Authorized Callback URIs cannot exceed 4000 characters in total length.</li>
<li>Next click on <strong>Account Stores</strong> in the navigation pane.</li>
<li>Once you are on your Application&#8217;s Account Stores page, click <strong>Add Account Store</strong>. This will bring up the &#8220;Map Account Store&#8221; dialog.</li>
<li>Ensure that you are in the &#8220;Directories&#8221; tab and select your SAML Directory from the list.</li>
<li>Click <strong>Create Mappings</strong>.</li>
</ol>
<p>You have now completed the initial steps of setting-up log in via Salesforce.</p>
</div>
<div class="section" id="step-5-optional-configure-your-attribute-mappings">
<h3><a class="toc-backref" href="#id44">Step 5: (Optional) Configure Your Attribute Mappings</a><a class="headerlink" href="#step-5-optional-configure-your-attribute-mappings" title="Permalink to this headline">¶</a></h3>
<p>When a new Account logs in via SAML, Salesforce sends along a number of SAML attributes. These attributes are mapped to Stormpath <a class="reference external" href="https://docs.stormpath.com/rest/product-guide/latest/reference.html#account">Account attributes</a> (such as <code class="docutils literal"><span class="pre">givenName</span></code> or <code class="docutils literal"><span class="pre">email</span></code>) and these values are either stored, if the Account is new, or updated, if the Account exists but the values are different. In this step you will configure how these Salesforce SAML Attributes are mapped to Stormpath attributes.</p>
<div class="section" id="find-the-existing-saml-attributes">
<h4>5.1. Find the Existing SAML Attributes<a class="headerlink" href="#find-the-existing-saml-attributes" title="Permalink to this headline">¶</a></h4>
<p>If you have already successfully set-up SAML and authenticated a user with your app, you will be able to retrieve the SAML Attributes that Salesforce sends by retrieving the new user Account that was created inside Stormpath.</p>
<p>Specifically, you want that Account&#8217;s <code class="docutils literal"><span class="pre">providerData</span></code> resource, which you can see by clicking on the &#8220;HREF&#8221; link on the Account&#8217;s main page, then following the <cite>providerData</cite> <cite>href</cite> :</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/v1/accounts/xbKQemsqSForceXAMPLE/providerData&quot;</span><span class="p">,</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span><span class="s2">&quot;2016-01-20T17:56:25.532Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span><span class="s2">&quot;2016-01-20T17:57:22.530Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="s2">&quot;saml+testuser@email.com&quot;</span><span class="p">,</span>
  <span class="nt">&quot;is_portal_user&quot;</span><span class="p">:</span><span class="s2">&quot;false&quot;</span><span class="p">,</span>
  <span class="nt">&quot;providerId&quot;</span><span class="p">:</span><span class="s2">&quot;saml&quot;</span><span class="p">,</span>
  <span class="nt">&quot;userId&quot;</span><span class="p">:</span><span class="s2">&quot;00536000000G4ft&quot;</span><span class="p">,</span>
  <span class="nt">&quot;username&quot;</span><span class="p">:</span><span class="s2">&quot;saml+testuser@email.com&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Everything here other than <code class="docutils literal"><span class="pre">href</span></code>, <code class="docutils literal"><span class="pre">createdAt</span></code> and <code class="docutils literal"><span class="pre">modifiedAt</span></code> are Attributes passed by Salesforce.</p>
<p>Now the <code class="docutils literal"><span class="pre">email</span></code> Attribute has already been passed as part of the Account creation, but you can also map the other SAML Attributes to Stormpath Account attributes as well.</p>
</div>
<div class="section" id="add-any-additional-attributes-you-want">
<h4>5.2. Add Any Additional Attributes You Want<a class="headerlink" href="#add-any-additional-attributes-you-want" title="Permalink to this headline">¶</a></h4>
<p>If there are other attributes that you would like Salesforce to pass, you can configure this. From your Salesforce settings page:</p>
<ol class="arabic simple">
<li>Under <strong>Administer</strong>, click on <strong>Connected Apps</strong>.</li>
<li>Select the App you would like to configure.</li>
<li>On the App&#8217;s page, find the &#8220;Custom Attributes&#8221; section and click on <strong>New</strong></li>
<li>You will now be on the &#8220;Create Custom Attribute&#8221; page</li>
<li>Here you will specify a custom &#8220;Attribute key&#8221; and then select which Salesforce user information you want it to represent.</li>
</ol>
<p>For example:</p>
<ul class="simple">
<li>You could make the &#8220;Attribute key&#8221;: <code class="docutils literal"><span class="pre">firstname</span></code></li>
<li>Then click on <strong>Insert Field</strong></li>
<li>From here you would select <strong>$User &gt;</strong> and <strong>First Name</strong> then click <strong>Insert</strong></li>
<li>Click <strong>Save</strong></li>
</ul>
<p>You will now be returned to your App&#8217;s main page, and you will see the attribute you just added in the &#8220;Custom Attributes&#8221; section. You can add as many attributes as you wish.</p>
</div>
<div class="section" id="specify-your-mapping">
<h4>5.3. Specify Your Mapping<a class="headerlink" href="#specify-your-mapping" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Go to your <a class="reference external" href="https://api.stormpath.com/">Stormpath Admin Console</a></li>
<li>Click on the <strong>Directories</strong> tab</li>
<li>Select your Salesforce SAML Directory</li>
<li>Under the &#8220;SAML Attribute Statement Mapping Rules&#8221; section you will see three fields: &#8220;Name&#8221;, &#8220;Name Format&#8221;, and &#8220;Stormpath Attributes&#8221;</li>
<li>Here you will enter the Salesforce attribute name under &#8220;Name&#8221;</li>
<li>(Optional) Under &#8220;Name Format&#8221; you can enter <code class="docutils literal"><span class="pre">urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified</span></code></li>
<li>Finally, enter the Account attribute(s) that you would like this Salesforce attribute to map to</li>
</ol>
<p>For example, using the custom attribute from Step 4.2 above:</p>
<ul class="simple">
<li>For the &#8220;Name&#8221; enter <code class="docutils literal"><span class="pre">firstname</span></code></li>
<li>For &#8220;Stormpath Attributes&#8221; enter <code class="docutils literal"><span class="pre">givenName</span></code></li>
</ul>
<p>If a user now logs in, Stormpath will take the <code class="docutils literal"><span class="pre">firstname</span></code> SAML attribute and map it to the <code class="docutils literal"><span class="pre">givenName</span></code> field on the Stormpath Account resource.</p>
</div>
</div>
</div>
<div class="section" id="onelogin">
<span id="create-onelogin"></span><h2>OneLogin<a class="headerlink" href="#onelogin" title="Permalink to this headline">¶</a></h2>
<p>OneLogin is compatible with both the Service Provider and Identity Provider -initiated flows. The steps are identical except where indicated.</p>
<div class="contents local topic" id="id1">
<ul class="simple">
<li><a class="reference internal" href="#step-1-set-up-onelogin" id="id45">Step 1: Set-up OneLogin</a></li>
<li><a class="reference internal" href="#step-2-gather-your-onelogin-information" id="id46">Step 2: Gather Your OneLogin Information</a></li>
<li><a class="reference internal" href="#step-3-create-your-saml-directory-in-stormpath" id="id47">Step 3: Create Your SAML Directory in Stormpath</a></li>
<li><a class="reference internal" href="#step-4-configure-your-service-provider-in-onelogin" id="id48">Step 4: Configure Your Service Provider in OneLogin</a></li>
<li><a class="reference internal" href="#step-5-configure-your-application-in-stormpath" id="id49">Step 5: Configure Your Application in Stormpath</a></li>
<li><a class="reference internal" href="#step-6-optional-configure-your-attribute-mappings" id="id50">Step 6: (Optional) Configure Your Attribute Mappings</a></li>
</ul>
</div>
<div class="section" id="step-1-set-up-onelogin">
<h3><a class="toc-backref" href="#id45">Step 1: Set-up OneLogin</a><a class="headerlink" href="#step-1-set-up-onelogin" title="Permalink to this headline">¶</a></h3>
<p>Every OneLogin application will need its own Stormpath Directory. The users for that OneLogin application will only be able to log in if that application&#8217;s information is properly entered into a corresponding Stormpath Directory.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you already have a OneLogin application of this type (<code class="docutils literal"><span class="pre">SAML</span> <span class="pre">Test</span> <span class="pre">Connector</span> <span class="pre">(IdP</span> <span class="pre">w/</span> <span class="pre">attr</span> <span class="pre">w/</span> <span class="pre">sign</span> <span class="pre">response)</span></code>), you can skip this step.</p>
</div>
<ol class="arabic simple">
<li>Complete the OneLogin set-up, including adding your subdomain, users, etc.</li>
<li>On the &#8220;Find Applications&#8221; page, search for &#8220;SAML&#8221;</li>
<li>Select <strong>SAML Test Connector (IdP w/ attr w/ sign response)</strong></li>
<li>Give your app a name and click <strong>Save</strong></li>
</ol>
</div>
<div class="section" id="step-2-gather-your-onelogin-information">
<h3><a class="toc-backref" href="#id46">Step 2: Gather Your OneLogin Information</a><a class="headerlink" href="#step-2-gather-your-onelogin-information" title="Permalink to this headline">¶</a></h3>
<p>You will now need to gather the following pieces of information from your OneLogin application:</p>
<ul class="simple">
<li>X.509 Signing Certificate</li>
<li>SSO Login URL</li>
<li>SSO Logout URL</li>
<li>Request Signature Algorithm</li>
</ul>
<p>To start, click on <strong>SSO</strong> in your App&#8217;s navigation pane.</p>
<div class="section" id="idp-signing-certificate">
<h4>2.1 IdP Signing Certificate<a class="headerlink" href="#idp-signing-certificate" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Under &#8220;X.509 Certificate&#8221;, click on <strong>View Details</strong>. This will take you to the certificate details page.</li>
<li>Copy the contents of the &#8220;X.509 Certificate&#8221; text box, starting with the line <code class="docutils literal"><span class="pre">-----BEGIN</span> <span class="pre">CERTIFICATE-----</span></code> and ending with <code class="docutils literal"><span class="pre">-----END</span> <span class="pre">CERTIFICATE-----</span></code>. The contents of this file are your &#8220;SAML X.509 Signing Cert&#8221;.</li>
</ol>
</div>
<div class="section" id="the-sso-login-logout-urls">
<h4>2.2. The SSO Login / Logout URLs<a class="headerlink" href="#the-sso-login-logout-urls" title="Permalink to this headline">¶</a></h4>
<p>Return to the <strong>App</strong> &gt; <strong>SSO</strong> section. On this page there are two different URLS:</p>
<ol class="arabic simple">
<li>Copy the &#8220;SAML 2.0 Endpoint (HTTP)&#8221;, which is the &#8220;SSO Login URL&#8221; that Stormpath needs, and</li>
<li>Copy the &#8220;SLO Endpoint (HTTP)&#8221;, which is the &#8220;SSO Logout URL&#8221;.</li>
</ol>
</div>
</div>
<div class="section" id="step-3-create-your-saml-directory-in-stormpath">
<h3><a class="toc-backref" href="#id47">Step 3: Create Your SAML Directory in Stormpath</a><a class="headerlink" href="#step-3-create-your-saml-directory-in-stormpath" title="Permalink to this headline">¶</a></h3>
<p>We will now create your SAML Directory in Stormpath, using the values you gathered in the previous step. Then you will use information from this newly-created Directory to configure Stormpath as a Service Provider in OneLogin in the next step.</p>
<div class="section" id="id2">
<h4>3.1. Create Your SAML Directory<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Log in to the Stormpath Admin Console: <a class="reference external" href="https://api.stormpath.com">https://api.stormpath.com</a></li>
<li>Click on the <strong>Directories</strong> tab.</li>
<li>Click on <strong>Create Directory</strong>.</li>
<li>From the &#8220;Directory Type&#8221; drop-down menu, select &#8220;SAML&#8221;, which will bring up a Directory creation dialog.</li>
<li>Next, enter in a name and (optionally) a description, then set the Directory&#8217;s status.</li>
<li>For &#8220;SAML SSO Login Url&#8221; paste in the &#8220;SAML 2.0 Endpoint (HTTP)&#8221; from the OneLogin site.</li>
<li>For &#8220;SAML SSO Logout Url&#8221; fields, paste in the &#8220;SLO Endpoint (HTTP)&#8221; from step 1.2 above.</li>
<li>For the &#8220;SAML X.509 Signing Cert&#8221; field, paste in the text content from the IdP certificate in step 1.1.</li>
<li>Finally, select &#8220;RSA-SHA256&#8221; as the &#8220;SAML Request Signature Algorithm&#8221;.</li>
<li>Once all this information is entered, click on <strong>Create Directory</strong>. At this point, you will arrive back on the main Directories page.</li>
</ol>
</div>
<div class="section" id="id3">
<h4>3.2. Gather Your SAML Directory Information<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Find and click on your new SAML Directory.</li>
<li>Copy the &#8220;Assertion Consumer Service URL&#8221; found in the &#8220;Identity Provider&#8221; tab of the &#8220;SAML Configuration&#8221; section.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You should leave this page open, since you&#8217;ll be back here in Step 4.</p>
</div>
<p>We will now input this value into the Identity Provider.</p>
</div>
<div class="section" id="idp-initiated-flow-only-generate-a-relaystate">
<h4>3.3. (IdP-initiated Flow Only) Generate a RelayState<a class="headerlink" href="#idp-initiated-flow-only-generate-a-relaystate" title="Permalink to this headline">¶</a></h4>
<p>If you are looking to use the IdP-initiated flow, you will also need to click on <strong>Generate Default RelayState</strong>.</p>
<p>This will bring up a dialog box where you will have to specify the Application that you are generating the RelayState for, as well as the API Key that this Application uses.</p>
<p>Optionally, you can also indicate which Organization and Callback URI will use this RelayState.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All of the values here must be in some way associated to your Directory. So the Application you specify must have this Directory as an Account Store, the Callback URI should be one from the Application&#8217;s list of URIs, etc.</p>
</div>
<p>Once you have selected all of the desired values, click <strong>Generate</strong>.</p>
<p>This will bring up the generated Default RelayState JWT. You will need this in the next step.</p>
</div>
</div>
<div class="section" id="step-4-configure-your-service-provider-in-onelogin">
<h3><a class="toc-backref" href="#id48">Step 4: Configure Your Service Provider in OneLogin</a><a class="headerlink" href="#step-4-configure-your-service-provider-in-onelogin" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Back in your OneLogin App&#8217;s settings page (found under <strong>Apps</strong> &gt; <strong>Company Apps</strong>), click <strong>Configuration</strong> in the App&#8217;s navigation pane.</li>
<li>Copy your Directory&#8217;s &#8220;Assertion Consumer Service URL&#8221; into both the &#8220;ACS (Consumer) URL Validator&#8221; and &#8220;ACS (Consumer) URL&#8221; fields.</li>
<li><em>(IdP-initiated Flow Only)</em> Copy the RelayState JWT from Step 3.3 into the &#8220;RelayState&#8221; box.</li>
<li>Now click on <strong>Parameters</strong> in the App navigation pane. On this page, you need to ensure that your &#8220;Email (SAML NameID)&#8221; field has the value &#8220;Email&#8221;, which it should by default.</li>
</ol>
</div>
<div class="section" id="step-5-configure-your-application-in-stormpath">
<h3><a class="toc-backref" href="#id49">Step 5: Configure Your Application in Stormpath</a><a class="headerlink" href="#step-5-configure-your-application-in-stormpath" title="Permalink to this headline">¶</a></h3>
<p>We will now complete the final steps in the Stormpath Admin Console: adding one or more Callback URIs to the Application, and mapping your SAML Directory to your Application.</p>
<ol class="arabic simple">
<li>Switch back to the <a class="reference external" href="https://api.stormpath.com">Stormpath Admin Console</a> and go to the <strong>Applications</strong> tab.</li>
<li>Select the Application that will be using the SAML Directory.</li>
<li>On the main &#8220;Details&#8221; page, you will see &#8220;Authorized Callback URIs&#8221;. You should include here a list of the URLs that your users will be redirected to at the end of the SAML authentication flow. Note that the Authorized Callback URIs cannot exceed 4000 characters in total length.</li>
<li>Next click on <strong>Account Stores</strong> in the navigation pane.</li>
<li>Once you are on your Application&#8217;s Account Stores page, click &#8220;Add Account Store&#8221;. This will bring up the &#8220;Map Account Store&#8221; dialog.</li>
<li>Ensure that you are in the &#8220;Directories&#8221; tab and select your SAML Directory from the list.</li>
<li>Click <strong>Create Mappings</strong>.</li>
</ol>
<p>You have now completed the initial steps of setting-up log in via OneLogin.</p>
</div>
<div class="section" id="step-6-optional-configure-your-attribute-mappings">
<h3><a class="toc-backref" href="#id50">Step 6: (Optional) Configure Your Attribute Mappings</a><a class="headerlink" href="#step-6-optional-configure-your-attribute-mappings" title="Permalink to this headline">¶</a></h3>
<p>When a new Account logs in via SAML, OneLogin sends along a number of SAML attributes. These attributes are mapped to Stormpath <a class="reference external" href="https://docs.stormpath.com/rest/product-guide/latest/reference.html#account">Account attributes</a> (such as <code class="docutils literal"><span class="pre">givenName</span></code> or <code class="docutils literal"><span class="pre">email</span></code>) and these values are either stored, if the Account is new, or updated, if the Account exists but the values are different. In this step you will configure how these OneLogin SAML Attributes are mapped to Stormpath attributes.</p>
<div class="section" id="id4">
<h4>6.1. Find the Existing SAML Attributes<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>If you have already successfully set-up SAML and authenticated a user with your app, you will be able to retrieve the SAML Attributes that OneLogin sends by retrieving the new user Account that was created inside Stormpath.</p>
<p>Specifically, you want that Account&#8217;s <code class="docutils literal"><span class="pre">providerData</span></code> resource, which you can see by clicking on the &#8220;HREF&#8221; link on the Account&#8217;s main page, then following the <cite>providerData</cite> <cite>href</cite> :</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/v1/accounts/2i6RxkcOneLogineXaMPle/providerData&quot;</span><span class="p">,</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span><span class="s2">&quot;2016-01-21T18:11:09.838Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span><span class="s2">&quot;2016-01-21T18:13:39.102Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;PersonImmutableID&quot;</span><span class="p">:</span><span class="s2">&quot;samltestuser&quot;</span><span class="p">,</span>
  <span class="nt">&quot;User.FirstName&quot;</span><span class="p">:</span><span class="s2">&quot;John&quot;</span><span class="p">,</span>
  <span class="nt">&quot;User.LastName&quot;</span><span class="p">:</span><span class="s2">&quot;Samlton&quot;</span><span class="p">,</span>
  <span class="nt">&quot;User.email&quot;</span><span class="p">:</span><span class="s2">&quot;saml+testuser@example.com&quot;</span><span class="p">,</span>
  <span class="nt">&quot;providerId&quot;</span><span class="p">:</span><span class="s2">&quot;saml&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Everything here other than <code class="docutils literal"><span class="pre">href</span></code>, <code class="docutils literal"><span class="pre">createdAt</span></code> and <code class="docutils literal"><span class="pre">modifiedAt</span></code> are Attributes passed by OneLogin.</p>
<p>Now the <code class="docutils literal"><span class="pre">email</span></code> Attribute has already been passed as part of the Account creation, but you can also map the other attributes to Stormpath Account attributes as well.</p>
</div>
<div class="section" id="id5">
<h4>6.2. Add Any Additional Attributes You Want<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>If there are other attributes that you would like OneLogin to pass, you can configure this. From your OneLogin settings page:</p>
<ol class="arabic simple">
<li>Click on <strong>Apps</strong> &gt; <strong>Company Apps</strong></li>
<li>Select the App that you want to configure</li>
<li>From the App&#8217;s page, click on <strong>Parameters</strong></li>
<li>If you want to add any additional parameters, click on <strong>Add parameter</strong></li>
<li>In the &#8220;New Field&#8221; dialog box, give the attribute whatever name you wish, and select <strong>Include in SAML assertion</strong></li>
<li>Back on the &#8220;Parameters&#8221; page, click on your new Attribute. This will bring up the &#8220;Edit Field&#8221; dialog</li>
<li>Select the &#8220;Value&#8221; that you would like this Attribute to represent. This is the piece of user information OneLogin stores that you would like to be transferred to Stormpath in your Attribute.</li>
<li>Click <strong>Save</strong></li>
</ol>
<p>For example:</p>
<ul class="simple">
<li>For &#8220;Field name&#8221; enter <code class="docutils literal"><span class="pre">companyName</span></code> and check &#8220;Include in SAML assertion&#8221;</li>
<li>For the &#8220;Value&#8221; you would choose &#8220;Company&#8221;</li>
</ul>
<p>You will now be returned to your App&#8217;s main page, and you will see the attribute you just added in the &#8220;Custom Attributes&#8221; section. You can add as many attributes as you wish.</p>
</div>
<div class="section" id="id6">
<h4>6.3. Specify Your Mapping<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Go to your <a class="reference external" href="https://api.stormpath.com/">Stormpath Admin Console</a></li>
<li>Click on the <strong>Directories</strong> tab</li>
<li>Select your OneLogin SAML Directory</li>
<li>Under the &#8220;SAML Attribute Statement Mapping Rules&#8221; section you will see three fields: &#8220;Name&#8221;, &#8220;Name Format&#8221;, and &#8220;Stormpath Attributes&#8221;</li>
<li>Here you will enter the OneLogin attribute name under &#8220;Name&#8221;</li>
<li>(Optional) Under &#8220;Name Format&#8221; you can enter <code class="docutils literal"><span class="pre">urn:oasis:names:tc:SAML:2.0:attrname-format:basic</span></code></li>
<li>Finally, enter the Account attribute(s) that you would like this OneLogin attribute to map to</li>
</ol>
<p>For example, you could enter:</p>
<ul class="simple">
<li>For the &#8220;Name&#8221; enter <code class="docutils literal"><span class="pre">User.FirstName</span></code></li>
<li>For &#8220;Stormpath Attributes&#8221; enter <code class="docutils literal"><span class="pre">givenName</span></code></li>
</ul>
<p>If a user now logs in, Stormpath will take the <code class="docutils literal"><span class="pre">User.FirstName</span></code> attribute and map it to the <code class="docutils literal"><span class="pre">givenName</span></code> field on the Account resource.</p>
</div>
</div>
</div>
<div class="section" id="okta">
<span id="create-okta"></span><h2>Okta<a class="headerlink" href="#okta" title="Permalink to this headline">¶</a></h2>
<p>Okta is compatible with both the Service Provider and Identity Provider -initiated flows. The steps are identical except where indicated.</p>
<div class="contents local topic" id="id7">
<ul class="simple">
<li><a class="reference internal" href="#step-1-set-up-okta" id="id51">Step 1: Set-up Okta</a></li>
<li><a class="reference internal" href="#step-2-gather-information-from-okta" id="id52">Step 2: Gather Information From Okta</a></li>
<li><a class="reference internal" href="#id8" id="id53">Step 3: Create Your SAML Directory in Stormpath</a></li>
<li><a class="reference internal" href="#step-4-configure-your-service-provider-in-okta" id="id54">Step 4: Configure Your Service Provider in Okta</a></li>
<li><a class="reference internal" href="#id12" id="id55">Step 5: Configure Your Application in Stormpath</a></li>
<li><a class="reference internal" href="#id13" id="id56">Step 6: (Optional) Configure Your Attribute Mappings</a></li>
</ul>
</div>
<div class="section" id="step-1-set-up-okta">
<h3><a class="toc-backref" href="#id51">Step 1: Set-up Okta</a><a class="headerlink" href="#step-1-set-up-okta" title="Permalink to this headline">¶</a></h3>
<p>Every Okta application will need its own Stormpath Directory. The users for that Okta application will only be able to log in if that application&#8217;s information is properly entered into a corresponding Stormpath Directory.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you already have an Okta application, you can skip to Step 5.</p>
</div>
<ol class="arabic simple">
<li>Log in to your Okta Administrator Account. From the landing page click on <strong>Admin</strong> to go to your Admin Dashboard.</li>
<li>From here, click on <strong>Add Applications</strong> in the shortcuts on the right.</li>
<li>Click on <strong>Create New App</strong>, which will bring up a &#8220;Create a New Application Integration&#8221; dialog.</li>
<li>Select &#8220;SAML 2.0&#8221; and click <strong>Create</strong>.</li>
<li>Enter in the information on the &#8220;General Settings&#8221; page and then click <strong>Next</strong>.</li>
<li>For now you will enter dummy data here, and then return later to input the actual values. For both the &#8220;Single sign on URL&#8221; and &#8220;Audience URI&#8221;, enter in the dummy value <code class="docutils literal"><span class="pre">http://example.com/</span></code></li>
<li>For the &#8220;Name ID format&#8221; select &#8220;EmailAddress&#8221;.</li>
<li>Click <strong>Next</strong> at the bottom of the page.</li>
<li>On the &#8220;Feedback&#8221; page, select <strong>I&#8217;m an Okta customer adding an internal app</strong> and <strong>This is an internal app that you have created</strong>, then select <strong>Finish</strong>.</li>
</ol>
<p>You will now arrive at your App&#8217;s Admin page.</p>
<ol class="arabic simple">
<li>Click on <strong>View Setup Instructions</strong></li>
</ol>
</div>
<div class="section" id="step-2-gather-information-from-okta">
<h3><a class="toc-backref" href="#id52">Step 2: Gather Information From Okta</a><a class="headerlink" href="#step-2-gather-information-from-okta" title="Permalink to this headline">¶</a></h3>
<p>You will now need to gather the required information from Okta:</p>
<ol class="arabic simple">
<li>Copy the &#8220;Identity Provider Single Sign-On URL&#8221;. This will be the value for both the &#8220;SSO Login URL&#8221; and &#8220;SSO Logout URL&#8221; in your Stormpath configuration.</li>
<li>Copy the contents of the &#8220;X.509 Certificate&#8221; text box, starting with the line <code class="docutils literal"><span class="pre">-----BEGIN</span> <span class="pre">CERTIFICATE-----</span></code> and ending with <code class="docutils literal"><span class="pre">-----END</span> <span class="pre">CERTIFICATE-----</span></code>. The contents of this file are your &#8220;SAML X.509 Signing Cert&#8221;.</li>
<li>By default, Okta uses the SHA-256 signature algorithm for all self-signed certificates. Click on the <strong>General</strong> tab in the App navigation pane, and look under &#8220;SAML Settings&#8221; to confirm that the Signature Algorithm is &#8220;RSA_SHA256&#8221;.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is recommended that you stay on this page, as you will be returning here in Step 3 to add more configuration details.</p>
</div>
</div>
<div class="section" id="id8">
<h3><a class="toc-backref" href="#id53">Step 3: Create Your SAML Directory in Stormpath</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>We will now create your SAML Directory in Stormpath, using the values you gathered in the previous step. Then you will use information from this newly-created Directory to configure Stormpath as a Service Provider in the IdP in the next step.</p>
<div class="section" id="id9">
<h4>3.1. Create Your SAML Directory<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Log in to the Stormpath Admin Console: <a class="reference external" href="https://api.stormpath.com">https://api.stormpath.com</a></li>
<li>Click on the <strong>Directories</strong> tab.</li>
<li>Click on <strong>Create Directory</strong>.</li>
<li>From the &#8220;Directory Type&#8221; drop-down menu, select &#8220;SAML&#8221;, which will bring up a Directory creation dialog.</li>
<li>Next, enter in a name and (optionally) a description, then set the Directory&#8217;s status.</li>
<li>For both &#8220;SAML SSO Login Url&#8221; and &#8220;SAML SSO Logout URL&#8221; paste in the &#8220;Identity Provider Single Sign-On URL&#8221; from above.</li>
<li>For the &#8220;SAML X.509 Signing Cert&#8221; field, paste in the text content from the IdP certificate in Step 2.</li>
<li>Finally, select &#8220;RSA-SHA256&#8221; as the &#8220;SAML Request Signature Algorithm&#8221;.</li>
<li>Once all this information is entered, click on <strong>Create Directory</strong>. At this point, you will arrive back on the main Directories page.</li>
</ol>
</div>
<div class="section" id="id10">
<h4>3.2. Gather Your SAML Directory Information<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Find and click on your new SAML Directory.</li>
</ol>
<p>In the &#8220;SAML Identity Provider Configuration&#8221; section:</p>
<ol class="arabic simple">
<li>Copy the &#8220;Entity ID&#8221; URN.</li>
<li>Copy the &#8220;Assertion Consumer Service URL&#8221;.</li>
</ol>
<p>We will now input these values into the Identity Provider.</p>
</div>
<div class="section" id="id11">
<h4>3.3. (IdP-initiated Flow Only) Generate a RelayState<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p>If you are looking to use the IdP-initiated flow, you will also need to click on <strong>Generate Default RelayState</strong>.</p>
<p>This will bring up a dialog box where you will have to specify the Application that you are generating the RelayState for, as well as the API Key that this Application uses.</p>
<p>Optionally, you can also indicate which Organization and Callback URI will use this RelayState.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All of the values here must be in some way associated to your Directory. So the Application you specify must have this Directory as an Account Store, the Callback URI should be one from the Application&#8217;s list of URIs, etc.</p>
</div>
<p>Once you have selected all of the desired values, click <strong>Generate</strong>.</p>
<p>This will bring up the generated Default RelayState JWT. You will need this in the next step.</p>
</div>
</div>
<div class="section" id="step-4-configure-your-service-provider-in-okta">
<h3><a class="toc-backref" href="#id54">Step 4: Configure Your Service Provider in Okta</a><a class="headerlink" href="#step-4-configure-your-service-provider-in-okta" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Back in your App&#8217;s &#8220;General&#8221; tab, find the &#8220;SAML Settings&#8221; section and click <strong>Edit</strong>.</li>
<li>From the &#8220;General Settings&#8221; page click <strong>Next</strong>.</li>
<li>You will now be on the &#8220;Configure SAML&#8221; page. Copy your Directory&#8217;s &#8220;Assertion Consumer Service URL&#8221; into the &#8220;Single sign on URL&#8221; field, replacing the dummy value.</li>
<li>Copy the &#8220;Entity ID&#8221; URN into the &#8220;Audience URI (SP Entity ID)&#8221;, also replacing the dummy value.</li>
<li><em>(IdP-initiated Flow Only)</em> Copy the RelayState JWT from Step 3.3 into the &#8220;Default RelayState&#8221; box.</li>
</ol>
</div>
<div class="section" id="id12">
<h3><a class="toc-backref" href="#id55">Step 5: Configure Your Application in Stormpath</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>We will now complete the final steps in the Stormpath Admin Console: adding one or more Callback URIs to the Application, and mapping your SAML Directory to your Application.</p>
<ol class="arabic simple">
<li>Switch back to the <a class="reference external" href="https://api.stormpath.com">Stormpath Admin Console</a> and go to the <strong>Applications</strong> tab.</li>
<li>Select the Application that will be using the SAML Directory.</li>
<li>On the main &#8220;Details&#8221; page, you will see &#8220;Authorized Callback URIs&#8221;. You should include here a list of the URLs that your users will be redirected to at the end of the SAML authentication flow. Note that the Authorized Callback URIs cannot exceed 4000 characters in total length.</li>
<li>Next click on <strong>Account Stores</strong> in the navigation pane.</li>
<li>Once you are on your Application&#8217;s Account Stores page, click &#8220;Add Account Store&#8221;. This will bring up the &#8220;Map Account Store&#8221; dialog.</li>
<li>Ensure that you are in the &#8220;Directories&#8221; tab and select your SAML Directory from the list.</li>
<li>Click <strong>Create Mappings</strong>.</li>
</ol>
<p>You have now completed the initial steps of setting-up login via Okta.</p>
</div>
<div class="section" id="id13">
<h3><a class="toc-backref" href="#id56">Step 6: (Optional) Configure Your Attribute Mappings</a><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>When a new Account logs in via SAML, Okta sends along a number of SAML attributes. These attributes are mapped to Stormpath <a class="reference external" href="https://docs.stormpath.com/rest/product-guide/latest/reference.html#account">Account attributes</a> (such as <code class="docutils literal"><span class="pre">givenName</span></code> or <code class="docutils literal"><span class="pre">email</span></code>) and these values are either stored, if the Account is new, or updated, if the Account exists but the values are different. In this step you will configure how these IdP SAML Attributes are mapped to Stormpath attributes.</p>
<div class="section" id="id14">
<h4>6.1. Find the Existing SAML Attributes<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<p>If you have already successfully set-up SAML and authenticated a user with your app, you will be able to retrieve the SAML Attributes that Okta sends by retrieving the new user Account that was created inside Stormpath.</p>
<p>Specifically, you want that Account&#8217;s <code class="docutils literal"><span class="pre">providerData</span></code> resource, which you can see by clicking on the &#8220;HREF&#8221; link on the Account&#8217;s main page, then following the <cite>providerData</cite> <cite>href</cite> :</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/v1/accounts/6Y2ViNhE5GOktaExample/providerData&quot;</span><span class="p">,</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span><span class="s2">&quot;2016-03-09T18:16:16.116Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span><span class="s2">&quot;2016-03-25T14:49:30.098Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;providerId&quot;</span><span class="p">:</span><span class="s2">&quot;saml&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As you can see there are no default attributes passed by Okta, but you can map any attributes you like to the Stormpath Account attributes as well.</p>
</div>
<div class="section" id="id15">
<h4>6.2. Add Any Additional Attributes You Want<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<p>If there are attributes that you would like Okta to pass, you can configure this. From your Okta Admin settings page:</p>
<ol class="arabic simple">
<li>Click on the <strong>Applications</strong> tab in the top navigation pane</li>
<li>Select your Application</li>
<li>In the &#8220;SAML Settings&#8221; section, click on <strong>Edit</strong></li>
<li>You will arrive on &#8220;General Settings&#8221;, click <strong>Next</strong></li>
<li>On the &#8220;Configure SAML&#8221; page, you will see a section called &#8220;Attribute Statements&#8221;. Here you can specify whatever additional attributes that you would like to be sent.</li>
</ol>
<p>For example:</p>
<ul class="simple">
<li>For &#8220;Name&#8221; enter <code class="docutils literal"><span class="pre">firstName</span></code></li>
<li>(Optional) For &#8220;Name format&#8221; you can select &#8220;Basic&#8221;</li>
<li>For the &#8220;Value&#8221; you would choose &#8220;user:firstName&#8221;</li>
<li>Click &#8220;Next&#8221; and on the next page &#8220;Finish&#8221;</li>
</ul>
<p>You will now be returned to your App&#8217;s &#8220;Sign on&#8221; page. If you click on the &#8220;General&#8221; tab, you will see the attribute you just added in the &#8220;Attribute Statements&#8221; section. You can add as many attributes as you wish.</p>
</div>
<div class="section" id="id16">
<h4>6.3. Specify Your Mapping<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Go to your <a class="reference external" href="https://api.stormpath.com/">Stormpath Admin Console</a></li>
<li>Click on the <strong>Directories</strong> tab</li>
<li>Select your Okta SAML Directory</li>
<li>Under the &#8220;SAML Attribute Statement Mapping Rules&#8221; section you will see three fields: &#8220;Name&#8221;, &#8220;Name Format&#8221;, and &#8220;Stormpath Attributes&#8221;</li>
<li>Here you will enter the Okta attribute name under &#8220;Name&#8221;</li>
<li>(Optional) Under &#8220;Name Format&#8221; you can enter <code class="docutils literal"><span class="pre">Basic</span></code>.</li>
<li>Finally, enter the Account attribute(s) that you would like this Okta attribute to map to.</li>
</ol>
<p>For example, you could enter:</p>
<ul class="simple">
<li>For the &#8220;Name&#8221; enter <code class="docutils literal"><span class="pre">firstName</span></code></li>
<li>For &#8220;Stormpath Attributes&#8221; enter <code class="docutils literal"><span class="pre">givenName</span></code></li>
</ul>
<p>If a user now logs in, Stormpath will take the <code class="docutils literal"><span class="pre">firstName</span></code> attribute and map it to the <code class="docutils literal"><span class="pre">givenName</span></code> field on the Account resource.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you do choose to enter in an &#8220;Attribute Name Format&#8221; in Stormpath, it must match the SAML &#8220;NameFormat&#8221; passed by Okta. To ensure that you are entering the right one you can click on <strong>Preview the SAML Assertion</strong> on the &#8220;Configure SAML&#8221; page in your Okta application.</p>
</div>
</div>
</div>
</div>
<div class="section" id="ping">
<span id="create-ping"></span><h2>Ping<a class="headerlink" href="#ping" title="Permalink to this headline">¶</a></h2>
<p>Ping is only compatible with the Service Provider-initiated flow.</p>
<div class="contents local topic" id="id17">
<ul class="simple">
<li><a class="reference internal" href="#step-1-set-up-ping" id="id57">Step 1: Set-up Ping</a></li>
<li><a class="reference internal" href="#step-2-gather-your-ping-information" id="id58">Step 2: Gather Your Ping Information</a></li>
<li><a class="reference internal" href="#id20" id="id59">Step 3: Create Your SAML Directory in Stormpath</a></li>
<li><a class="reference internal" href="#step-3-configure-your-service-provider-in-ping" id="id60">Step 3: Configure Your Service Provider in Ping</a></li>
<li><a class="reference internal" href="#id23" id="id61">Step 4: Configure Your Application in Stormpath</a></li>
<li><a class="reference internal" href="#id24" id="id62">Step 5: (Optional) Configure Your Attribute Mappings</a></li>
</ul>
</div>
<div class="section" id="step-1-set-up-ping">
<h3><a class="toc-backref" href="#id57">Step 1: Set-up Ping</a><a class="headerlink" href="#step-1-set-up-ping" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Log in to your PingOne account: <a class="reference external" href="https://admin.pingone.com/web-portal/login">https://admin.pingone.com/web-portal/login</a></li>
<li>Click on the <strong>Applications</strong> tab on the top navigate pane.</li>
<li>Click on <strong>Add Application</strong> &gt; <strong>New SAML Application</strong></li>
<li>Fill in the information, the click on <strong>Continue to Next Step</strong></li>
</ol>
</div>
<div class="section" id="step-2-gather-your-ping-information">
<h3><a class="toc-backref" href="#id58">Step 2: Gather Your Ping Information</a><a class="headerlink" href="#step-2-gather-your-ping-information" title="Permalink to this headline">¶</a></h3>
<p>You will now need to gather the following pieces of information:</p>
<ul class="simple">
<li>X.509 Signing Certificate</li>
<li>SSO Login URL</li>
<li>SSO Logout URL</li>
</ul>
<p>Click on <strong>Download</strong> beside SAML Metadata, this will download <code class="docutils literal"><span class="pre">saml2-metadata-idp.xml</span></code>, which you need to open in a text editor of your choice. you will now retrieve the above information from this XML file.</p>
<div class="section" id="id18">
<h4>2.1 IdP Signing Certificate<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Inside the <code class="docutils literal"><span class="pre">&lt;ds:X509Certificate&gt;</span></code> assertion you will find the text of the x509 certificate. Unfortunately it is not in the PEM encoded format that Stormpath requires.</li>
<li>Copy and paste the content of this certificate into a new text file, ensuring that all of the text is fully left-justified.</li>
<li>Add a newline at the top of the certificate and add this: <code class="docutils literal"><span class="pre">-----BEGIN</span> <span class="pre">CERTIFICATE-----</span></code></li>
<li>Next add this to the bottom of the certificate: <code class="docutils literal"><span class="pre">-----END</span> <span class="pre">CERTIFICATE-----</span></code></li>
</ol>
<p>What you should now have is something that looks like this:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>-----BEGIN CERTIFICATE-----
MIIDaDCCAlCgAwIBAgIGAVQ0xF8mMA0GCSqGSIb3DQEBCwUAMHUxCzAJBgNVBAYTAlVTMQswCQYD
{More certificate content here}
8bMh4fe2s1wR6pDkVjgEwu0DW2zBcXSg9KuT3lcWEUIq3Bct7Cdng12C0zXbgnQJAFtzHYbXAwkG
sh3WzqLNeYeoU5sGPWhlvNR7n2R1
-----END CERTIFICATE-----
</pre></div>
</div>
</div>
<div class="section" id="id19">
<h4>2.2. The SSO Login / Logout URLs<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>For the &#8220;SSO Login URL&#8221;, find the <code class="docutils literal"><span class="pre">SingleSignOnService</span> <span class="pre">Location</span></code> assertion, which should look something like this: <code class="docutils literal"><span class="pre">https://sso.connect.pingidentity.com/sso/idp/SSO.saml2?idpid={hash}</span></code></li>
<li>For the &#8220;SSO Logout URL&#8221;, find the <code class="docutils literal"><span class="pre">SingleLogoutService</span> <span class="pre">Location</span></code> assertion, which should be exactly this: <code class="docutils literal"><span class="pre">https://sso.connect.pingidentity.com/sso/SLO.saml2</span></code></li>
</ol>
</div>
</div>
<div class="section" id="id20">
<h3><a class="toc-backref" href="#id59">Step 3: Create Your SAML Directory in Stormpath</a><a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<p>You will now create your SAML Directory in Stormpath, using the values you gathered in the previous step. Then you will use information from this newly-created Directory to configure Stormpath as a Service Provider in the IdP in the next step.</p>
<div class="section" id="id21">
<h4>2.1. Create Your SAML Directory<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Log in to the Stormpath Admin Console: <a class="reference external" href="https://api.stormpath.com">https://api.stormpath.com</a></li>
<li>Click on the <strong>Directories</strong> tab.</li>
<li>Click on <strong>Create Directory</strong>.</li>
<li>From the &#8220;Directory Type&#8221; drop-down menu, select &#8220;SAML&#8221;, which will bring up a Directory creation dialog.</li>
<li>Next, enter in a name and (optionally) a description, then set the Directory&#8217;s status to &#8220;Enabled&#8221;.</li>
<li>For both the &#8220;SAML SSO Login Url&#8221; and &#8220;SAML SSO Logout Url&#8221; fields, you will enter in the URL gathered in step 2.2 above.</li>
<li>For the &#8220;SAML X.509 Signing Cert&#8221; field, paste in the text content from the IdP certificate you created in step 2.1.</li>
<li>Finally, select &#8220;RSA-SHA256&#8221; as the &#8220;SAML Request Signature Algorithm&#8221;.</li>
<li>Once all this information is entered, click on <strong>Create Directory</strong>. At this point, you will arrive back on the main Directories page.</li>
</ol>
</div>
<div class="section" id="id22">
<h4>2.2. Gather Your SAML Directory Information<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h4>
<p>Find and click on your new SAML Directory.</p>
<p>From this page, you will need the follow information:</p>
<ul class="simple">
<li>The Directory&#8217;s &#8220;HREF&#8221; found at the very top.</li>
<li>The &#8220;Assertion Consumer Service URL&#8221; found in the &#8220;SAML Identity Provider Configuration&#8221; section</li>
</ul>
<p>We will now input these values into the Identity Provider.</p>
</div>
</div>
<div class="section" id="step-3-configure-your-service-provider-in-ping">
<h3><a class="toc-backref" href="#id60">Step 3: Configure Your Service Provider in Ping</a><a class="headerlink" href="#step-3-configure-your-service-provider-in-ping" title="Permalink to this headline">¶</a></h3>
<p>Back on your Ping Application&#8217;s page (where you previously downloaded the SAML Metadata), you will now enter in your Directory information:</p>
<ol class="arabic simple">
<li>The &#8220;Assertion Consumer Service (ACS)&#8221; is the Stormpath &#8220;Assertion Consumer Service URL&#8221; from the previous step.</li>
<li>The &#8220;Entity ID&#8221; is the Directory &#8220;HREF&#8221; for your Stormpth SAML Directory.</li>
<li>Click <strong>Continue to Next Step</strong>, then click <strong>Save &amp; Publish</strong></li>
</ol>
</div>
<div class="section" id="id23">
<h3><a class="toc-backref" href="#id61">Step 4: Configure Your Application in Stormpath</a><a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h3>
<p>We will now complete the final steps in the Stormpath Admin Console: adding one or more Callback URIs to the Application, and mapping your SAML Directory to your Application.</p>
<ol class="arabic simple">
<li>Switch back to the <a class="reference external" href="https://api.stormpath.com">Stormpath Admin Console</a> and go to the <strong>Applications</strong> tab.</li>
<li>Select the Application that will be using the SAML Directory.</li>
<li>On the main &#8220;Details&#8221; page, you will see &#8220;Authorized Callback URIs&#8221;. You should include here a list of the URLs that your users will be redirected to at the end of the SAML authentication flow. Note that the Authorized Callback URIs cannot exceed 4000 characters in total length.</li>
<li>Next click on <strong>Account Stores</strong> in the left-side navigation pane.</li>
<li>Once you are on your Application&#8217;s Account Stores page, click <strong>Add Account Store</strong>. This will bring up the &#8220;Map Account Store&#8221; dialog.</li>
<li>Ensure that you are in the &#8220;Directories&#8221; tab and select your Ping Identity Directory from the list.</li>
<li>Click <strong>Create Mappings</strong>.</li>
</ol>
<p>You have now completed the initial steps of configuring login via SAML for Ping Identity.</p>
</div>
<div class="section" id="id24">
<h3><a class="toc-backref" href="#id62">Step 5: (Optional) Configure Your Attribute Mappings</a><a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h3>
<p>When a new Account logs in via SAML, Ping sends along a number of SAML attributes. These attributes are mapped to Stormpath <a class="reference external" href="https://docs.stormpath.com/rest/product-guide/latest/reference.html#account">Account attributes</a> (such as <code class="docutils literal"><span class="pre">givenName</span></code> or <code class="docutils literal"><span class="pre">email</span></code>) and these values are either stored, if the Account is new, or updated, if the Account exists but the values are different. In this step you will configure how these Ping SAML Attributes are mapped to Stormpath attributes.</p>
<div class="section" id="id25">
<h4>4.1. Find the Existing SAML Attributes<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h4>
<p>If you have already successfully set-up SAML and authenticated a user with your app, you will be able to retrieve the SAML Attributes that Ping sends by retrieving the new user Account that was created inside Stormpath.</p>
<p>Specifically, you want that Account&#8217;s <code class="docutils literal"><span class="pre">providerData</span></code> resource, which you can see by clicking on the &#8220;HREF&#8221; link on the Account&#8217;s main page, then following the <cite>providerData</cite> <cite>href</cite> :</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/4QwSP7tumdJJoCzPHiZ1Oq/providerData&quot;</span><span class="p">,</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-04-22T19:01:07.281Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-04-22T19:01:07.291Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;PingOne.AuthenticatingAuthority&quot;</span><span class="p">:</span> <span class="s2">&quot;https://pingone.com/idp/cd-1935055751.stormpath&quot;</span><span class="p">,</span>
  <span class="nt">&quot;PingOne.idpid&quot;</span><span class="p">:</span> <span class="s2">&quot;4ad1f356-08f2-440d-955a-60873af45948&quot;</span><span class="p">,</span>
  <span class="nt">&quot;providerId&quot;</span><span class="p">:</span> <span class="s2">&quot;saml&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Everything here other than <code class="docutils literal"><span class="pre">href</span></code>, <code class="docutils literal"><span class="pre">createdAt</span></code> and <code class="docutils literal"><span class="pre">modifiedAt</span></code> are Attributes passed by Ping.</p>
<p>If you want, you can map other SAML Attributes to Stormpath Account attributes.</p>
</div>
<div class="section" id="id26">
<h4>4.2. Add Any Additional Attributes You Want<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h4>
<p>If there are other attributes that you would like Ping to pass, you can configure this.</p>
<ol class="arabic simple">
<li>Make sure you are on the Ping Identity Admin Settings page, in the &#8220;My Applications&#8221; section: <a class="reference external" href="https://admin.pingone.com/web-portal/cas/connections">https://admin.pingone.com/web-portal/cas/connections</a></li>
<li>Find your application, and click the ▶ to the right of the &#8220;Remove&#8221; button. This will expand your Application details.</li>
<li>Click the <strong>Edit</strong> button.</li>
<li>On the &#8220;Application Details&#8221; page click <strong>Continue to Next Step</strong></li>
<li>Click <strong>Continue to Next Step</strong> on the &#8220;Application Configuration&#8221; page as well.</li>
<li>Now you will arrive at &#8220;SSO Attribute Mapping&#8221;.</li>
<li>Click <strong>Add new attribute</strong></li>
<li>You can type whatever string you&#8217;d like under &#8220;Application Attribute&#8221;. For example, &#8220;firstName&#8221;.</li>
<li>Under &#8220;Identity Bridge Attribute or Literal Value&#8221; you can click on the textbox to see a list of available values. For this example, you&#8217;d select <strong>First Name</strong>.</li>
<li>Finally click on <strong>Save &amp; Publish</strong> and, on the next page, <strong>Finish</strong>.</li>
</ol>
</div>
<div class="section" id="id27">
<h4>4.3. Specify Your Mapping<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Go to your <a class="reference external" href="https://api.stormpath.com/">Stormpath Admin Console</a></li>
<li>Click on the <strong>Directories</strong> tab</li>
<li>Select your Ping SAML Directory</li>
<li>Under the &#8220;SAML Attribute Statement Mapping Rules&#8221; section you will see three fields: &#8220;Name&#8221;, &#8220;Name Format&#8221;, and &#8220;Stormpath Attributes&#8221;</li>
<li>Here you will enter the Ping attribute name under &#8220;Name&#8221;</li>
<li>Finally, enter the Account attribute(s) that you would like this Ping attribute to map to</li>
</ol>
<p>For example, you could enter, using the custom attribute from Step 4.2 above:</p>
<ul class="simple">
<li>For the &#8220;Name&#8221; enter <code class="docutils literal"><span class="pre">firstname</span></code></li>
<li>For &#8220;Stormpath Attributes&#8221; enter <code class="docutils literal"><span class="pre">givenName</span></code></li>
</ul>
<p>If a user now logs in, Stormpath will take the <code class="docutils literal"><span class="pre">firstname</span></code> attribute and map it to the <code class="docutils literal"><span class="pre">givenName</span></code> field on the Account resource.</p>
</div>
</div>
</div>
<div class="section" id="g-suite">
<span id="create-gsuite"></span><h2>G-Suite<a class="headerlink" href="#g-suite" title="Permalink to this headline">¶</a></h2>
<p>G-Suite is compatible with both Service Provider (SP)-initiated and Identity Provider (IdP)-initiated flows.</p>
<div class="contents local topic" id="id28">
<ul class="simple">
<li><a class="reference internal" href="#step-1-set-up-g-suite" id="id63">Step 1: Set-up G-Suite</a></li>
<li><a class="reference internal" href="#step-2-gather-the-google-idp-information" id="id64">Step 2: Gather the Google IdP Information</a></li>
<li><a class="reference internal" href="#id29" id="id65">Step 3: Create Your SAML Directory in Stormpath</a></li>
<li><a class="reference internal" href="#step-4-configure-your-service-provider-in-g-suite" id="id66">Step 4: Configure Your Service Provider in G-Suite</a></li>
<li><a class="reference internal" href="#id32" id="id67">Step 5: Configure Your Application in Stormpath</a></li>
<li><a class="reference internal" href="#id33" id="id68">Step 6: (Optional) Configure Your Attribute Mappings</a></li>
<li><a class="reference internal" href="#step-7-idp-initiated-flow-only-generate-a-relaystate" id="id69">Step 7: (IdP-initiated Flow Only) Generate a RelayState</a></li>
</ul>
</div>
<div class="section" id="step-1-set-up-g-suite">
<h3><a class="toc-backref" href="#id63">Step 1: Set-up G-Suite</a><a class="headerlink" href="#step-1-set-up-g-suite" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Log in to the Google Admin Console: <a class="reference external" href="https://admin.google.com">https://admin.google.com</a></li>
<li>Click on the <strong>Apps</strong> box and then click on <strong>SAML Apps</strong></li>
<li>Click the + button to add a new SAML Application</li>
<li>In the modal, click on <strong>Setup my Own Custom App</strong></li>
</ol>
</div>
<div class="section" id="step-2-gather-the-google-idp-information">
<h3><a class="toc-backref" href="#id64">Step 2: Gather the Google IdP Information</a><a class="headerlink" href="#step-2-gather-the-google-idp-information" title="Permalink to this headline">¶</a></h3>
<p>You will now need to gather the following pieces of information:</p>
<ul class="simple">
<li>SSO URL</li>
<li>Entity ID</li>
<li>Certificate</li>
</ul>
<p>Click on <strong>Download</strong> beside Certificate. This will download <code class="docutils literal"><span class="pre">GoogleIDPCertificate-DOMAIN.pem</span></code>, which you need to open in a text editor of your choice.</p>
<p>Open the <code class="docutils literal"><span class="pre">GoogleIDPCertificate-DOMAIN.pem</span></code> file in a text editor of your choice, and copy its contents. The file should look like this:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>-----BEGIN CERTIFICATE-----
MIIDaDCCAlCgAwIBAgIGAVQ0xF8mMA0GCSqGSIb3DQEBCwUAMHUxCzAJBgNVBAYTAlVTMQswCQYD
{More certificate content here}
8bMh4fe2s1wR6pDkVjgEwu0DW2zBcXSg9KuT3lcWEUIq3Bct7Cdng12C0zXbgnQJAFtzHYbXAwkG
sh3WzqLNeYeoU5sGPWhlvNR7n2R1
-----END CERTIFICATE-----
</pre></div>
</div>
</div>
<div class="section" id="id29">
<h3><a class="toc-backref" href="#id65">Step 3: Create Your SAML Directory in Stormpath</a><a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h3>
<p>You will now create your SAML Directory in Stormpath, using the values you gathered in the previous step. Then you will use information from this newly-created Directory to configure Stormpath as a Service Provider in the IdP in the next step.</p>
<div class="section" id="id30">
<h4>3.1. Create Your SAML Directory<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Log in to the Stormpath Admin Console: <a class="reference external" href="https://api.stormpath.com">https://api.stormpath.com</a></li>
<li>Click on the <strong>Directories</strong> tab.</li>
<li>Click on <strong>Create Directory</strong>.</li>
<li>From the &#8220;Directory Type&#8221; drop-down menu, select &#8220;SAML&#8221;, which will bring up a Directory creation dialog.</li>
<li>Next, enter in a name and (optionally) a description, then set the Directory&#8217;s status to &#8220;Enabled&#8221;.</li>
<li>For both the &#8220;SAML SSO Login Url&#8221; and &#8220;SAML SSO Logout Url&#8221; fields, you will enter in the &#8220;SSO URL&#8221; gathered in step 2.</li>
<li>For the &#8220;SAML X.509 Signing Cert&#8221; field, paste in the text content from the IdP certificate (the .pem file) you created in step 2.</li>
<li>Finally, select &#8220;RSA-SHA256&#8221; as the &#8220;SAML Request Signature Algorithm&#8221;.</li>
<li>Once all this information is entered, click on <strong>Create Directory</strong>. At this point, you will arrive back on the main Directories page.</li>
</ol>
</div>
<div class="section" id="id31">
<h4>3.2. Gather Your SAML Directory Information<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h4>
<p>Find and click on your new SAML Directory.</p>
<p>Click on the ‘Identity Provider’ tab. Copy the ‘Entity ID’ and the ‘Assertion Consumer Service URL’.</p>
<p>Under the &#8220;Identity Provider&#8221; tab, you will need to gather the follow information:</p>
<ul class="simple">
<li>The &#8220;Entity ID&#8221;</li>
<li>The &#8220;Assertion Consumer Service URL&#8221;</li>
</ul>
<p>We will now input these values into the Identity Provider.</p>
</div>
</div>
<div class="section" id="step-4-configure-your-service-provider-in-g-suite">
<h3><a class="toc-backref" href="#id66">Step 4: Configure Your Service Provider in G-Suite</a><a class="headerlink" href="#step-4-configure-your-service-provider-in-g-suite" title="Permalink to this headline">¶</a></h3>
<p>Back on your G-Suite SAML Application page (where you previously downloaded the certificate), you will now enter in your Stormpath Directory information:</p>
<ol class="arabic simple">
<li>The &#8220;(ACS) URL&#8221; is the Stormpath &#8220;Assertion Consumer Service URL&#8221; from the previous step.</li>
<li>The &#8220;Entity ID&#8221; is the &#8220;Entity ID&#8221; from the previous step.</li>
<li>Check the box that says &#8220;Signed Response&#8221;.</li>
<li>Set the &#8220;Name ID&#8221; fields to &#8220;Basic Information&#8221; and &#8220;Primary Email&#8221;</li>
<li>Set the &#8220;Name ID Format&#8221; to &#8220;Email&#8221;</li>
<li>Click <strong>Continue to Next Step</strong>, then click <strong>Save &amp; Publish</strong></li>
<li>On the G-Suite SAML Application you just created, turn the Application &#8220;ON&#8221;. You can either turn this Application on for everyone, or for users in your Organization only.</li>
</ol>
</div>
<div class="section" id="id32">
<h3><a class="toc-backref" href="#id67">Step 5: Configure Your Application in Stormpath</a><a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h3>
<p>We will now complete the final steps in the Stormpath Admin Console: adding one or more Callback URIs to the Application, and mapping your SAML Directory to your Application.</p>
<ol class="arabic simple">
<li>Switch back to the <a class="reference external" href="https://api.stormpath.com">Stormpath Admin Console</a> and go to the <strong>Applications</strong> tab.</li>
<li>Select the Application that will be using the SAML Directory.</li>
<li>On the main &#8220;Details&#8221; page, you will see &#8220;Authorized Callback URIs&#8221;. You should include here a list of the URLs that your users will be redirected to at the end of the SAML authentication flow. Note that the Authorized Callback URIs cannot exceed 4000 characters in total length.</li>
<li>Next click on <strong>Account Stores</strong> in the left-side navigation pane.</li>
<li>Once you are on your Application&#8217;s Account Stores page, click <strong>Add Account Store</strong>. This will bring up the &#8220;Map Account Store&#8221; dialog.</li>
<li>Ensure that you are in the &#8220;Directories&#8221; tab and select your Ping Identity Directory from the list.</li>
<li>Click <strong>Create Mappings</strong>.</li>
</ol>
<p>You have now completed the initial steps of configuring login via SAML for G-Suite!</p>
</div>
<div class="section" id="id33">
<h3><a class="toc-backref" href="#id68">Step 6: (Optional) Configure Your Attribute Mappings</a><a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h3>
<p>When a new Account logs in via SAML, Ping sends along a number of SAML attributes. These attributes are mapped to Stormpath <a class="reference external" href="https://docs.stormpath.com/rest/product-guide/latest/reference.html#account">Account attributes</a> (such as <code class="docutils literal"><span class="pre">givenName</span></code> or <code class="docutils literal"><span class="pre">email</span></code>) and these values are either stored, if the Account is new, or updated, if the Account exists but the values are different. In this step you will configure how these Ping SAML Attributes are mapped to Stormpath attributes.</p>
<div class="section" id="id34">
<h4>6.1. Find the Existing SAML Attributes<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h4>
<p>If you have already successfully set-up SAML and authenticated a user with your app, you will be able to retrieve the SAML Attributes that G-Suite sends by retrieving the new user Account that was created inside Stormpath.</p>
<p>Specifically, you want that Account&#8217;s <code class="docutils literal"><span class="pre">providerData</span></code> resource, which you can see by clicking on the &#8220;HREF&#8221; link on the Account&#8217;s main page, then following the <cite>providerData</cite> <cite>href</cite> :</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/4QwSP7tumdJJoCzPHiZ1Oq/providerData&quot;</span><span class="p">,</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2017-01-11T01:38:18.211Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2017-01-11T23:55:02.413Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;providerId&quot;</span><span class="p">:</span> <span class="s2">&quot;saml&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Everything here other than <code class="docutils literal"><span class="pre">href</span></code>, <code class="docutils literal"><span class="pre">createdAt</span></code> and <code class="docutils literal"><span class="pre">modifiedAt</span></code> are Attributes passed by G-Suite.</p>
<p>If you want, you can map other SAML Attributes to Stormpath Account attributes.</p>
</div>
<div class="section" id="id35">
<h4>6.2. Add Any Additional Attributes You Want<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h4>
<p>If there are other attributes that you would like G-Suite to pass, you can configure this.</p>
<ol class="arabic simple">
<li>Make sure you are on the G-Suite SAML Apps page.</li>
<li>Click on your application, and click on the &#8220;Attribute Mapping&#8221; box. This will expand the mapping details.</li>
<li>Click the <strong>Add New Mapping</strong> button.</li>
<li>You can type whatever string you&#8217;d like under &#8220;Application Attribute&#8221;. For example, &#8220;firstName&#8221;.</li>
<li>In the second box, you can click on the textbox to see a list of available values. For this example, you can select <strong>Basic Information</strong>.</li>
<li>Under &#8220;Select User Field&#8221;, click on the box to see a list of available values. For this example, you can select <strong>First Name</strong>.</li>
<li>Finally click on <strong>Save</strong>.</li>
</ol>
</div>
<div class="section" id="id36">
<h4>6.3. Specify Your Mapping<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Go to your <a class="reference external" href="https://api.stormpath.com/">Stormpath Admin Console</a></li>
<li>Click on the <strong>Directories</strong> tab</li>
<li>Select your G-Suite SAML Directory</li>
<li>Under the &#8220;SAML Attribute Statement Mapping Rules&#8221; section you will see three fields: &#8220;Name&#8221;, &#8220;Name Format&#8221;, and &#8220;Stormpath Attributes&#8221;</li>
<li>Here you will enter the G-Suite attribute name under &#8220;Name&#8221;</li>
<li>Finally, enter the Account attribute(s) that you would like this G-Suite attribute to map to</li>
</ol>
<p>For example, you could enter, using the custom attribute from the example above:</p>
<ul class="simple">
<li>For the &#8220;Name&#8221; enter <code class="docutils literal"><span class="pre">firstname</span></code></li>
<li>For &#8220;Stormpath Attributes&#8221; enter <code class="docutils literal"><span class="pre">givenName</span></code></li>
</ul>
<p>If a user now logs in, Stormpath will take the <code class="docutils literal"><span class="pre">firstname</span></code> attribute and map it to the <code class="docutils literal"><span class="pre">givenName</span></code> field on the Account resource.</p>
</div>
</div>
<div class="section" id="step-7-idp-initiated-flow-only-generate-a-relaystate">
<h3><a class="toc-backref" href="#id69">Step 7: (IdP-initiated Flow Only) Generate a RelayState</a><a class="headerlink" href="#step-7-idp-initiated-flow-only-generate-a-relaystate" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>After going through the SP-initiated instructions above, navigate back to your Stormpath G-Suite SAML Directory in the Admin Console. Click on <strong>Generate Default Relay State</strong>.</li>
<li>In this box, you&#8217;ll need to select the Application your Directory is mapped to, and select your API key. The API key you select should be the same API key you used to connect to Stormpath when you started your Application. You&#8217;ll also need to add the same callback URI you added to your Application. Copy the generated default relay state and close out of the box.</li>
<li>Navigate back to your G-Suite SAML Application and click on &#8220;Service Provider Details&#8221;. Under &#8220;Start URL&#8221;, paste in the default relay state.</li>
</ol>
</div>
</div>
<div class="section" id="active-directory-federation-services">
<span id="create-adfs"></span><h2>Active Directory Federation Services<a class="headerlink" href="#active-directory-federation-services" title="Permalink to this headline">¶</a></h2>
<p>Stormpath&#8217;s allows you to link your Active Directory to Stormpath via SAML and Active Directory Federation Services (ADFS). In order to link the two, you must configure your ADFS server with information about your Stormpath Directory, and vice versa. This will then allow users to log in to your application by authenticating with the ADFS server, and have their Active Directory user information mirrored into Stormpath. Both SP-initiated and IDP-initiated workflows are available.</p>
<p>These instructions assume that you have an instance of Windows Server 2012 R2 running ADFS 2.0 or 3.0, fully configured and with existing users.</p>
<div class="section" id="step-1-download-your-signing-certificate">
<h3>Step 1: Download Your Signing Certificate<a class="headerlink" href="#step-1-download-your-signing-certificate" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Go to Windows Server&#8217;s Administrative Tools, and then to &#8220;AD FS Management&#8221;.</li>
<li>Expand <strong>Services</strong>, then click on <strong>Certificates</strong> &gt; <strong>Token-Signing Certificate</strong> &gt; <strong>View Certificate</strong>.</li>
<li>Click <strong>Details</strong> and then <strong>Copy to File</strong> &gt; <strong>Next</strong> &gt; Select <strong>Base-64 encoded X.509 (.CER)</strong> and save the file somewhere.</li>
<li>Open this file in your text editor of choice. The contents will be an x509 certificate starting with the line <code class="docutils literal"><span class="pre">-----BEGIN</span> <span class="pre">CERTIFICATE-----</span></code> and ending with <code class="docutils literal"><span class="pre">-----END</span> <span class="pre">CERTIFICATE-----</span></code>. The contents of this file are your “SAML X.509 Signing Cert”.</li>
</ol>
</div>
<div class="section" id="step-2-create-your-adfs-directory-in-stormpath">
<h3>Step 2: Create your ADFS Directory in Stormpath<a class="headerlink" href="#step-2-create-your-adfs-directory-in-stormpath" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>First you must create a Directory in Stormpath that will mirror your ADFS users.</div></blockquote>
<ol class="arabic simple">
<li>Log in to the Stormpath Admin Console: <a class="reference external" href="https://api.stormpath.com">https://api.stormpath.com</a></li>
<li>Click on the <strong>Directories</strong> tab.</li>
<li>Click on <strong>Create Directory</strong>.</li>
<li>From the &#8220;Directory Type&#8221; drop-down menu, select &#8220;SAML&#8221;, which will bring up a Directory creation dialog.</li>
<li>Next, enter in a name and (optionally) a description, then set the Directory&#8217;s status.</li>
<li>For &#8220;SAML SSO Login Url&#8221; enter in: <code class="docutils literal"><span class="pre">https://{HOST}:{PORT}/adfs/ls/idpinitiatedsignon.aspx</span></code>.</li>
<li>For &#8220;SAML SSO Logout Url&#8221; enter in: <code class="docutils literal"><span class="pre">https://{HOST}:{PORT}/adfs/ls/idpinitiatedsignout.aspx</span></code></li>
<li>For the &#8220;SAML X.509 Signing Cert&#8221; field, paste in the text content from the signing certificate you downloaded in Step 1.</li>
<li>Finally, select &#8220;RSA-SHA256&#8221; as the &#8220;SAML Request Signature Algorithm&#8221;.</li>
<li>Once all this information is entered, click on <strong>Create Directory</strong>. At this point, you will arrive back on the main Directories page.</li>
<li>Find and click on your Directory to enter its information page.</li>
<li>On this page, in the &#8220;SAML Configuration&#8221; section, click on the <strong>Identity Provider</strong> tab. you will be returning here in the next step.</li>
</ol>
</div>
<div class="section" id="step-3-configure-your-relying-party-trust-in-adfs">
<h3>Step 3: Configure Your Relying Party Trust in ADFS<a class="headerlink" href="#step-3-configure-your-relying-party-trust-in-adfs" title="Permalink to this headline">¶</a></h3>
<p>Now you will enter the information from the Stormpath Directory that you just created into ADFS.</p>
<div class="section" id="add-a-relying-party-trust">
<h4>3.1. Add a Relying Party Trust<a class="headerlink" href="#add-a-relying-party-trust" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Back in Windows&#8217; Administrative Tools, click on <strong>AD FS Management</strong>.</li>
<li><strong>Expand</strong> &#8220;Trust Relationships&#8221;, then click on <strong>Relying Party Trusts</strong> and in the right-hand navigation panel click on <strong>Add Relying Part Trust...</strong>. This will open the &#8220;Add Relying Party Trust Wizard&#8221;.</li>
<li>Click <strong>Start</strong> and make sure that &#8220;Import data about the relying party published online&#8221; is selected.</li>
<li>Back in the Stormpath Admin Console, in your Directory&#8217;s &#8220;Identity Provider&#8221; information, you will see a &#8220;Service Provider Metadata Link&#8221;. Copy this URL into the AD FS Management &#8220;Federation metadata address&#8221; text box and click <strong>Next</strong>. Keep your Admin Console tab open, you will be returning to it later.</li>
<li>Enter in whatever &#8220;Display name&#8221; that you wish, as well as any description. For this example we will name this &#8220;api.stormpath.com&#8221;.</li>
<li>Make sure &#8220;I do not want to configure multi-factor authentication settings...&#8221; is selected and click <strong>Next</strong>.</li>
<li>Keep &#8220;Permit All&#8221; selected and click <strong>Next</strong>.</li>
<li>Review the settings if so desired and click <strong>Next</strong>.</li>
<li>Keep the &#8220;Open the Edit Claim Rules...&#8221; option selected and click &#8220;Close&#8221;.</li>
</ol>
</div>
<div class="section" id="add-a-claim-rule">
<h4>3.2. Add a Claim Rule<a class="headerlink" href="#add-a-claim-rule" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>In the &#8220;Edit Claim Rules&#8221; window, click <strong>Add Rule</strong> again.</li>
<li>Select &#8220;Transform an Incoming Claim&#8221; as your Rule Template. Then fill out the following information:</li>
</ol>
<ul class="simple">
<li>Put &#8220;Add UPN as Name ID&#8221; into the &#8220;Claim rule name:&#8221; text box.</li>
<li>For &#8220;Incoming claim type&#8221; select &#8220;UPN&#8221;.</li>
<li>For &#8220;Outgoing claim type&#8221; select &#8220;Name ID&#8221;.</li>
<li>For &#8220;Outgoing name ID format&#8221; select &#8220;Email&#8221;.</li>
<li>Keep &#8220;Pass through all claim values&#8221; selected.</li>
<li>Click <strong>Finish</strong>.</li>
<li>Back in the &#8220;Edit Claim Rules&#8221; window, click <strong>OK</strong>.</li>
</ul>
</div>
<div class="section" id="finish-configuring-the-relying-third-party">
<h4>3.4. Finish Configuring the Relying Third Party<a class="headerlink" href="#finish-configuring-the-relying-third-party" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>In the main AD FS window, with &#8220;api.stormpath.com&#8221; selected under &#8220;Relying Party Trusts&#8221;, click <strong>Properties</strong> on the right-hand side. This will open a &#8220;Properties&#8221; window and the &#8220;Monitoring&#8221; tab.</li>
<li>In the &#8220;Monitoring&#8221; tab, uncheck &#8220;Automatically update relying party&#8221; and click <strong>Apply</strong>.</li>
<li>Switch to the &#8220;Identifiers&#8221; tab, and copy your Stormpath Directory&#8217;s HREF into the &#8220;Relying party identifier&#8221; text box, then click <strong>Add</strong>. Next click <strong>OK</strong>.</li>
<li>Finally, go to Windows and open a Powershell window. In Powershell, enter the following command: &#8220;Set-AdfsRelyingPartyTrust -TargetName api.stormpath.com -SigningCertificateRevocationCheck None&#8221;.</li>
</ol>
</div>
</div>
<div class="section" id="id37">
<h3>Step 4: Configure Your Application in Stormpath<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Switch back to the <a class="reference external" href="https://api.stormpath.com">Stormpath Admin Console</a> and go to the <strong>Applications</strong> tab.</li>
<li>Select the Application that will be using the ADFS Directory.</li>
<li>On the main &#8220;Details&#8221; page, you will see &#8220;Authorized Callback URIs&#8221;. You should include here a list of the URLs that your users will be redirected to at the end of the SAML authentication flow.</li>
<li>Next click on <strong>Account Stores</strong> in the navigation pane.</li>
<li>Once you are on your Application&#8217;s Account Stores page, click &#8220;Add Account Store&#8221;. This will bring up the &#8220;Map Account Store&#8221; dialog.</li>
<li>Ensure that you are in the &#8220;Directories&#8221; tab and select your SAML Directory from the list.</li>
<li>Click <strong>Create Mappings</strong>.</li>
</ol>
</div>
<div class="section" id="id38">
<h3>Step 5: (Optional) Configure Your Attribute Mappings<a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h3>
<p>By default, the only user information that is passed by ADFS is the User Principal Name (UPN). Stormpath will use this to populate the user Account&#8217;s <code class="docutils literal"><span class="pre">username</span></code> and <code class="docutils literal"><span class="pre">email</span></code> attributes. Other attributes, like <code class="docutils literal"><span class="pre">surname</span></code> will appear as <code class="docutils literal"><span class="pre">NOT_PROVIDED</span></code>. If you would like other Active Directory attributes to be passed to Stormpath and mapped to Account attributes, you can configure this now.</p>
<div class="section" id="add-the-claim-rule">
<h4>5.1. Add the Claim Rule<a class="headerlink" href="#add-the-claim-rule" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Go to Administrative Tools and &#8220;AD FS Management&#8221;, and on the left-hand side expand <strong>Trust Relationships</strong>. Select the &#8220;Relying Party Trust&#8221; for Stormpath, and then in the right-hand panel click on &#8220;Edit Claim Rules...&#8221;.</li>
<li>In the &#8220;Edit Claim Rules&#8221; window, click on <strong>Add Rule</strong>.</li>
<li>For the &#8220;Claim rule template&#8221; make sure that &#8220;Send LDAP Attributes as Claims&#8221; is selected and click <strong>Next</strong>.</li>
<li>Enter a &#8220;Claim Rule Name&#8221; and for Attribute Store select &#8220;Active Directory&#8221;.</li>
<li>Then specify whatever mapping you might want. Make sure that the &#8220;LDAP Attribute&#8221; matches whatever is in your Active Directory. From Stormpath&#8217;s perspective the &#8220;Outgoing Claim Type&#8221; can have any value, since you will be specifying how this Outgoing Claim should be interpreted by Stormpath. For example, you could specify that the LDAP Attribute &#8220;Given-Name&#8221; maps to an Outgoing Claim Type &#8220;firstName&#8221;.</li>
</ol>
</div>
<div class="section" id="create-the-attribute-mapping">
<h4>5.2. Create the Attribute Mapping<a class="headerlink" href="#create-the-attribute-mapping" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Back in the Stormpath Admin Console, on your ADFS Directory page, find the &#8220;SAML Configuration&#8221; section, and go to the &#8220;Attribute Mappings&#8221; tab.</li>
<li>Here you can specify which of the ADFS Claims you would like to map to which Stormpath Account attribute. For example, if you mapped the LDAP Attribute <code class="docutils literal"><span class="pre">Given-Name</span></code> to the ADFS Claim <code class="docutils literal"><span class="pre">firstName</span></code>, then you would put the &#8220;Attribute Name&#8221; as <code class="docutils literal"><span class="pre">firstName</span></code> and the &#8220;Stormpath Field Name&#8221; as <code class="docutils literal"><span class="pre">givenName</span></code>.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>There are two mappings here: LDAP to ADFS, then ADFS to Stormpath.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>LDAP Attribute --&gt; ADFS Claim --&gt; Stormpath Account Attribute
      |                 |                     |
  Given-Name   --&gt; firstName  --&gt;        givenName
</pre></div>
</div>
<p class="last">Since the ADFS Claim is what is being received by Stormpath, the Admin Console only needs to know the mapping between the ADFS Claim and the Account Attribute.</p>
</div>
</div>
<div class="section" id="step-6-idp-initiated-flow-only-generate-a-relaystate">
<h4>Step 6: (IdP-initiated Flow Only) Generate a RelayState<a class="headerlink" href="#step-6-idp-initiated-flow-only-generate-a-relaystate" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>After going through the SP-initiated instructions above, navigate back to your SAML Directory in the Admin Console. Under the Identity Provider&#8221; tab, copy the &#8220;Assertion Consumer Service URL&#8221;. We will be using this later.</li>
<li>Click on the &#8220;Generate Default Relay State&#8221; button. In this box, you&#8217;ll need to select the Application your Directory is mapped to, and select your API key. The API key you select should be the same API key you used to connect to Stormpath when you started your Application. You&#8217;ll also need to add the same callback URI you added to your Application. Copy the generated default relay state and close out of the box.</li>
<li>In ADFS, navigate back to ADFS Management and expand &#8220;Trust Relationships&#8221;. Click on &#8220;Relying Party Trusts&#8221;. Double click to open the Relying Party you created earlier. On the &#8220;Endpoints&#8221; tab, double click to edit the SAML Assertion Consumer Endpoint. Double check that the endpoint type is &#8220;SAML Assertion Consumer&#8221; and that the binding is &#8220;POST&#8221;. Click the checkbox next to &#8220;Set the trusted URL as default&#8221;. In the trusted url textbox, add the Assertion Consumer Service URL that you saved earlier. Next, add the default relay state you generated as a url parameter. The resulting string should look like this:</li>
</ol>
<p><code class="docutils literal"><span class="pre">https://stormpath-environment.com/v1/directories/$DIRECTORY_ID/saml/sso/post?RelayState=$DEFAULT_RELAY_STATE</span></code></p>
<ol class="arabic simple">
<li>Click &#8220;OK&#8221; to save the endpoint.</li>
<li>Next, click on the &#8220;Add SAML&#8221; button. Make sure the endpoint type is &#8220;SAML Assertion Consumer&#8221; and that the binding is &#8220;POST&#8221;. Set the Index to 1. In the &#8220;Trusted URL&#8221; text box, add the Assertion Consumer Server URL. That string look like this:</li>
</ol>
<p><code class="docutils literal"><span class="pre">https://stormpath-environment.com/v1/directories/$DIRECTORY_ID/saml/sso/post</span></code></p>
<ol class="arabic simple">
<li>Click &#8220;OK&#8221; to save the endpoint, and then click &#8220;Apply&#8221; to save all changes.</li>
<li>Lastly, restart the ADFSSRV service. You can do so by opening the &#8220;Server Manage&#8221;, clicking on the &#8220;ADFS&#8221; tab, scrolling down to &#8220;Services&#8221;, and right clicking on the service whose service name is &#8220;ADFSSRV&#8221;. From this list, you should click on &#8220;Restart Services&#8221;.</li>
</ol>
</div>
</div>
</div>
<div class="section" id="azure-active-directory">
<span id="create-azure"></span><h2>Azure Active Directory<a class="headerlink" href="#azure-active-directory" title="Permalink to this headline">¶</a></h2>
<p>Stormpath&#8217;s also supports linking your Azure Active Directory (AD) to Stormpath via SAML. In order to link the two, you must configure your Azure AD server with information about your Stormpath Directory, and vice versa. This will then allow users to log in to your application by authenticating with Azure server, and have their Active Directory user information mirrored into Stormpath.</p>
<p>These instructions assume that you have an instance of Windows Azure Active Directory, fully configured and with existing users as well as a Stormpath account with at least an Advanced tier.</p>
<div class="section" id="step-1-add-your-application-in-azure">
<h3>Step 1: Add Your Application in Azure<a class="headerlink" href="#step-1-add-your-application-in-azure" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Log in to Azure and select your AD directory.</li>
<li>Select the <strong>Application</strong> sub-heading and then click <strong>Add</strong> at the bottom of the page.</li>
<li>Click <strong>Add an application my organization is developing</strong></li>
<li>Name your application and click the right <strong>arrow</strong>.</li>
<li>Add two temporary URLs. They can be any valid URL, since you will be changing them later. Then click the <strong>checkmark</strong>.</li>
<li>You will now arrive at your application/s main page.</li>
</ol>
</div>
<div class="section" id="step-2-create-your-azure-directory-in-stormpath">
<h3>Step 2: Create your Azure Directory in Stormpath<a class="headerlink" href="#step-2-create-your-azure-directory-in-stormpath" title="Permalink to this headline">¶</a></h3>
<p>Next you must create a Directory in Stormpath that will mirror your ADFS users. Keep your Azure window open, since you will be copying information back and forth between Azure and Stormpath.</p>
<div class="section" id="add-the-sso-login-logout-urls">
<h4>2.1 Add the SSO Login/Logout URLs<a class="headerlink" href="#add-the-sso-login-logout-urls" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Log in to the Stormpath Admin Console: <a class="reference external" href="https://api.stormpath.com">https://api.stormpath.com</a></li>
<li>Click on the <strong>Directories</strong> tab.</li>
<li>Click on <strong>Create Directory</strong>.</li>
<li>From the &#8220;Directory Type&#8221; drop-down menu, select &#8220;SAML&#8221;, which will bring up a Directory creation dialog.</li>
<li>Next, enter in a name and (optionally) a description, then set the Directory&#8217;s status.</li>
<li>Switch to your Azure application and click on <strong>View Endpoints</strong> in the bottom navigation bar. This will bring up an &#8220;App Endpoints&#8221; dialog.</li>
<li>Your Azure &#8220;SAML-P Sign-on Endpoint&#8221; needs to be copied into your Stormpath Directory&#8217;s &#8220;SAML SSO Login Url&#8221; field.</li>
<li>Similarly, the &#8220;SAML-P Sign-out Endpoint&#8221; goes into your Stormpath Directory&#8217;s &#8220;SAML SSO Logout Url&#8221;.</li>
</ol>
</div>
<div class="section" id="add-the-x509-certificate">
<h4>2.2 Add the x509 Certificate<a class="headerlink" href="#add-the-x509-certificate" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Take the URL in your Azure app&#8217;s &#8220;Federate Metadata Document&#8221; and paste it into a new window.</li>
<li>Find the <code class="docutils literal"><span class="pre">IDPSSODescriptor</span></code> tag. Inside this tag there are multiple <code class="docutils literal"><span class="pre">&lt;X509Certificate&gt;</span></code> tags.</li>
<li>Take the first <code class="docutils literal"><span class="pre">&lt;X509Certificate&gt;</span></code> and copy it into your text editor of choice.</li>
<li>Add <code class="docutils literal"><span class="pre">-----BEGIN</span> <span class="pre">CERTIFICATE-----</span></code> as the first line and <code class="docutils literal"><span class="pre">-----END</span> <span class="pre">CERTIFICATE-----</span></code> as the last line.</li>
<li>Now take the entire contents inside your text editor and paste them into your Stormpath Directory&#8217;s &#8220;SAML X.509 Signing Cert&#8221; field.</li>
<li>Finally, make sure that &#8220;RSA-SHA256&#8221; is selected as the &#8220;SAML Request Signature Algorithm&#8221;.</li>
<li>Once all this information is entered, click on <strong>Create Directory</strong>. At this point, you will arrive back on the main Directories page.</li>
<li>Find and click on your Directory to enter its information page.</li>
<li>On this page, in the &#8220;SAML Configuration&#8221; section, click on the <strong>Identity Provider</strong> tab. you will be returning here in the next step.</li>
</ol>
</div>
</div>
<div class="section" id="step-3-configure-sso-in-azure">
<h3>Step 3: Configure SSO in Azure<a class="headerlink" href="#step-3-configure-sso-in-azure" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Back in Azure, click on <strong>Configure</strong> under your application&#8217;s name.</li>
<li>Find the &#8220;Single Sign-on&#8221; section. you will be copying various fields from your Stormpath Directory page into these fields.</li>
<li>Set &#8220;App ID URI&#8221; as your Stormpath Directory&#8217;s HREF.</li>
<li>Set &#8220;Reply URL&#8221; as your Stormpath Directory&#8217;s &#8220;Assertion Consumer Service URL&#8221;.</li>
<li>In the bottom of your Azure application&#8217;s navigation pane, click on <strong>Save</strong>.</li>
</ol>
</div>
<div class="section" id="id39">
<h3>Step 4: Configure Your Application in Stormpath<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Switch back to the <a class="reference external" href="https://api.stormpath.com">Stormpath Admin Console</a> and go to the <strong>Applications</strong> tab.</li>
<li>Select the Application that will be using the Azure Directory.</li>
<li>On the main &#8220;Details&#8221; page, you will see &#8220;Authorized Callback URIs&#8221;. You should include here a list of the URLs that your users will be redirected to at the end of the SAML authentication flow.</li>
<li>Next click on <strong>Account Stores</strong> in the navigation pane.</li>
<li>Once you are on your Application&#8217;s Account Stores page, click &#8220;Add Account Store&#8221;. This will bring up the &#8220;Map Account Store&#8221; dialog.</li>
<li>Ensure that you are in the &#8220;Directories&#8221; tab and select your Azure Directory from the list.</li>
<li>Click <strong>Create Mappings</strong>.</li>
</ol>
<p>You should now be able to log-in to your Stormpath-powered application with Azure Active Directory!</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="idsite.html" class="btn btn-neutral" title="ID Site" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Stormpath.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/scrollspy.js"></script>
      <script type="text/javascript" src="_static/gumshoe.min.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  

<!-- Google Tag Manager -->
<noscript><iframe src=".//www.googletagmanager.com/ns.html?id=GTM-NQZZFW"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<script>
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NQZZFW');
</script>
<!-- End Google Tag Manager -->



  

</body>
</html>