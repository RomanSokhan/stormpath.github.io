<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Stormpath  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <!-- Google Tag Manager -->
    <noscript><iframe src=".//www.googletagmanager.com/ns.html?id=GTM-NQZZFW"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NQZZFW');</script>
    <!-- End Google Tag Manager -->
    <a title="Stormpath  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">Stormpath Docs</a> (98% documented)</p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">Stormpath Reference</a>
        <img id="carat" src="img/carat.png" />
        Stormpath  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/Account.html">Account</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/RegistrationForm.html">RegistrationForm</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Stormpath.html">Stormpath</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/StormpathConfiguration.html">StormpathConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/StormpathError.html">StormpathError</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enums</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/AccountStatus.html">AccountStatus</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/Provider.html">Provider</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/JSON.html">JSON</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Typealiases.html">Typealiases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:9Stormpath24StormpathAccountCallback">StormpathAccountCallback</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:9Stormpath24StormpathSuccessCallback">StormpathSuccessCallback</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <a href='#stormpath-ios-sdk' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='stormpath-ios-sdk'>Stormpath iOS SDK</h1>

<p><a href="http://cocoapods.org/pods/Stormpath"><img src="https://img.shields.io/cocoapods/v/Stormpath.svg?style=flat" alt="CocoaPods Compatible"></a>
<a href="https://github.com/stormpath/stormpath-sdk-ios"><img src="https://img.shields.io/badge/Carthage-compatible-4BC51D.svg?style=flat" alt="Carthage compatible"></a>
<a href="http://cocoapods.org/pods/Stormpath"><img src="https://img.shields.io/cocoapods/l/Stormpath.svg?style=flat" alt="License"></a>
<a href="https://codebeat.co/projects/github-com-stormpath-stormpath-sdk-ios"><img src="https://codebeat.co/badges/6b76c7c6-f924-40f6-8ce0-42d165cf6a17" alt="codebeat badge"></a>
<a href="https://talkstormpath.shipit.xyz"><img src="https://talkstormpath.shipit.xyz/badge.svg" alt="Slack Status"></a></p>

<p>The iOS SDK for <a href="https://stormpath.com/">Stormpath</a>, a framework for authentication &amp; authorization. </p>
<a href='#requirements' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='requirements'>Requirements</h1>

<p>iOS 8.0+ / Xcode 8.0+ (Swift 3)</p>
<a href='#set-up' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='set-up'>Set up</h1>

<p>Stormpath&rsquo;s iOS SDK allows developers utilizing Stormpath to quickly integrate authentication and token management into their apps. </p>

<p>We&rsquo;re constantly iterating and improving the SDK, so please don&rsquo;t hesitate to send us your feedback! You can reach us via <a href="mailto:support@stormpath.com">support@stormpath.com</a>, or on the issue tracker for feature requests. </p>
<a href='#installation' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='installation'>Installation</h1>
<a href='#cocoapods' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='cocoapods'>CocoaPods</h2>

<p>Stormpath is available through <a href="https://cocoapods.org/">CocoaPods</a>. Add this line to your <code>Podfile</code> to begin:</p>
<pre class="highlight ruby"><code><span class="n">pod</span> <span class="s1">'Stormpath'</span><span class="p">,</span> <span class="s1">'~&gt; 3.0'</span>
</code></pre>
<a href='#carthage' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='carthage'>Carthage</h2>

<p>To use Stormpath with <a href="https://github.com/Carthage/Carthage">Carthage</a>, specify it in your <code>Cartfile</code>:</p>
<pre class="highlight plaintext"><code>github "stormpath/stormpath-sdk-ios" ~&gt; 3.0
</code></pre>
<a href='#usage' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='usage'>Usage</h1>

<p>To see the SDK in action, you can try downloading the <a href="https://github.com/stormpath/stormpath-ios-example">Stormpath iOS Example</a> project. We&rsquo;ve built the same app twice, once in Objective-C and another time in Swift so you can see how to use the SDK. </p>
<a href='#importing-the-framework' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='importing-the-framework'>Importing the framework</h2>

<p>For Swift projects:</p>
<pre class="highlight plaintext"><code>import Stormpath
</code></pre>

<p>For Objective-C projects: </p>
<pre class="highlight plaintext"><code>#import "Stormpath-Swift.h"
</code></pre>
<a href='#configuring-stormpath' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='configuring-stormpath'>Configuring Stormpath</h2>

<p>The iOS SDK (v3) leverages the <a href="https://docs.stormpath.com/client-api/product-guide/latest/index.html">Stormpath Client API</a> for its authentication needs. You&rsquo;ll need to sign into the <a href="https://api.stormpath.com/">Stormpath Admin Console</a> to get your Client API details. Go into your Application &gt; Policies &gt; Client API, and ensure that it&rsquo;s enabled. Copy your Client API URL, and set it in your Xcode project: </p>

<p>Swift:</p>
<pre class="highlight plaintext"><code>Stormpath.sharedSession.configuration.APIURL = URL(string: "https://edjiang.apps.stormpath.io")!
</code></pre>

<p>Objective-C:</p>
<pre class="highlight plaintext"><code>[[SPHStormpath sharedSession] configuration].APIURL = [[NSURL alloc] initWithString:@"https://edjiang.apps.stormpath.io"];
</code></pre>
<a href='#user-registration' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='user-registration'>User registration</h2>

<p>In order to register a user, instantiate a <code>RegistrationForm</code> object. Stormpath requires an <code>email</code> and <code>password</code> to register.</p>
<pre class="highlight plaintext"><code>let newUser = RegistrationForm(email: "user@example.com", password: "ExamplePassword")
</code></pre>

<p>Then, just invoke the register method on <code>Stormpath</code> class:</p>
<pre class="highlight plaintext"><code>Stormpath.sharedSession.register(account: newUser) { (account, error) -&gt; Void in
    guard let account = account where error == nil else {
        //The account registration failed
        return
    }
    // Do something with the returned account object, such as save its `href` if needed. 
    // Registering a user will not automatically log them in. 
}
</code></pre>

<p><em>Note: Stormpath callbacks always happen on the main thread, so you can make UI changes directly in the callback.</em></p>
<a href='#logging-in' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='logging-in'>Logging in</h2>

<p>To log in, collect the email (or username) and password from the user, and then pass them to the login method:</p>
<pre class="highlight plaintext"><code>Stormpath.sharedSession.login(username: "user@example.com", password: "ExamplePassword") { success, error in
    guard error == nil else {
        // We could not authenticate the user with the given credentials. Handle the error. 
        return
    }
    // The user is now logged in, and you can use the Stormpath access token to make API requests!
}
</code></pre>
<a href='#logging-in-with-social-providers' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='logging-in-with-social-providers'>Logging in with Social Providers</h2>

<p>Stormpath also supports logging in with a variety of social providers Facebook, Google, LinkedIn, GitHub, and more. There are two flows for enabling this:</p>

<ol>
<li>Let Stormpath handle the social login.</li>
<li>Use the social provider&rsquo;s iOS SDK to get an access token, and pass it to Stormpath to log in.</li>
</ol>

<p>We&rsquo;ve made it extremely easy to set up social login without using the social provider SDKs, but if you need to use their SDKs for more features besides logging in, you should use flow #2 (and skip directly to <a href="#using-a-social-provider-sdk">Using a social provider SDK</a>). </p>
<a href='#configure-your-social-directory-in-stormpath' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='configure-your-social-directory-in-stormpath'>Configure Your Social Directory in Stormpath</h3>

<p>To set up your social directory, read more about <a href="https://docs.stormpath.com/client-api/product-guide/latest/social_login.html#before-you-start">social login in the Stormpath Client API Guide</a>.</p>
<a href='#setting-up-your-xcode-project' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='setting-up-your-xcode-project'>Setting up your Xcode project</h3>

<p>In your Xcode project, you&rsquo;ll need to create a URL Scheme so that the login process can call back to your app. Go to the project&rsquo;s info tab. Under <q>URL Types</q>, add a new entry, and in the URL schemes form field, type in your Client API&rsquo;s DNS label, but reversed. For instance, if your Client API DNS Label is <code>edjiang.apps.stormpath.io</code>, type in <code>io.stormpath.apps.edjiang</code>. </p>

<p>In the <a href="https://api.stormpath.com">Stormpath Admin Console</a>&rsquo;s Application settings, add that URL as an <q>authorized callback URL</q>, appending <code>://stormpathCallback</code>. Following my earlier example, I would use <code>io.stormpath.apps.edjiang</code>. </p>

<p>Also, add the following methods to your <code>AppDelegate</code> in your Xcode project:</p>
<pre class="highlight plaintext"><code>// iOS 9+ link handler
func application(_ app: UIApplication, open url: URL, options: [UIApplicationOpenURLOptionsKey: Any]) -&gt; Bool {
    return Stormpath.sharedSession.application(app, open: url, options: options)
}

// iOS 8 and below link handler. Needed if you want to support older iOS
func application(_ application: UIApplication, open url: URL, sourceApplication: String?, annotation: Any) -&gt; Bool {
    return Stormpath.sharedSession.application(application, open: url, sourceApplication: sourceApplication, annotation: annotation)
}
</code></pre>
<a href='#initiating-social-login' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='initiating-social-login'>Initiating Social Login</h3>

<p>Now, you can initiate the login screen by calling: </p>
<pre class="highlight plaintext"><code>Stormpath.sharedSession.login(provider: .facebook) { (success, error) -&gt; Void in
    // This callback is the same as the regular Stormpath.login callback. 
    // If the user cancels the login, the login was never started, and
    // this callback will not be called.
}
</code></pre>
<a href='#using-a-social-provider-sdk' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='using-a-social-provider-sdk'>Using a Social Provider SDK</h3>

<p>If you&rsquo;re using the <a href="https://developers.facebook.com/docs/facebook-login/ios">Facebook SDK</a> or <a href="https://developers.google.com/identity/sign-in/ios/">Google SDK</a> for your app, follow their setup instructions instead. Once you successfully sign in with their SDK, utilize the following methods to send your access token to Stormpath, and log in your user: </p>
<pre class="highlight plaintext"><code>Stormpath.sharedSession.login(provider: .facebook, accessToken: FBSDKAccessToken.currentAccessToken().tokenString) { (success, error) -&gt; Void in
    // Same callback as above
}

Stormpath.sharedSession.login(provider: .google, accessToken: GIDSignIn.sharedInstance().currentUser.authentication.accessToken) { (success, error) -&gt; Void in
    // Same callback as above
}
</code></pre>
<a href='#using-the-access-token' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='using-the-access-token'>Using the Access Token</h2>

<p>You can utilize the access token to access any of your API endpoints that require authentication. It&rsquo;s stored as a property on the Stormpath object as <code>Stormpath.sharedSession.accessToken</code>. If you need to refresh it, use <code>Stormpath.sharedSession.refreshAccessToken()</code>. Depending on the networking library you&rsquo;re using, here&rsquo;s how you&rsquo;d use the access token:</p>
<a href='#nsurlsession' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='nsurlsession'>NSURLSession</h3>
<pre class="highlight plaintext"><code>var request = URLRequest(URL: url)
request.setValue("Bearer " + accessToken ?? "", forHTTPHeaderField: "Authorization")
</code></pre>
<a href='#alamofire' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='alamofire'>Alamofire</h3>
<pre class="highlight plaintext"><code>let headers = ["Authorization": "Bearer " + accessToken ?? ""]
Alamofire.request(url, method: .get, headers: headers)
</code></pre>

<p><em>Note: As of the iOS 9 SDK, Apple has enabled App Transport Security by default. If you&rsquo;re developing against an <code>http</code> endpoint, you&rsquo;ll need to disable it. For production, you should always be using <code>https</code> for your API endpoints.</em></p>
<a href='#account-data' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='account-data'>Account data</h2>

<p>Stormpath&rsquo;s framework integrations provide a default endpoint for retrieving profile information. Fetch the account data by using me:</p>
<pre class="highlight plaintext"><code>Stormpath.sharedSession.me { account, error in
    guard let account = account where error == nil else {
        // We might not be logged in, the API is misconfigured, the API is down, etc
        return
    }
    // Success! We have the account object.
}
</code></pre>
<a href='#logout' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='logout'>Logout</h2>

<p>Logging out is simple. This will delete the access token and refresh token from the user&rsquo;s device, and make an API request to delete from the server. </p>
<pre class="highlight plaintext"><code>Stormpath.sharedSession.logout()
</code></pre>
<a href='#password-reset' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='password-reset'>Password reset</h2>

<p>To reset a user&rsquo;s password, you&rsquo;ll need to collect their email first. Then simply pass that email to the <code>resetPassword</code> function like so:</p>
<pre class="highlight plaintext"><code>Stormpath.sharedSession.resetPassword(email: "user@example.com") { success, error in
    guard error == nil else {
        // A network or API problem occurred. 
        return
    }
    // We succeeded in making the API request. 
}
</code></pre>
<a href='#error-handling' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='error-handling'>Error handling</h2>

<p>When using Stormpath, you can encounter errors for several reasons: </p>

<ol>
<li>Network errors - the network request failed for some reason.</li>
<li>User errors - errors because of user input, ex: <q>invalid username or password</q>.</li>
<li>API errors - the API is misconfigured, or returning an unrecognized response.</li>
</ol>

<p>If there&rsquo;s a network error, Stormpath will return the <code>NSError</code> associated with <code>NSURLSession</code> to your code. Otherwise, Stormpath will return <code>StormpathError</code>, a <code>NSError</code> subclass. </p>

<p>For user errors, <code>StormpathError</code> will have the HTTP error code of the API response (usually 400), and <code>localizedDescription</code> set to a user-readable error message which is safe to display to the user. </p>

<p>In special cases, StormpathError will have code 0 or 1. These are developer errors that should not be displayed to the user. 0 stands for <q>Stormpath SDK Error</q>, and most likely indicates a bug with the Stormpath SDK that should be reported to us. 1 stands for <q>API Response Error</q>, and means that the API responded with something unexpected. This most likely means that you have your backend integration misconfigured. </p>
<a href='#configuring-stormpath-with-info-plist' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='configuring-stormpath-with-info-plist'>Configuring Stormpath with Info.plist</h2>

<p><code>StormpathConfiguration</code> can be used to point Stormpath to a specific API URL. While you can modify the object directly, you can also put your configuration in Info.plist. To add the Stormpath configuration, right click on Info.plist, and click <q>open as source code</q>. Before the last <code>&lt;/plist&gt;</code> tag, paste: </p>
<pre class="highlight xml"><code><span class="nt">&lt;key&gt;</span>Stormpath<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;dict&gt;</span>
    <span class="nt">&lt;key&gt;</span>APIURL<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;string&gt;</span>http://localhost:3000<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;/dict&gt;</span>
</code></pre>

<p>You can modify any of these values, and <code>StormpathConfiguration</code> will load these on first initialization. </p>
<a href='#handling-multiple-sessions' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='handling-multiple-sessions'>Handling Multiple Sessions</h2>

<p>Stormpath can be used to store multiple user accounts, even against multiple API servers using Stormpath. This is useful if you&rsquo;re making a multi-tenant application that allows the user to be logged in under different accounts at the same time. </p>

<p>To use this feature, instead of using <code>Stormpath.sharedSession</code>, initialize Stormpath with a custom identifier:</p>
<pre class="highlight plaintext"><code>Stormpath(identifier: "newSession")
</code></pre>

<p>This will create an instance of Stormpath with the default configuration (shared with the rest of the app) that will store <code>accessTokens</code> and <code>refreshTokens</code> in its own partition in the iOS Keychain. </p>

<p>This identifier can be used in your app to identify a user session contained in Stormpath, and properly restore it in between app opens. </p>

<p><em>Note: the identifier for <code>Stormpath.sharedSession</code> is <q>default</q>, so do not use this as an identifier for another instance of Stormpath.</em></p>
<a href='#license' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='license'>License</h1>

<p>This project is open-source via <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>. See the LICENSE file for details.</p>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2016 <a class="link" href="https://github.com/stormpath/stormpath-sdk-ios" target="_blank" rel="external">Stormpath</a>. All rights reserved. (Last updated: 2016-12-22)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.7.3</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
